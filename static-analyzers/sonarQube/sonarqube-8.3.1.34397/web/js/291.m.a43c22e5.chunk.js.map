{"version":3,"sources":["webpack:///./src/main/js/apps/security-hotspots/styles.css?978b","webpack:///./src/main/js/apps/security-hotspots/components/HotspotList.css?98a3","webpack:///./src/main/js/apps/security-hotspots/components/HotspotList.css","webpack:///./src/main/js/apps/security-hotspots/components/assignee/AssigneeSelection.css?fed6","webpack:///./src/main/js/apps/security-hotspots/components/assignee/AssigneeSelection.css","webpack:///./src/main/js/apps/security-hotspots/components/HotspotViewer.css?94be","webpack:///./src/main/js/apps/security-hotspots/components/HotspotViewer.css","webpack:///./src/main/js/apps/security-hotspots/components/status/Status.css?dec8","webpack:///./src/main/js/apps/security-hotspots/components/status/Status.css","webpack:///./src/main/js/apps/security-hotspots/styles.css","webpack:///./src/main/js/types/security-hotspots.ts","webpack:///./src/main/js/apps/security-hotspots/components/EmptyHotspotsPage.tsx","webpack:///./src/main/js/apps/security-hotspots/components/FilterBar.tsx","webpack:///./src/main/js/apps/security-hotspots/utils.ts","webpack:///./src/main/js/apps/security-hotspots/components/HotspotListItem.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotCategory.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotList.tsx","webpack:///./src/main/js/apps/security-hotspots/components/assignee/AssigneeSelectionRenderer.tsx","webpack:///./src/main/js/apps/security-hotspots/components/assignee/AssigneeSelection.tsx","webpack:///./src/main/js/apps/security-hotspots/components/assignee/AssigneeRenderer.tsx","webpack:///./src/main/js/apps/security-hotspots/components/assignee/Assignee.tsx","webpack:///./src/main/js/api/security-hotspots.ts","webpack:///./src/main/js/apps/security-hotspots/components/HotspotCommentPopup.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotReviewHistory.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotReviewHistoryAndComments.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotSnippetContainerRenderer.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotSnippetContainer.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotViewerTabs.tsx","webpack:///./src/main/js/apps/security-hotspots/components/status/StatusDescription.tsx","webpack:///./src/main/js/apps/security-hotspots/components/status/StatusSelectionRenderer.tsx","webpack:///./src/main/js/apps/security-hotspots/components/status/StatusSelection.tsx","webpack:///./src/main/js/apps/security-hotspots/components/status/Status.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotViewerRenderer.tsx","webpack:///./src/main/js/apps/security-hotspots/components/HotspotViewer.tsx","webpack:///./src/main/js/apps/security-hotspots/SecurityHotspotsAppRenderer.tsx","webpack:///./src/main/js/apps/security-hotspots/SecurityHotspotsApp.tsx","webpack:///./src/main/js/app/components/embed-docs-modal/Suggestions.tsx","webpack:///./src/main/js/components/hoc/utils.ts","webpack:///./src/main/js/types/component.ts","webpack:///./src/main/js/app/components/a11y/A11ySkipTarget.tsx","webpack:///./src/main/js/components/hoc/withCurrentUser.tsx","webpack:///./src/main/js/components/shared/SeverityHelper.tsx","webpack:///./src/main/js/components/measure/utils.ts","webpack:///./src/main/js/components/measure/Measure.tsx","webpack:///./src/main/js/components/tags/TagsList.css?d861","webpack:///./src/main/js/app/utils/addGlobalSuccessMessage.ts","webpack:///./src/main/js/helpers/periods.ts","webpack:///./src/main/js/components/common/ScreenPositionHelper.tsx","webpack:///./src/main/js/components/common/MultiSelectOption.tsx","webpack:///./src/main/js/components/common/MultiSelect.tsx","webpack:///./src/main/js/components/tags/TagsList.tsx","webpack:///./src/main/js/components/common/MarkdownTips.tsx","webpack:///./src/main/js/components/tags/TagsList.css","webpack:///./src/main/js/components/tags/TagsSelector.tsx","webpack:///./src/main/js/components/ui/CoverageRating.tsx","webpack:///./src/main/js/api/favorites.ts","webpack:///./src/main/js/components/controls/Favorite.tsx","webpack:///./src/main/js/components/common/LocationIndex.tsx","webpack:///./src/main/js/components/shared/StatusHelper.tsx","webpack:///./src/main/js/helpers/security-standard.ts","webpack:///./src/main/js/components/SourceViewer/helpers/indexing.ts","webpack:///./src/main/js/components/issue/components/IssueChangelogDiff.tsx","webpack:///./src/main/js/components/SourceViewer/helpers/issueLocations.ts","webpack:///./src/main/js/components/SourceViewer/SourceViewerContext.tsx","webpack:///./src/main/js/components/SourceViewer/helpers/highlight.ts","webpack:///./src/main/js/components/common/LocationIndex.css?e012","webpack:///./src/main/js/components/common/LocationIndex.css","webpack:///./src/main/js/components/common/LocationMessage.tsx","webpack:///./src/main/js/components/common/LocationMessage.css?8760","webpack:///./src/main/js/components/common/LocationMessage.css","webpack:///./src/main/js/components/issue/Issue.css?a142","webpack:///./src/main/js/components/issue/Issue.css","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/components/issue/actions.ts","webpack:///./src/main/js/components/common/SelectListItem.tsx","webpack:///./src/main/js/components/common/SelectList.tsx","webpack:///./src/main/js/components/issue/popups/SetAssigneePopup.tsx","webpack:///./src/main/js/components/issue/components/IssueAssign.tsx","webpack:///./src/main/js/components/issue/popups/CommentPopup.tsx","webpack:///./src/main/js/components/issue/components/IssueCommentAction.tsx","webpack:///./src/main/js/components/issue/popups/SetSeverityPopup.tsx","webpack:///./src/main/js/components/issue/components/IssueSeverity.tsx","webpack:///./src/main/js/components/issue/popups/SetIssueTagsPopup.tsx","webpack:///./src/main/js/components/issue/components/IssueTags.tsx","webpack:///./src/main/js/components/issue/popups/SetTransitionPopup.tsx","webpack:///./src/main/js/components/issue/components/IssueTransition.tsx","webpack:///./src/main/js/components/issue/popups/SetTypePopup.tsx","webpack:///./src/main/js/components/issue/components/IssueType.tsx","webpack:///./src/main/js/components/issue/components/IssueActionsBar.tsx","webpack:///./src/main/js/components/issue/popups/CommentDeletePopup.tsx","webpack:///./src/main/js/components/issue/components/IssueCommentLine.tsx","webpack:///./src/main/js/components/issue/popups/ChangelogPopup.tsx","webpack:///./src/main/js/components/issue/components/IssueChangelog.tsx","webpack:///./src/main/js/components/issue/components/IssueMessage.tsx","webpack:///./src/main/js/components/issue/popups/SimilarIssuesPopup.tsx","webpack:///./src/main/js/components/issue/components/SimilarIssuesFilter.tsx","webpack:///./src/main/js/components/issue/components/IssueTitleBar.tsx","webpack:///./src/main/js/components/issue/IssueView.tsx","webpack:///./src/main/js/components/issue/Issue.tsx","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.tsx","webpack:///./src/main/js/components/SourceViewer/helpers/lines.ts","webpack:///./src/main/js/components/SourceViewer/components/LineIssuesList.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineCode.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineCoverage.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineDuplicationBlock.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineDuplications.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineIssuesIndicator.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineOptionsPopup.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineNumber.tsx","webpack:///./src/main/js/components/SourceViewer/components/SCMPopup.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineSCM.tsx","webpack:///./src/main/js/components/SourceViewer/components/Line.tsx","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.css?94e1","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.css","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/components/SourceViewer/components/Line.css?69c4","webpack:///./src/main/js/components/SourceViewer/components/Line.css","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?ff37","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css"],"names":["api","content","__esModule","default","module","i","options","exported","locals","exports","___CSS_LOADER_API_IMPORT___","push","RiskExposure","HotspotStatus","HotspotResolution","HotspotStatusFilter","HotspotStatusOption","ReviewHistoryType","EmptyHotspotsPage","props","filtered","isStaticListOfHotspots","translationRoot","className","alt","height","src","target","to","pathname","statusOptions","value","TO_REVIEW","label","FIXED","SAFE","periodOptions","AssigneeFilterOption","assigneeFilterOptions","ME","ALL","withCurrentUser","currentUser","component","filters","hotspotsReviewedMeasure","loadingMeasure","onBranch","isProject","qualifier","Project","id","onClick","onShowAllHotspots","role","tabIndex","name","onCheck","onChangeFilters","assignedToMe","clearable","onChange","option","status","searchable","sinceLeakPeriod","overlay","loading","CoverageRating","Measure","metricKey","metricType","RISK_EXPOSURE_LEVELS","HIGH","MEDIUM","LOW","groupByCategory","hotspots","securityCategories","groups","h","securityCategory","Object","keys","map","key","title","getCategoryTitle","STATUS_AND_RESOLUTION_TO_STATUS_OPTION","REVIEWED","getStatusOptionFromStatusAndResolution","resolution","STATUS_OPTION_TO_STATUS_AND_RESOLUTION_MAP","undefined","HotspotListItem","hotspot","selected","highlight","href","message","HotspotCategory","categoryKey","expanded","selectedHotspot","length","risk","vulnerabilityProbability","onToggleExpand","onHotspotClick","super","groupHotspots","risks","categories","filter","handleToggleCategory","this","setState","expandedCategories","state","groupedHotspots","prevProps","hotspotsTotal","loadingMore","statusFilter","riskGroup","cat","count","loadMore","onLoadMore","total","AssigneeSelectionRenderer","highlighted","open","query","suggestedUsers","autoFocus","onSearch","onKeyDown","placeholder","Dropdown","noPadding","placement","BottomLeft","suggestion","active","login","onSelect","Avatar","hash","avatar","size","mounted","handleSearch","handleNoSearch","handleActualSearch","allowCurrentUserSelection","loggedInUser","q","then","result","users","catch","handleKeyDown","event","keyCode","Enter","preventDefault","selectHighlighted","UpArrow","highlightPrevious","DownArrow","highlightNext","getCurrentIndex","findIndex","highlightIndex","index","AssigneeRenderer","assignee","canEdit","editing","onEnterEditionMode","onKeydown","onExitEditionMode","onClickOutside","onAssign","handleEnterEditionMode","handleExitEditionMode","handleAssign","newAssignee","hotspotKey","data","throwGlobalError","onAssigneeChange","addGlobalSuccessMessage","assigneeUser","HotspotCommentPopup","comment","setComment","markdownComment","rows","MarkdownTips","onCommentEditSubmit","onCancelEdit","HotspotReviewHistory","reviewHistory","history","creationDate","type","Creation","date","user","authorUser","changelog","log","Diff","isUserActive","userName","diffs","Comment","createdAt","updatable","html","htmlText","markdown","elt","getHotspotReviewHistory","editedCommentKey","setEditedCommentKey","historyElt","historyIndex","diff","diffIndex","IssueChangelogDiff","dangerouslySetInnerHTML","__html","onRequestClose","BottomRight","onEditComment","onOpen","onDeleteComment","overlayPlacement","handleCommentChange","handleCloseComment","onCloseComment","handleSubmitComment","onCommentUpdate","handleDeleteComment","commentKey","handleEditComment","text","editSecurityHotspotComment","commentTextRef","commentVisible","invisible","onOpenComment","ref","noop","HotspotSnippetContainerRenderer","branchLike","displayProjectName","highlightedSymbols","linePopup","locations","sourceLines","sourceViewerFile","SourceViewerHeaderSlim","expandable","linkToProject","onExpand","SourceViewerContext","Provider","file","SnippetViewer","displaySCM","expandBlock","_i","direction","onExpandBlock","handleCloseIssues","handleLinePopupToggle","onLinePopupToggle","handleOpenIssues","handleSymbolClick","onSymbolClick","highlightedLocationMessage","issue","issuesByLine","lastSnippetOfLastGroup","loadDuplications","locationsByLine","onIssueChange","onIssuePopupToggle","onLocationSelect","openIssuesByLine","renderDuplicationPopup","snippet","handleExpansion","range","from","Math","max","line","additionalLines","lastLine","checkLastLine","concatSourceLines","concat","slice","params","samePopup","fetchSources","lines","lastLineReceived","textRange","startLine","endLine","project","measures","toString","path","projectName","uuid","constructSourceViewerFile","Application","TabKeys","handleSelectTabs","tabKey","tabs","currentTab","find","tab","computeTabs","RiskDescription","rule","riskDescription","VulnerabilityDescription","vulnerabilityDescription","FixRecommendation","fixRecommendations","Boolean","StatusDescription","statusOption","showTitle","StatusSelectionRenderer","selectedStatus","submitDisabled","renderOption","checked","onStatusChange","htmlFor","onCommentChange","currentTarget","disabled","onSubmit","handleStatusChange","handleSubmit","initialStatus","onStatusOptionChange","isOpen","setIsOpen","readonly","canChangeStatus","trigger","actionableTrigger","closeOnClickOutside","closeOnEscape","Bottom","parentScrollRef","permalink","copyValue","onUpdateHotspot","fetchHotspot","securityHotspotKey","response","u","author","forEach","c","handleHotspotUpdate","handleOpenComment","current","focus","preventScroll","parent","bottomOffset","prevState","SecurityHotspotsAppRenderer","ScreenPositionHelper","top","style","Suggestions","suggestions","A11ySkipTarget","anchor","handleCallFailure","fetchSecurityHotspotsReviewed","reviewedHotspotsMetricKey","metricKeys","measure","reloadSecurityHotspotList","fetchSecurityHotspots","paging","hotspotsPageIndex","handleChangeFilters","changes","handleHotspotClick","Promise","all","p","hotspotPages","allHotspots","nextHotspot","min","pageIndex","handleShowAllHotspots","router","location","handleLoadMore","additionalHotspots","constructFiltersFromProps","fetchInitialData","previous","sonarsourceSecurity","page","hotspotKeys","split","join","getSecurityHotspotList","projectKey","ps","onlyMine","Consumer","addSuggestions","removeSuggestions","SuggestionsInner","getWrappedDisplayName","WrappedComponent","hocName","wrappedDisplayName","displayName","ComponentQualifier","Visibility","isPortfolioLike","componentQualifier","Portfolio","SubPortfolio","includes","addA11ySkipLink","removeA11ySkipLink","A11ySkipTargetInner","getLink","weight","Wrapper","SeverityHelper","severity","KNOWN_RATINGS","enhanceMeasure","metrics","metric","leak","getLeakValue","periods","period","getRatingTooltip","finalMetricKey","substr","decimals","small","level","formattedValue","omitExtraDecimalZeros","tooltip","Number","rating","dispatch","getLeakPeriod","Array","isArray","getPeriod","getPeriodLabel","dateFormatter","parameter","modeParam","mode","toLowerCase","getPeriodDate","isApplicationPeriod","getPosition","containerPos","container","getBoundingClientRect","window","pageYOffset","left","pageXOffset","debouncedOnResize","forceUpdate","addEventListener","removeEventListener","children","MultiSelectOption","custom","element","onHover","renderLabel","onFocus","onMouseOver","onSelectChange","handleSelectChange","item","onSelectItem","onUnselectItem","handleSearchChange","onSearchQuery","validateSearchInput","handleElementHover","activeIdx","getAllElements","indexOf","handleKeyboard","evt","stopPropagation","selectNextElement","selectPreviousElement","toggleSelect","stopLoading","isNewElement","onUnselect","elem","selectedElements","elements","updateSelectedElements","filterSelected","updateUnselectedElements","listSize","unselectedElements","setElementActive","idx","allElements","nextProps","totalElements","searchInput","allowSelection","allowNewElements","footerNode","activeElement","showNewElement","infiniteList","listClasses","div","defaultProps","TagsList","allowUpdate","tags","handleClick","TagsSelector","selectedTags","validateTag","replace","DonutChart","SIZE_TO_WIDTH_MAPPING","normal","big","huge","SIZE_TO_THICKNESS_MAPPING","muted","fill","padAngle","numberValue","gray71","green","barBackgroundColor","lineCoverageRed","width","thickness","addFavorite","removeFavorite","toggleFavorite","newFavorite","favorite","handleFavorite","_prevProps","LocationIndex","leading","other","clickAttributes","StatusHelper","getStandards","x","renderCWECategory","standards","category","record","cwe","renderOwaspTop10Category","withPrefix","owaspTop10","addPrefix","toUpperCase","renderSansTop25Category","sansTop25","renderSonarSourceSecurityCategory","prefix","issues","issuesByComponentAndLine","reduce","mapping","duplicationsByLine","duplications","blocks","duplicationIndex","block","_ref","symbolsByLine","sources","tokens","code","symbols","token","match","oldValue","newValue","getLinearLocations","startOffset","endOffset","getSecondaryIssueLocationsForLine","highlightedLocations","l","msg","splitByTokens","rootClassName","document","createElement","innerHTML","call","childNodes","node","nodeType","fullClassName","innerTokens","nodeValue","markers","highlightSymbol","symbol","symbolRegExp","RegExp","test","part","str","acc","highlightIssueLocations","issueLocations","nextTokens","markerAdded","s1","e1","s2","e2","p1","p2","p3","newClassName","LocationMessage","MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","startA","endA","startB","endB","getPrimaryLocation","createSnippets","hasSecondaryLocations","secondaryLocations","ranges","snippets","loc","startIndex","endIndex","locationEnd","issueEndLine","addLinesBellow","firstCollision","start","end","keep","sort","a","b","linesForSnippets","componentLines","groupLocationsByComponent","components","currentGroup","currentComponent","addGroup","every","expandSnippet","snippetIndex","snippetToExpand","s","Error","toDelete","inSnippet","updateIssue","resultPromise","oldIssue","newIssue","optimisticUpdate","rules","handleSelect","handleHover","renderLink","attachShortcuts","previousKeyScope","previousFilter","currentKeyScope","tagName","srcElement","isInput","detachShortcuts","items","renderChild","child","currentItem","hasChildren","searchMembers","organization","projectOrganization","handleSearchResult","searchUsers","activeUsers","defaultUsersArray","minLength","marginLeft","toggleAssign","togglePopup","handleClose","assigneeName","assigneeAvatar","assigneeActive","canAssign","renderAssignee","textComment","handleCommentClick","trim","onComment","handleCancelClick","toggleComment","metaKey","ctrlKey","autoTriggered","addComment","issueKey","currentPopup","commentAutoTriggered","commentPlaceholder","SEVERITY","SetSeverityPopup","toggleSetSeverity","setSeverity","setIssueProperty","canSetSeverity","searchResult","tag","setTags","availableTags","toggleSetTags","canSetTags","SetTransitionPopup","fromHotspot","transitions","isManualVulnerability","transition","description","translateTransition","setTransition","toggleSetTransition","hasTransitions","TYPES","SetTypePopup","toggleSetType","setType","canSetType","baseFontColor","property","popup","apiCall","handleTransition","actions","canComment","isSecurityHotspot","effort","CommentDeletePopup","onDelete","openPopup","handleEdit","onEdit","toggleEditPopup","handleDelete","toggleDeletePopup","popupName","force","closePopups","authorName","authorActive","authorAvatar","loadChangelog","toggleChangelog","mouseEnterDelay","IssueMessage","engine","manualVulnerability","ruleKey","onOpenRule","onFilter","subProject","ruleName","subProjectName","componentLongName","handleFilter","IssueTitleBar","hasSimilarIssuesFilter","locationsCount","flows","sum","locationsBadge","displayLocations","displayLocationsCount","issueUrl","types","openRule","externalRuleEngine","displayLocationsLink","handleCheck","isClickable","parentElement","editComment","deleteComment","hasCheckbox","issueClass","comments","onPopupToggle","handleAssignement","bindShortcuts","unbindShortcuts","projectNameLabel","SubProject","canMarkAsFavorite","fav","fileUuids","resolved","optimizeHighlightedSymbols","symbolsForLine","optimizeLocationMessage","optimizedSecondaryIssueLocations","some","optimizeSelectedIssue","selectedIssue","issuesForLine","LineIssuesList","issuePopup","Issue","displayIssueLocationsCount","displayIssueLocationsLink","onIssueClick","attachEvents","activeMarkerNode","scroll","detachEvents","codeNode","querySelectorAll","onIssueSelect","padding","secondaryIssueLocations","showIssues","renderedTokens","leadingMarker","displayLocationMarkers","marker","renderMarker","paddingBottom","filteredSelectedIssues","LineCoverage","coverageStatus","getStatusTooltip","conditions","coveredConditions","blur","handleTogglePopup","closePopup","duplicated","popupOpen","cell","hasIssues","mostImportantIssue","LineOptionsPopup","RightTop","rel","lineNumber","SCMPopup","hasAuthor","scmAuthor","scmDate","scmRevision","previousLine","hasPopup","changed","isSCMChanged","isPopupOpen","handleIssuesIndicatorClick","openIssues","onIssuesClose","onIssueUnselect","onIssuesOpen","displayCoverage","duplicationsCount","isNew","last","bottomPadding","verticalBuffer","displayIssues","displayAllIssues","displayDuplications","doScroll","snippetNodeRef","offset","leftOffset","rightOffset","scrollToLastExpandedRow","snippetNode","lastRow","lineDuplications","isSinkLine","parseInt","bottomLine","issueLine","lowestVisibleIssue","k","renderLine"],"mappings":"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","file":"js/291.m.a43c22e5.chunk.js","sourcesContent":["var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./styles.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./HotspotList.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".hotspot-list-header{padding:16px 8px}.hotspot-risk-header{padding:8px}.hotspot-category{background-color:#fff;border:1px solid #e6e6e6}.hotspot-category .hotspot-category-header{padding:16px 8px;color:#444;border-bottom:none;border-left:4px solid}.hotspot-category .hotspot-category-header.contains-selected-hotspot,.hotspot-category .hotspot-category-header:hover{color:#4b9fd5}.hotspot-category.HIGH .hotspot-category-header{border-left-color:#d4333f}.hotspot-category.MEDIUM .hotspot-category-header{border-left-color:#ed7d20}.hotspot-category.LOW .hotspot-category-header{border-left-color:#eabe06}.hotspot-item{color:#444;display:block;padding:8px 16px;border:1px solid transparent;border-top-color:#e6e6e6;transition:padding 0s,border 0s}.hotspot-item:hover{background-color:#f2faff;border:1px dashed #4b9fd5;color:#444}.hotspot-item.highlight{background-color:#f2faff;color:#444;border:1px solid #4b9fd5;cursor:unset}.hotspot-risk-badge{color:#fff;text-transform:uppercase;display:inline-block;text-align:center;min-width:48px;padding:0 8px;font-weight:700;border-radius:2px}.hotspot-risk-badge.HIGH{background-color:#d4333f}.hotspot-risk-badge.MEDIUM{background-color:#ed7d20}.hotspot-risk-badge.LOW{background-color:#eabe06}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var api = require(\"!../../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../../node_modules/postcss-loader/src/index.js??postcss!./AssigneeSelection.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".hotspot-assignee-search-results{min-width:300px}.hotspot-assignee-search-results li{cursor:pointer}.hotspot-assignee-search-results li.active,.hotspot-assignee-search-results li:hover{background-color:#f3f3f3}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./HotspotViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".hotspot-information{flex-basis:320px}.hotspot-information>div>span{flex-basis:100px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var api = require(\"!../../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../../node_modules/postcss-loader/src/index.js??postcss!./Status.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \"#status-trigger,#status-trigger+.popup{width:400px;box-sizing:border-box}#status-trigger{height:80px;border-radius:4px;outline:none}#status-trigger.readonly{cursor:not-allowed}#status-trigger:not(.readonly){cursor:pointer;background-color:#236a97}#status-trigger:not(.readonly) *{color:#fff}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \"#security_hotspots .wrapper{position:fixed;bottom:0;width:100%}#security_hotspots .layout-page{margin:0 auto;min-width:1080px;max-width:1280px;height:100%}#security_hotspots .filter-bar{max-width:1280px;box-sizing:border-box;margin:0 auto;padding:16px 8px;border-bottom:1px solid #e6e6e6}#security_hotspots .sidebar{flex:0 0 300px;border-right:1px solid #e6e6e6;height:100%;overflow-y:auto}#security_hotspots .main{flex:1 1 auto;background-color:#fff;overflow-x:auto}#security_hotspots .main .hotspot-content{overflow-y:auto;height:100%;box-sizing:border-box}.invisible{visibility:hidden}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nexport enum RiskExposure {\n  LOW = 'LOW',\n  MEDIUM = 'MEDIUM',\n  HIGH = 'HIGH'\n}\n\nexport enum HotspotStatus {\n  TO_REVIEW = 'TO_REVIEW',\n  REVIEWED = 'REVIEWED'\n}\n\nexport enum HotspotResolution {\n  FIXED = 'FIXED',\n  SAFE = 'SAFE'\n}\n\nexport enum HotspotStatusFilter {\n  FIXED = 'FIXED',\n  SAFE = 'SAFE',\n  TO_REVIEW = 'TO_REVIEW'\n}\n\nexport enum HotspotStatusOption {\n  FIXED = 'FIXED',\n  SAFE = 'SAFE',\n  TO_REVIEW = 'TO_REVIEW'\n}\n\nexport interface HotspotFilters {\n  assignedToMe: boolean;\n  sinceLeakPeriod: boolean;\n  status: HotspotStatusFilter;\n}\n\nexport interface RawHotspot {\n  assignee?: string;\n  author?: string;\n  component: string;\n  creationDate: string;\n  key: string;\n  line?: number;\n  message: string;\n  project: string;\n  resolution?: HotspotResolution;\n  rule: string;\n  securityCategory: string;\n  status: HotspotStatus;\n  subProject?: string;\n  updateDate: string;\n  vulnerabilityProbability: RiskExposure;\n}\n\nexport interface Hotspot {\n  assignee?: string;\n  assigneeUser?: T.UserBase;\n  author: string;\n  authorUser: T.UserBase;\n  canChangeStatus: boolean;\n  changelog: T.IssueChangelog[];\n  comment: HotspotComment[];\n  component: T.Component;\n  creationDate: string;\n  key: string;\n  line?: number;\n  message: string;\n  project: T.Component;\n  resolution?: HotspotResolution;\n  rule: HotspotRule;\n  status: HotspotStatus;\n  textRange: T.TextRange;\n  updateDate: string;\n  users: T.UserBase[];\n}\n\nexport interface HotspotUpdateFields {\n  status: HotspotStatus;\n  resolution?: HotspotResolution;\n}\n\nexport interface HotspotUpdate extends HotspotUpdateFields {\n  key: string;\n}\n\nexport interface HotspotRule {\n  fixRecommendations?: string;\n  key: string;\n  name: string;\n  riskDescription?: string;\n  securityCategory: string;\n  vulnerabilityDescription?: string;\n  vulnerabilityProbability: RiskExposure;\n}\n\nexport interface HotspotComment {\n  key: string;\n  htmlText: string;\n  markdown: string;\n  updatable: boolean;\n  createdAt: string;\n  login: string;\n  user: T.UserBase;\n}\n\nexport interface ReviewHistoryElement {\n  type: ReviewHistoryType;\n  date: string;\n  user: Pick<T.UserBase, 'active' | 'avatar' | 'name'>;\n  diffs?: T.IssueChangelogDiff[];\n  html?: string;\n  key?: string;\n  updatable?: boolean;\n  markdown?: string;\n}\n\nexport enum ReviewHistoryType {\n  Creation,\n  Diff,\n  Comment\n}\n\nexport interface HotspotSearchResponse {\n  components?: { key: string; qualifier: string; name: string }[];\n  hotspots: RawHotspot[];\n  paging: T.Paging;\n}\n\nexport interface HotspotSetStatusRequest {\n  status: HotspotStatus;\n  resolution?: HotspotResolution;\n  comment?: string;\n}\n\nexport interface HotspotAssignRequest {\n  assignee: string;\n  comment?: string;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getBaseUrl } from 'sonar-ui-common/helpers/urls';\n\nexport interface EmptyHotspotsPageProps {\n  filtered: boolean;\n  isStaticListOfHotspots: boolean;\n}\n\nexport default function EmptyHotspotsPage(props: EmptyHotspotsPageProps) {\n  const { filtered, isStaticListOfHotspots } = props;\n\n  let translationRoot;\n  if (isStaticListOfHotspots) {\n    translationRoot = 'no_hotspots_for_keys';\n  } else if (filtered) {\n    translationRoot = 'no_hotspots_for_filters';\n  } else {\n    translationRoot = 'no_hotspots';\n  }\n\n  return (\n    <div className=\"display-flex-column display-flex-center huge-spacer-top\">\n      <img\n        alt={translate('hotspots.page')}\n        className=\"huge-spacer-top\"\n        height={100}\n        src={`${getBaseUrl()}/images/${filtered ? 'filter-large' : 'hotspot-large'}.svg`}\n      />\n      <h1 className=\"huge-spacer-top\">{translate(`hotspots.${translationRoot}.title`)}</h1>\n      <div className=\"abs-width-400 text-center big-spacer-top\">\n        {translate(`hotspots.${translationRoot}.description`)}\n      </div>\n      {!(filtered || isStaticListOfHotspots) && (\n        <Link\n          className=\"big-spacer-top\"\n          target=\"_blank\"\n          to={{ pathname: '/documentation/user-guide/security-hotspots/' }}>\n          {translate('hotspots.learn_more')}\n        </Link>\n      )}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport HelpTooltip from 'sonar-ui-common/components/controls/HelpTooltip';\nimport RadioToggle from 'sonar-ui-common/components/controls/RadioToggle';\nimport Select from 'sonar-ui-common/components/controls/Select';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { withCurrentUser } from '../../../components/hoc/withCurrentUser';\nimport Measure from '../../../components/measure/Measure';\nimport CoverageRating from '../../../components/ui/CoverageRating';\nimport { isLoggedIn } from '../../../helpers/users';\nimport { ComponentQualifier } from '../../../types/component';\nimport { HotspotFilters, HotspotStatusFilter } from '../../../types/security-hotspots';\n\nexport interface FilterBarProps {\n  currentUser: T.CurrentUser;\n  component: T.Component;\n  filters: HotspotFilters;\n  hotspotsReviewedMeasure?: string;\n  isStaticListOfHotspots: boolean;\n  loadingMeasure: boolean;\n  onBranch: boolean;\n  onChangeFilters: (filters: Partial<HotspotFilters>) => void;\n  onShowAllHotspots: () => void;\n}\n\nconst statusOptions: Array<{ label: string; value: string }> = [\n  { value: HotspotStatusFilter.TO_REVIEW, label: translate('hotspot.filters.status.to_review') },\n  { value: HotspotStatusFilter.FIXED, label: translate('hotspot.filters.status.fixed') },\n  { value: HotspotStatusFilter.SAFE, label: translate('hotspot.filters.status.safe') }\n];\n\nconst periodOptions = [\n  { value: true, label: translate('hotspot.filters.period.since_leak_period') },\n  { value: false, label: translate('hotspot.filters.period.overall') }\n];\n\nexport enum AssigneeFilterOption {\n  ALL = 'all',\n  ME = 'me'\n}\n\nconst assigneeFilterOptions = [\n  { value: AssigneeFilterOption.ME, label: translate('hotspot.filters.assignee.assigned_to_me') },\n  { value: AssigneeFilterOption.ALL, label: translate('hotspot.filters.assignee.all') }\n];\n\nexport function FilterBar(props: FilterBarProps) {\n  const {\n    currentUser,\n    component,\n    filters,\n    hotspotsReviewedMeasure,\n    isStaticListOfHotspots,\n    loadingMeasure,\n    onBranch\n  } = props;\n  const isProject = component.qualifier === ComponentQualifier.Project;\n\n  return (\n    <div className=\"filter-bar display-flex-center\">\n      {isStaticListOfHotspots ? (\n        <a id=\"show_all_hotspot\" onClick={() => props.onShowAllHotspots()} role=\"link\" tabIndex={0}>\n          {translate('hotspot.filters.show_all')}\n        </a>\n      ) : (\n        <div className=\"display-flex-space-between width-100\">\n          <div className=\"display-flex-center\">\n            <h3 className=\"huge-spacer-right\">{translate('hotspot.filters.title')}</h3>\n\n            {isLoggedIn(currentUser) && (\n              <RadioToggle\n                className=\"huge-spacer-right\"\n                name=\"assignee-filter\"\n                onCheck={(value: AssigneeFilterOption) =>\n                  props.onChangeFilters({ assignedToMe: value === AssigneeFilterOption.ME })\n                }\n                options={assigneeFilterOptions}\n                value={filters.assignedToMe ? AssigneeFilterOption.ME : AssigneeFilterOption.ALL}\n              />\n            )}\n\n            <span className=\"spacer-right\">{translate('status')}</span>\n            <Select\n              className=\"input-medium big-spacer-right\"\n              clearable={false}\n              onChange={(option: { value: HotspotStatusFilter }) =>\n                props.onChangeFilters({ status: option.value })\n              }\n              options={statusOptions}\n              searchable={false}\n              value={filters.status}\n            />\n\n            {onBranch && (\n              <Select\n                className=\"input-medium big-spacer-right\"\n                clearable={false}\n                onChange={(option: { value: boolean }) =>\n                  props.onChangeFilters({ sinceLeakPeriod: option.value })\n                }\n                options={periodOptions}\n                searchable={false}\n                value={filters.sinceLeakPeriod}\n              />\n            )}\n          </div>\n\n          {isProject && (\n            <div className=\"display-flex-center\">\n              <span className=\"little-spacer-right\">\n                {translate('metric.security_hotspots_reviewed.name')}\n              </span>\n              <HelpTooltip\n                className=\"big-spacer-right\"\n                overlay={translate('hotspots.reviewed.tooltip')}\n              />\n              <DeferredSpinner loading={loadingMeasure}>\n                {hotspotsReviewedMeasure && <CoverageRating value={hotspotsReviewedMeasure} />}\n                <Measure\n                  className=\"spacer-left huge\"\n                  metricKey={\n                    onBranch && !filters.sinceLeakPeriod\n                      ? 'security_hotspots_reviewed'\n                      : 'new_security_hotspots_reviewed'\n                  }\n                  metricType=\"PERCENT\"\n                  value={hotspotsReviewedMeasure}\n                />\n              </DeferredSpinner>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default withCurrentUser(FilterBar);\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { groupBy, sortBy } from 'lodash';\nimport {\n  Hotspot,\n  HotspotResolution,\n  HotspotStatus,\n  HotspotStatusOption,\n  RawHotspot,\n  ReviewHistoryElement,\n  ReviewHistoryType,\n  RiskExposure\n} from '../../types/security-hotspots';\n\nexport const RISK_EXPOSURE_LEVELS = [RiskExposure.HIGH, RiskExposure.MEDIUM, RiskExposure.LOW];\n\nexport function mapRules(rules: Array<{ key: string; name: string }>): T.Dict<string> {\n  return rules.reduce((ruleMap: T.Dict<string>, r) => {\n    ruleMap[r.key] = r.name;\n    return ruleMap;\n  }, {});\n}\n\nexport function groupByCategory(\n  hotspots: RawHotspot[] = [],\n  securityCategories: T.StandardSecurityCategories\n) {\n  const groups = groupBy(hotspots, h => h.securityCategory);\n\n  return Object.keys(groups).map(key => ({\n    key,\n    title: getCategoryTitle(key, securityCategories),\n    hotspots: groups[key]\n  }));\n}\n\nexport function sortHotspots(\n  hotspots: RawHotspot[],\n  securityCategories: T.Dict<{ title: string }>\n) {\n  return sortBy(hotspots, [\n    h => RISK_EXPOSURE_LEVELS.indexOf(h.vulnerabilityProbability),\n    h => getCategoryTitle(h.securityCategory, securityCategories),\n    h => h.message\n  ]);\n}\n\nfunction getCategoryTitle(key: string, securityCategories: T.StandardSecurityCategories) {\n  return securityCategories[key] ? securityCategories[key].title : key;\n}\n\nexport function constructSourceViewerFile(\n  { component, project }: Hotspot,\n  lines?: number\n): T.SourceViewerFile {\n  return {\n    key: component.key,\n    measures: { lines: lines ? lines.toString() : undefined },\n    path: component.path || '',\n    project: project.key,\n    projectName: project.name,\n    q: component.qualifier,\n    uuid: ''\n  };\n}\n\nexport function getHotspotReviewHistory(hotspot: Hotspot): ReviewHistoryElement[] {\n  const history: ReviewHistoryElement[] = [];\n\n  if (hotspot.creationDate) {\n    history.push({\n      type: ReviewHistoryType.Creation,\n      date: hotspot.creationDate,\n      user: {\n        ...hotspot.authorUser,\n        name: hotspot.authorUser.name || hotspot.authorUser.login\n      }\n    });\n  }\n\n  if (hotspot.changelog && hotspot.changelog.length > 0) {\n    history.push(\n      ...hotspot.changelog.map(log => ({\n        type: ReviewHistoryType.Diff,\n        date: log.creationDate,\n        user: {\n          active: log.isUserActive,\n          avatar: log.avatar,\n          name: log.userName || log.user\n        },\n        diffs: log.diffs\n      }))\n    );\n  }\n\n  if (hotspot.comment && hotspot.comment.length > 0) {\n    history.push(\n      ...hotspot.comment.map(comment => ({\n        type: ReviewHistoryType.Comment,\n        date: comment.createdAt,\n        updatable: comment.updatable,\n        user: {\n          ...comment.user,\n          name: comment.user.name || comment.user.login\n        },\n        html: comment.htmlText,\n        key: comment.key,\n        markdown: comment.markdown\n      }))\n    );\n  }\n\n  return sortBy(history, elt => elt.date);\n}\n\nconst STATUS_AND_RESOLUTION_TO_STATUS_OPTION = {\n  [HotspotStatus.TO_REVIEW]: HotspotStatusOption.TO_REVIEW,\n  [HotspotStatus.REVIEWED]: HotspotStatusOption.FIXED,\n  [HotspotResolution.FIXED]: HotspotStatusOption.FIXED,\n  [HotspotResolution.SAFE]: HotspotStatusOption.SAFE\n};\n\nexport function getStatusOptionFromStatusAndResolution(\n  status: HotspotStatus,\n  resolution?: HotspotResolution\n) {\n  // Resolution is the most determinist info here, so we use it first to get the matching status option\n  // If not provided, we use the status (which will be TO_REVIEW)\n  return STATUS_AND_RESOLUTION_TO_STATUS_OPTION[resolution ?? status];\n}\n\nconst STATUS_OPTION_TO_STATUS_AND_RESOLUTION_MAP = {\n  [HotspotStatusOption.TO_REVIEW]: { status: HotspotStatus.TO_REVIEW, resolution: undefined },\n  [HotspotStatusOption.FIXED]: {\n    status: HotspotStatus.REVIEWED,\n    resolution: HotspotResolution.FIXED\n  },\n  [HotspotStatusOption.SAFE]: {\n    status: HotspotStatus.REVIEWED,\n    resolution: HotspotResolution.SAFE\n  }\n};\n\nexport function getStatusAndResolutionFromStatusOption(statusOption: HotspotStatusOption) {\n  return STATUS_OPTION_TO_STATUS_AND_RESOLUTION_MAP[statusOption];\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { RawHotspot } from '../../../types/security-hotspots';\nimport { getStatusOptionFromStatusAndResolution } from '../utils';\n\nexport interface HotspotListItemProps {\n  hotspot: RawHotspot;\n  onClick: (hotspot: RawHotspot) => void;\n  selected: boolean;\n}\n\nexport default function HotspotListItem(props: HotspotListItemProps) {\n  const { hotspot, selected } = props;\n  return (\n    <a\n      className={classNames('hotspot-item', { highlight: selected })}\n      href=\"#\"\n      onClick={() => !selected && props.onClick(hotspot)}>\n      <div className=\"little-spacer-left\">{hotspot.message}</div>\n      <div className=\"badge spacer-top\">\n        {translate(\n          'hotspots.status_option',\n          getStatusOptionFromStatusAndResolution(hotspot.status, hotspot.resolution)\n        )}\n      </div>\n    </a>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport ChevronDownIcon from 'sonar-ui-common/components/icons/ChevronDownIcon';\nimport ChevronUpIcon from 'sonar-ui-common/components/icons/ChevronUpIcon';\nimport { RawHotspot } from '../../../types/security-hotspots';\nimport HotspotListItem from './HotspotListItem';\n\nexport interface HotspotCategoryProps {\n  categoryKey: string;\n  expanded: boolean;\n  hotspots: RawHotspot[];\n  onHotspotClick: (hotspot: RawHotspot) => void;\n  onToggleExpand: (categoryKey: string, value: boolean) => void;\n  selectedHotspot: RawHotspot;\n  title: string;\n}\n\nexport default function HotspotCategory(props: HotspotCategoryProps) {\n  const { categoryKey, expanded, hotspots, selectedHotspot, title } = props;\n\n  if (hotspots.length < 1) {\n    return null;\n  }\n\n  const risk = hotspots[0].vulnerabilityProbability;\n\n  return (\n    <div className={classNames('hotspot-category', risk)}>\n      <a\n        className={classNames(\n          'hotspot-category-header display-flex-space-between display-flex-center',\n          { 'contains-selected-hotspot': selectedHotspot.securityCategory === categoryKey }\n        )}\n        href=\"#\"\n        onClick={() => props.onToggleExpand(categoryKey, !expanded)}>\n        <strong className=\"flex-1\">{title}</strong>\n        <span>\n          <span className=\"counter-badge\">{hotspots.length}</span>\n          {expanded ? (\n            <ChevronUpIcon className=\"big-spacer-left\" />\n          ) : (\n            <ChevronDownIcon className=\"big-spacer-left\" />\n          )}\n        </span>\n      </a>\n      {expanded && (\n        <ul>\n          {hotspots.map(h => (\n            <li key={h.key}>\n              <HotspotListItem\n                hotspot={h}\n                onClick={props.onHotspotClick}\n                selected={h.key === selectedHotspot.key}\n              />\n            </li>\n          ))}\n        </ul>\n      )}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { groupBy } from 'lodash';\nimport * as React from 'react';\nimport ListFooter from 'sonar-ui-common/components/controls/ListFooter';\nimport SecurityHotspotIcon from 'sonar-ui-common/components/icons/SecurityHotspotIcon';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { HotspotStatusFilter, RawHotspot, RiskExposure } from '../../../types/security-hotspots';\nimport { groupByCategory, RISK_EXPOSURE_LEVELS } from '../utils';\nimport HotspotCategory from './HotspotCategory';\nimport './HotspotList.css';\n\ninterface Props {\n  hotspots: RawHotspot[];\n  hotspotsTotal?: number;\n  isStaticListOfHotspots: boolean;\n  loadingMore: boolean;\n  onHotspotClick: (hotspot: RawHotspot) => void;\n  onLoadMore: () => void;\n  securityCategories: T.StandardSecurityCategories;\n  selectedHotspot: RawHotspot;\n  statusFilter: HotspotStatusFilter;\n}\n\ninterface State {\n  expandedCategories: T.Dict<boolean>;\n  groupedHotspots: Array<{\n    risk: RiskExposure;\n    categories: Array<{ key: string; hotspots: RawHotspot[]; title: string }>;\n  }>;\n}\n\nexport default class HotspotList extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      expandedCategories: { [props.selectedHotspot.securityCategory]: true },\n      groupedHotspots: this.groupHotspots(props.hotspots, props.securityCategories)\n    };\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    // Force open the category of selected hotspot\n    if (\n      this.props.selectedHotspot.securityCategory !== prevProps.selectedHotspot.securityCategory\n    ) {\n      this.handleToggleCategory(this.props.selectedHotspot.securityCategory, true);\n    }\n\n    // Compute the hotspot tree from the list\n    if (\n      this.props.hotspots !== prevProps.hotspots ||\n      this.props.securityCategories !== prevProps.securityCategories\n    ) {\n      const groupedHotspots = this.groupHotspots(\n        this.props.hotspots,\n        this.props.securityCategories\n      );\n      this.setState({ groupedHotspots });\n    }\n  }\n\n  groupHotspots = (hotspots: RawHotspot[], securityCategories: T.StandardSecurityCategories) => {\n    const risks = groupBy(hotspots, h => h.vulnerabilityProbability);\n\n    return RISK_EXPOSURE_LEVELS.map(risk => ({\n      risk,\n      categories: groupByCategory(risks[risk], securityCategories)\n    })).filter(risk => risk.categories.length > 0);\n  };\n\n  handleToggleCategory = (categoryKey: string, value: boolean) => {\n    this.setState(({ expandedCategories }) => ({\n      expandedCategories: { ...expandedCategories, [categoryKey]: value }\n    }));\n  };\n\n  render() {\n    const {\n      hotspots,\n      hotspotsTotal,\n      isStaticListOfHotspots,\n      loadingMore,\n      selectedHotspot,\n      statusFilter\n    } = this.props;\n\n    const { expandedCategories, groupedHotspots } = this.state;\n\n    return (\n      <div className=\"huge-spacer-bottom\">\n        <h1 className=\"hotspot-list-header bordered-bottom\">\n          <SecurityHotspotIcon className=\"spacer-right\" />\n          {translateWithParameters(\n            isStaticListOfHotspots ? 'hotspots.list_title' : `hotspots.list_title.${statusFilter}`,\n            hotspots.length\n          )}\n        </h1>\n        <ul className=\"big-spacer-bottom\">\n          {groupedHotspots.map(riskGroup => (\n            <li className=\"big-spacer-bottom\" key={riskGroup.risk}>\n              <div className=\"hotspot-risk-header little-spacer-left\">\n                <span>{translate('hotspots.risk_exposure')}:</span>\n                <div className={classNames('hotspot-risk-badge', 'spacer-left', riskGroup.risk)}>\n                  {translate('risk_exposure', riskGroup.risk)}\n                </div>\n              </div>\n              <ul>\n                {riskGroup.categories.map(cat => (\n                  <li className=\"spacer-bottom\" key={cat.key}>\n                    <HotspotCategory\n                      categoryKey={cat.key}\n                      expanded={expandedCategories[cat.key]}\n                      hotspots={cat.hotspots}\n                      onHotspotClick={this.props.onHotspotClick}\n                      onToggleExpand={this.handleToggleCategory}\n                      selectedHotspot={selectedHotspot}\n                      title={cat.title}\n                    />\n                  </li>\n                ))}\n              </ul>\n            </li>\n          ))}\n        </ul>\n        <ListFooter\n          count={hotspots.length}\n          loadMore={!loadingMore ? this.props.onLoadMore : undefined}\n          loading={loadingMore}\n          total={hotspotsTotal}\n        />\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport SearchBox from 'sonar-ui-common/components/controls/SearchBox';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport Avatar from '../../../../components/ui/Avatar';\nimport './AssigneeSelection.css';\n\nexport interface HotspotAssigneeSelectRendererProps {\n  highlighted?: T.UserActive;\n  loading: boolean;\n  onKeyDown: (event: React.KeyboardEvent) => void;\n  onSearch: (query: string) => void;\n  onSelect: (user: T.UserActive) => void;\n  open: boolean;\n  query?: string;\n  suggestedUsers?: T.UserActive[];\n}\n\nexport default function AssigneeSelectionRenderer(props: HotspotAssigneeSelectRendererProps) {\n  const { highlighted, loading, open, query, suggestedUsers } = props;\n  return (\n    <>\n      <div className=\"display-flex-center\">\n        <SearchBox\n          autoFocus={true}\n          onChange={props.onSearch}\n          onKeyDown={props.onKeyDown}\n          placeholder={translate('hotspots.assignee.select_user')}\n          value={query}\n        />\n\n        {loading && <DeferredSpinner className=\"spacer-left\" />}\n      </div>\n\n      {!loading && open && (\n        <div className=\"position-relative\">\n          <DropdownOverlay noPadding={true} placement={PopupPlacement.BottomLeft}>\n            {suggestedUsers && suggestedUsers.length > 0 ? (\n              <ul className=\"hotspot-assignee-search-results\">\n                {suggestedUsers.map(suggestion => (\n                  <li\n                    className={classNames('padded', {\n                      active: highlighted && highlighted.login === suggestion.login\n                    })}\n                    key={suggestion.login}\n                    onClick={() => props.onSelect(suggestion)}>\n                    <Avatar\n                      className=\"spacer-right\"\n                      hash={suggestion.avatar}\n                      name={suggestion.name}\n                      size={16}\n                    />\n                    {suggestion.name}\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <div className=\"padded\">{translate('no_results')}</div>\n            )}\n          </DropdownOverlay>\n        </div>\n      )}\n    </>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { debounce } from 'lodash';\nimport * as React from 'react';\nimport { KeyCodes } from 'sonar-ui-common/helpers/keycodes';\nimport { searchUsers } from '../../../../api/users';\nimport { isUserActive } from '../../../../helpers/users';\nimport AssigneeSelectionRenderer from './AssigneeSelectionRenderer';\n\ninterface Props {\n  allowCurrentUserSelection: boolean;\n  loggedInUser: T.LoggedInUser;\n  onSelect: (user?: T.UserActive) => void;\n}\n\ninterface State {\n  highlighted?: T.UserActive;\n  loading: boolean;\n  open: boolean;\n  query?: string;\n  suggestedUsers: T.UserActive[];\n}\n\nexport default class AssigneeSelection extends React.PureComponent<Props, State> {\n  mounted = false;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      loading: false,\n      open: props.allowCurrentUserSelection,\n      suggestedUsers: props.allowCurrentUserSelection ? [props.loggedInUser] : []\n    };\n\n    this.handleSearch = debounce(this.handleSearch, 250);\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  handleSearch = (query: string) => {\n    if (this.mounted) {\n      if (query.length < 2) {\n        this.handleNoSearch(query);\n      } else {\n        this.handleActualSearch(query);\n      }\n    }\n  };\n\n  handleNoSearch = (query: string) => {\n    const { allowCurrentUserSelection, loggedInUser } = this.props;\n\n    this.setState({\n      loading: false,\n      open: allowCurrentUserSelection,\n      query,\n      suggestedUsers: allowCurrentUserSelection ? [loggedInUser] : []\n    });\n  };\n\n  handleActualSearch = (query: string) => {\n    this.setState({ loading: true, query });\n    searchUsers({ q: query })\n      .then(result => {\n        if (this.mounted) {\n          this.setState({\n            loading: false,\n            query,\n            open: true,\n            suggestedUsers: result.users.filter(isUserActive) as T.UserActive[]\n          });\n        }\n      })\n      .catch(() => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      });\n  };\n\n  handleKeyDown = (event: React.KeyboardEvent) => {\n    switch (event.keyCode) {\n      case KeyCodes.Enter:\n        event.preventDefault();\n        this.selectHighlighted();\n        break;\n      case KeyCodes.UpArrow:\n        event.preventDefault();\n        this.highlightPrevious();\n        break;\n      case KeyCodes.DownArrow:\n        event.preventDefault();\n        this.highlightNext();\n        break;\n    }\n  };\n\n  getCurrentIndex = () => {\n    const { highlighted, suggestedUsers } = this.state;\n\n    return highlighted\n      ? suggestedUsers.findIndex(suggestion => suggestion.login === highlighted.login)\n      : -1;\n  };\n\n  highlightIndex = (index: number) => {\n    const { suggestedUsers } = this.state;\n\n    if (suggestedUsers.length > 0) {\n      if (index < 0) {\n        index = suggestedUsers.length - 1;\n      } else if (index >= suggestedUsers.length) {\n        index = 0;\n      }\n\n      this.setState({ highlighted: suggestedUsers[index] });\n    }\n  };\n\n  highlightPrevious = () => {\n    this.highlightIndex(this.getCurrentIndex() - 1);\n  };\n\n  highlightNext = () => {\n    this.highlightIndex(this.getCurrentIndex() + 1);\n  };\n\n  selectHighlighted = () => {\n    const { highlighted } = this.state;\n\n    if (highlighted !== undefined) {\n      this.props.onSelect(highlighted);\n    }\n  };\n\n  render() {\n    const { highlighted, loading, open, query, suggestedUsers } = this.state;\n\n    return (\n      <AssigneeSelectionRenderer\n        highlighted={highlighted}\n        loading={loading}\n        onKeyDown={this.handleKeyDown}\n        onSearch={this.handleSearch}\n        onSelect={this.props.onSelect}\n        open={open}\n        query={query}\n        suggestedUsers={suggestedUsers}\n      />\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nimport * as React from 'react';\nimport { EditButton } from 'sonar-ui-common/components/controls/buttons';\nimport EscKeydownHandler from 'sonar-ui-common/components/controls/EscKeydownHandler';\nimport OutsideClickHandler from 'sonar-ui-common/components/controls/OutsideClickHandler';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport AssigneeSelection from './AssigneeSelection';\n\nexport interface AssigneeRendererProps {\n  canEdit: boolean;\n  editing: boolean;\n  loading: boolean;\n\n  assignee?: T.UserBase;\n  loggedInUser?: T.LoggedInUser;\n\n  onAssign: (user?: T.UserActive) => void;\n  onEnterEditionMode: () => void;\n  onExitEditionMode: () => void;\n}\n\nexport default function AssigneeRenderer(props: AssigneeRendererProps) {\n  const { assignee, canEdit, loggedInUser, editing, loading } = props;\n\n  return (\n    <DeferredSpinner loading={loading}>\n      {!editing && (\n        <div className=\"display-flex-center\">\n          <strong className=\"nowrap\">\n            {assignee &&\n              (assignee.active\n                ? assignee.name ?? assignee.login\n                : translateWithParameters('user.x_deleted', assignee.name ?? assignee.login))}\n            {!assignee && translate('unassigned')}\n          </strong>\n          {loggedInUser && canEdit && (\n            <EditButton className=\"spacer-left\" onClick={props.onEnterEditionMode} />\n          )}\n        </div>\n      )}\n\n      {loggedInUser && editing && (\n        <EscKeydownHandler onKeydown={props.onExitEditionMode}>\n          <OutsideClickHandler onClickOutside={props.onExitEditionMode}>\n            <AssigneeSelection\n              allowCurrentUserSelection={loggedInUser.login !== assignee?.login}\n              loggedInUser={loggedInUser}\n              onSelect={props.onAssign}\n            />\n          </OutsideClickHandler>\n        </EscKeydownHandler>\n      )}\n    </DeferredSpinner>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nimport * as React from 'react';\nimport { translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { assignSecurityHotspot } from '../../../../api/security-hotspots';\nimport addGlobalSuccessMessage from '../../../../app/utils/addGlobalSuccessMessage';\nimport { withCurrentUser } from '../../../../components/hoc/withCurrentUser';\nimport { isLoggedIn } from '../../../../helpers/users';\nimport { Hotspot, HotspotStatus } from '../../../../types/security-hotspots';\nimport AssigneeRenderer from './AssigneeRenderer';\n\ninterface Props {\n  currentUser: T.CurrentUser;\n  hotspot: Hotspot;\n\n  onAssigneeChange: () => void;\n}\n\ninterface State {\n  editing: boolean;\n  loading: boolean;\n}\n\nexport class Assignee extends React.PureComponent<Props, State> {\n  mounted = false;\n  state = {\n    editing: false,\n    loading: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  handleEnterEditionMode = () => {\n    this.setState({ editing: true });\n  };\n\n  handleExitEditionMode = () => {\n    this.setState({ editing: false });\n  };\n\n  handleAssign = (newAssignee?: T.UserActive) => {\n    if (newAssignee && newAssignee.login) {\n      this.setState({ loading: true });\n      assignSecurityHotspot(this.props.hotspot.key, {\n        assignee: newAssignee.login\n      })\n        .then(() => {\n          if (this.mounted) {\n            this.setState({ editing: false, loading: false });\n            this.props.onAssigneeChange();\n          }\n        })\n        .then(() =>\n          addGlobalSuccessMessage(\n            translateWithParameters('hotspots.assign.success', newAssignee.name)\n          )\n        )\n        .catch(() => this.setState({ loading: false }));\n    }\n  };\n\n  render() {\n    const {\n      currentUser,\n      hotspot: { assigneeUser, status }\n    } = this.props;\n    const { editing, loading } = this.state;\n\n    const canEdit = status === HotspotStatus.TO_REVIEW;\n\n    return (\n      <AssigneeRenderer\n        assignee={assigneeUser}\n        canEdit={canEdit}\n        editing={editing}\n        loading={loading}\n        loggedInUser={isLoggedIn(currentUser) ? currentUser : undefined}\n        onAssign={this.handleAssign}\n        onEnterEditionMode={this.handleEnterEditionMode}\n        onExitEditionMode={this.handleExitEditionMode}\n      />\n    );\n  }\n}\n\nexport default withCurrentUser(Assignee);\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { getJSON, post } from 'sonar-ui-common/helpers/request';\nimport throwGlobalError from '../app/utils/throwGlobalError';\nimport { BranchParameters } from '../types/branch-like';\nimport {\n  Hotspot,\n  HotspotAssignRequest,\n  HotspotComment,\n  HotspotResolution,\n  HotspotSearchResponse,\n  HotspotSetStatusRequest,\n  HotspotStatus\n} from '../types/security-hotspots';\n\nexport function assignSecurityHotspot(\n  hotspotKey: string,\n  data: HotspotAssignRequest\n): Promise<void> {\n  return post('/api/hotspots/assign', { hotspot: hotspotKey, ...data }).catch(throwGlobalError);\n}\n\nexport function setSecurityHotspotStatus(\n  hotspotKey: string,\n  data: HotspotSetStatusRequest\n): Promise<void> {\n  return post('/api/hotspots/change_status', { hotspot: hotspotKey, ...data }).catch(\n    throwGlobalError\n  );\n}\n\nexport function commentSecurityHotspot(hotspotKey: string, comment: string): Promise<void> {\n  return post('/api/hotspots/add_comment', { hotspot: hotspotKey, comment }).catch(\n    throwGlobalError\n  );\n}\n\nexport function deleteSecurityHotspotComment(commentKey: string): Promise<void> {\n  return post('/api/hotspots/delete_comment', { comment: commentKey }).catch(throwGlobalError);\n}\n\nexport function editSecurityHotspotComment(\n  commentKey: string,\n  comment: string\n): Promise<HotspotComment> {\n  return post('/api/hotspots/edit_comment', { comment: commentKey, text: comment }).catch(\n    throwGlobalError\n  );\n}\n\nexport function getSecurityHotspots(\n  data: {\n    projectKey: string;\n    p: number;\n    ps: number;\n    status?: HotspotStatus;\n    resolution?: HotspotResolution;\n    onlyMine?: boolean;\n    sinceLeakPeriod?: boolean;\n  } & BranchParameters\n): Promise<HotspotSearchResponse> {\n  return getJSON('/api/hotspots/search', data).catch(throwGlobalError);\n}\n\nexport function getSecurityHotspotList(\n  hotspotKeys: string[],\n  data: {\n    projectKey: string;\n  } & BranchParameters\n): Promise<HotspotSearchResponse> {\n  return getJSON('/api/hotspots/search', { ...data, hotspots: hotspotKeys.join() }).catch(\n    throwGlobalError\n  );\n}\n\nexport function getSecurityHotspotDetails(securityHotspotKey: string): Promise<Hotspot> {\n  return getJSON('/api/hotspots/show', { hotspot: securityHotspotKey })\n    .then((response: Hotspot & { users: T.UserBase[] }) => {\n      const { users, ...hotspot } = response;\n\n      if (users) {\n        if (hotspot.assignee) {\n          hotspot.assigneeUser = users.find(u => u.login === hotspot.assignee) || {\n            active: true,\n            login: hotspot.assignee\n          };\n        }\n        hotspot.authorUser = users.find(u => u.login === hotspot.author) || {\n          active: true,\n          login: hotspot.author\n        };\n        hotspot.comment.forEach(c => {\n          c.user = users.find(u => u.login === c.login) || { active: true, login: c.login };\n        });\n      }\n\n      return hotspot;\n    })\n    .catch(throwGlobalError);\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Button, ResetButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport MarkdownTips from '../../../components/common/MarkdownTips';\n\nexport interface HotspotCommentPopupProps {\n  markdownComment: string;\n  onCommentEditSubmit: (comment: string) => void;\n  onCancelEdit: () => void;\n}\n\nexport default function HotspotCommentPopup(props: HotspotCommentPopupProps) {\n  const [comment, setComment] = React.useState(props.markdownComment);\n\n  return (\n    <div className=\"issue-comment-bubble-popup\">\n      <div className=\"issue-comment-form-text\">\n        <textarea\n          autoFocus={true}\n          onChange={event => setComment(event.target.value)}\n          rows={2}\n          value={comment}\n        />\n      </div>\n      <div className=\"spacer-top display-flex-space-between\">\n        <div className=\"issue-comment-form-tips\">\n          <MarkdownTips />\n        </div>\n        <div className=\"\">\n          <Button\n            className=\"little-spacer-right\"\n            onClick={() => props.onCommentEditSubmit(comment)}>\n            {translate('save')}\n          </Button>\n          <ResetButtonLink\n            onClick={() => {\n              setComment('');\n              props.onCancelEdit();\n            }}>\n            {translate('cancel')}\n          </ResetButtonLink>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { sanitize } from 'dompurify';\nimport * as React from 'react';\nimport { Button, DeleteButton, EditButton } from 'sonar-ui-common/components/controls/buttons';\nimport Dropdown, { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport DateTimeFormatter from 'sonar-ui-common/components/intl/DateTimeFormatter';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport IssueChangelogDiff from '../../../components/issue/components/IssueChangelogDiff';\nimport Avatar from '../../../components/ui/Avatar';\nimport { Hotspot, ReviewHistoryType } from '../../../types/security-hotspots';\nimport { getHotspotReviewHistory } from '../utils';\nimport HotspotCommentPopup from './HotspotCommentPopup';\n\nexport interface HotspotReviewHistoryProps {\n  hotspot: Hotspot;\n  onDeleteComment: (key: string) => void;\n  onEditComment: (key: string, comment: string) => void;\n}\n\nexport default function HotspotReviewHistory(props: HotspotReviewHistoryProps) {\n  const { hotspot } = props;\n  const reviewHistory = getHotspotReviewHistory(hotspot);\n  const [editedCommentKey, setEditedCommentKey] = React.useState('');\n\n  return (\n    <>\n      {reviewHistory.map((historyElt, historyIndex) => {\n        const { user, type, diffs, date, html, key, updatable, markdown } = historyElt;\n        return (\n          <div\n            className={classNames('padded', { 'bordered-top': historyIndex > 0 })}\n            key={historyIndex}>\n            <div className=\"display-flex-center\">\n              {user.name && (\n                <>\n                  <Avatar\n                    className=\"little-spacer-right\"\n                    hash={user.avatar}\n                    name={user.name}\n                    size={20}\n                  />\n                  <strong>\n                    {user.active ? user.name : translateWithParameters('user.x_deleted', user.name)}\n                  </strong>\n                  {type === ReviewHistoryType.Creation && (\n                    <span className=\"little-spacer-left\">\n                      {translate('hotspots.review_history.created')}\n                    </span>\n                  )}\n                  {type === ReviewHistoryType.Comment && (\n                    <span className=\"little-spacer-left\">\n                      {translate('hotspots.review_history.comment_added')}\n                    </span>\n                  )}\n                  <span className=\"little-spacer-left little-spacer-right\">-</span>\n                </>\n              )}\n              <DateTimeFormatter date={date} />\n            </div>\n\n            {type === ReviewHistoryType.Diff && diffs && (\n              <div className=\"spacer-top\">\n                {diffs.map((diff, diffIndex) => (\n                  <IssueChangelogDiff diff={diff} key={diffIndex} />\n                ))}\n              </div>\n            )}\n\n            {type === ReviewHistoryType.Comment && key && html && markdown && (\n              <div className=\"spacer-top display-flex-space-between\">\n                <div className=\"markdown\" dangerouslySetInnerHTML={{ __html: sanitize(html) }} />\n                {updatable && (\n                  <div>\n                    <div className=\"dropdown\">\n                      <Toggler\n                        onRequestClose={() => {\n                          setEditedCommentKey('');\n                        }}\n                        open={key === editedCommentKey}\n                        overlay={\n                          <DropdownOverlay placement={PopupPlacement.BottomRight}>\n                            <HotspotCommentPopup\n                              markdownComment={markdown}\n                              onCancelEdit={() => setEditedCommentKey('')}\n                              onCommentEditSubmit={comment => {\n                                setEditedCommentKey('');\n                                props.onEditComment(key, comment);\n                              }}\n                            />\n                          </DropdownOverlay>\n                        }>\n                        <EditButton\n                          className=\"it__hotspots-comment-edit button-small\"\n                          onClick={() => setEditedCommentKey(key)}\n                        />\n                      </Toggler>\n                    </div>\n                    <Dropdown\n                      onOpen={() => setEditedCommentKey('')}\n                      overlay={\n                        <div className=\"padded abs-width-150\">\n                          <p>{translate('issue.comment.delete_confirm_message')}</p>\n                          <Button\n                            className=\"button-red big-spacer-top pull-right\"\n                            onClick={() => props.onDeleteComment(key)}>\n                            {translate('delete')}\n                          </Button>\n                        </div>\n                      }\n                      overlayPlacement={PopupPlacement.BottomRight}>\n                      <DeleteButton className=\"it__hotspots-comment-delete button-small\" />\n                    </Dropdown>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        );\n      })}\n    </>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { Button, ResetButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport {\n  commentSecurityHotspot,\n  deleteSecurityHotspotComment,\n  editSecurityHotspotComment\n} from '../../../api/security-hotspots';\nimport MarkdownTips from '../../../components/common/MarkdownTips';\nimport { isLoggedIn } from '../../../helpers/users';\nimport { Hotspot } from '../../../types/security-hotspots';\nimport HotspotReviewHistory from './HotspotReviewHistory';\n\ninterface Props {\n  currentUser: T.CurrentUser;\n  hotspot: Hotspot;\n  commentTextRef: React.RefObject<HTMLTextAreaElement>;\n  commentVisible: boolean;\n  onCommentUpdate: () => void;\n  onOpenComment: () => void;\n  onCloseComment: () => void;\n}\n\ninterface State {\n  comment: string;\n}\n\nexport default class HotspotReviewHistoryAndComments extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      comment: ''\n    };\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.hotspot !== this.props.hotspot) {\n      this.setState({\n        comment: ''\n      });\n    }\n  }\n\n  handleCommentChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    this.setState({ comment: event.target.value });\n  };\n\n  handleCloseComment = () => {\n    this.setState({ comment: '' });\n    this.props.onCloseComment();\n  };\n\n  handleSubmitComment = () => {\n    return commentSecurityHotspot(this.props.hotspot.key, this.state.comment).then(() => {\n      this.setState({ comment: '' });\n      this.props.onCloseComment();\n      this.props.onCommentUpdate();\n    });\n  };\n\n  handleDeleteComment = (key: string) => {\n    return deleteSecurityHotspotComment(key).then(() => {\n      this.props.onCommentUpdate();\n    });\n  };\n\n  handleEditComment = (key: string, comment: string) => {\n    return editSecurityHotspotComment(key, comment).then(() => {\n      this.props.onCommentUpdate();\n    });\n  };\n\n  render() {\n    const { currentUser, hotspot, commentTextRef, commentVisible } = this.props;\n    const { comment } = this.state;\n    return (\n      <>\n        <h1>{translate('hotspot.section.activity')}</h1>\n        <div className=\"padded\">\n          <HotspotReviewHistory\n            hotspot={hotspot}\n            onDeleteComment={this.handleDeleteComment}\n            onEditComment={this.handleEditComment}\n          />\n\n          {isLoggedIn(currentUser) && (\n            <>\n              <hr />\n              <div className=\"big-spacer-top\">\n                <Button\n                  className={classNames({ invisible: commentVisible })}\n                  id=\"hotspot-comment-box-display\"\n                  onClick={this.props.onOpenComment}>\n                  {translate('hotspots.comment.open')}\n                </Button>\n\n                <div className={classNames({ invisible: !commentVisible })}>\n                  <div className=\"little-spacer-bottom\">{translate('hotspots.comment.field')}</div>\n                  <textarea\n                    className=\"form-field fixed-width width-100 spacer-bottom\"\n                    onChange={this.handleCommentChange}\n                    ref={commentTextRef}\n                    rows={2}\n                    value={comment}\n                  />\n                  <div className=\"display-flex-space-between display-flex-center \">\n                    <MarkdownTips className=\"huge-spacer-bottom\" />\n                    <div>\n                      <Button\n                        className=\"huge-spacer-bottom\"\n                        id=\"hotspot-comment-box-submit\"\n                        onClick={this.handleSubmitComment}>\n                        {translate('hotspots.comment.submit')}\n                      </Button>\n                      <ResetButtonLink\n                        className=\"spacer-left huge-spacer-bottom\"\n                        id=\"hotspot-comment-box-cancel\"\n                        onClick={this.handleCloseComment}>\n                        {translate('cancel')}\n                      </ResetButtonLink>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { BranchLike } from '../../../types/branch-like';\nimport { Hotspot } from '../../../types/security-hotspots';\nimport SnippetViewer from '../../issues/crossComponentSourceViewer/SnippetViewer';\n\nexport interface HotspotSnippetContainerRendererProps {\n  branchLike?: BranchLike;\n  displayProjectName?: boolean;\n  highlightedSymbols: string[];\n  hotspot: Hotspot;\n  lastLine?: number;\n  loading: boolean;\n  locations: { [line: number]: T.LinearIssueLocation[] };\n  linePopup?: T.LinePopup & { component: string };\n  onExpandBlock: (direction: T.ExpandDirection) => Promise<void>;\n  onLinePopupToggle: (line: T.SourceLine) => void;\n  onSymbolClick: (symbols: string[]) => void;\n  sourceLines: T.SourceLine[];\n  sourceViewerFile: T.SourceViewerFile;\n}\n\nconst noop = () => undefined;\n\nexport default function HotspotSnippetContainerRenderer(\n  props: HotspotSnippetContainerRendererProps\n) {\n  const {\n    branchLike,\n    displayProjectName,\n    highlightedSymbols,\n    hotspot,\n    linePopup,\n    loading,\n    locations,\n    sourceLines,\n    sourceViewerFile\n  } = props;\n\n  return (\n    <div className=\"bordered big-spacer-bottom\">\n      <SourceViewerHeaderSlim\n        branchLike={branchLike}\n        expandable={false}\n        displayProjectName={displayProjectName}\n        linkToProject={false}\n        loading={loading}\n        onExpand={noop}\n        sourceViewerFile={sourceViewerFile}\n      />\n      <DeferredSpinner loading={loading}>\n        {sourceLines.length > 0 && (\n          <SourceViewerContext.Provider /* Used by LineOptionsPopup */\n            value={{ branchLike, file: sourceViewerFile }}>\n            <SnippetViewer\n              branchLike={branchLike}\n              component={sourceViewerFile}\n              displaySCM={false}\n              expandBlock={(_i, direction) => props.onExpandBlock(direction)}\n              handleCloseIssues={noop}\n              handleLinePopupToggle={props.onLinePopupToggle}\n              handleOpenIssues={noop}\n              handleSymbolClick={props.onSymbolClick}\n              highlightedLocationMessage={undefined}\n              highlightedSymbols={highlightedSymbols}\n              index={0}\n              issue={hotspot}\n              issuesByLine={{}}\n              lastSnippetOfLastGroup={false}\n              linePopup={linePopup}\n              loadDuplications={noop}\n              locations={[]}\n              locationsByLine={locations}\n              onIssueChange={noop}\n              onIssuePopupToggle={noop}\n              onLocationSelect={noop}\n              openIssuesByLine={{}}\n              renderDuplicationPopup={noop}\n              snippet={sourceLines}\n            />\n          </SourceViewerContext.Provider>\n        )}\n      </DeferredSpinner>\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport { ComponentQualifier } from '../../../types/component';\nimport { Hotspot } from '../../../types/security-hotspots';\nimport { constructSourceViewerFile } from '../utils';\nimport HotspotSnippetContainerRenderer from './HotspotSnippetContainerRenderer';\n\ninterface Props {\n  branchLike?: BranchLike;\n  component: T.Component;\n  hotspot: Hotspot;\n}\n\ninterface State {\n  highlightedSymbols: string[];\n  lastLine?: number;\n  loading: boolean;\n  linePopup?: T.LinePopup & { component: string };\n  sourceLines: T.SourceLine[];\n}\n\nconst BUFFER_LINES = 5;\nconst EXPAND_BY_LINES = 50;\n\nexport default class HotspotSnippetContainer extends React.Component<Props, State> {\n  mounted = false;\n  state: State = {\n    highlightedSymbols: [],\n    loading: true,\n    sourceLines: []\n  };\n\n  componentWillMount() {\n    this.mounted = true;\n    this.fetchSources();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.hotspot.key !== this.props.hotspot.key) {\n      this.fetchSources();\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  checkLastLine(lines: T.SourceLine[], target: number): number | undefined {\n    if (lines.length < 1) {\n      return undefined;\n    }\n    const lastLineReceived = lines[lines.length - 1].line;\n    if (lastLineReceived < target) {\n      return lastLineReceived;\n    }\n    return undefined;\n  }\n\n  fetchSources() {\n    const {\n      branchLike,\n      hotspot: { component, textRange }\n    } = this.props;\n\n    const from = Math.max(1, textRange.startLine - BUFFER_LINES);\n    // Add 1 to check for end-of-file:\n    const to = textRange.endLine + BUFFER_LINES + 1;\n\n    this.setState({ loading: true });\n    return getSources({ key: component.key, from, to, ...getBranchLikeQuery(branchLike) })\n      .then(sourceLines => {\n        if (this.mounted) {\n          const lastLine = this.checkLastLine(sourceLines, to);\n\n          // remove extra sourceline if we didn't reach the end:\n          sourceLines = lastLine ? sourceLines : sourceLines.slice(0, -1);\n          this.setState({ lastLine, loading: false, sourceLines });\n        }\n      })\n      .catch(() => this.mounted && this.setState({ loading: false }));\n  }\n\n  handleExpansion = (direction: T.ExpandDirection) => {\n    const { branchLike, hotspot } = this.props;\n    const { sourceLines } = this.state;\n\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, sourceLines[0].line - EXPAND_BY_LINES),\n            to: sourceLines[0].line - 1\n          }\n        : {\n            from: sourceLines[sourceLines.length - 1].line + 1,\n            // Add 1 to check for end-of-file:\n            to: sourceLines[sourceLines.length - 1].line + EXPAND_BY_LINES + 1\n          };\n\n    return getSources({\n      key: hotspot.component.key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    }).then(additionalLines => {\n      const lastLine =\n        direction === 'down' ? this.checkLastLine(additionalLines, range.to) : undefined;\n\n      let concatSourceLines;\n      if (direction === 'up') {\n        concatSourceLines = additionalLines.concat(sourceLines);\n      } else {\n        // remove extra sourceline if we didn't reach the end:\n        concatSourceLines = sourceLines.concat(\n          lastLine ? additionalLines : additionalLines.slice(0, -1)\n        );\n      }\n\n      this.setState({\n        lastLine,\n        sourceLines: concatSourceLines\n      });\n    });\n  };\n\n  handleLinePopupToggle = (params: T.LinePopup & { component: string }) => {\n    const { component, index, line, name, open } = params;\n    this.setState((state: State) => {\n      const samePopup =\n        state.linePopup !== undefined &&\n        state.linePopup.line === line &&\n        state.linePopup.name === name &&\n        state.linePopup.component === component &&\n        state.linePopup.index === index;\n      if (open !== false && !samePopup) {\n        return { linePopup: params };\n      } else if (open !== true && samePopup) {\n        return { linePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleSymbolClick = (highlightedSymbols: string[]) => {\n    this.setState({ highlightedSymbols });\n  };\n\n  render() {\n    const { branchLike, component, hotspot } = this.props;\n    const { highlightedSymbols, lastLine, linePopup, loading, sourceLines } = this.state;\n\n    const locations = locationsByLine([hotspot]);\n\n    const sourceViewerFile = constructSourceViewerFile(hotspot, lastLine);\n\n    return (\n      <HotspotSnippetContainerRenderer\n        branchLike={branchLike}\n        displayProjectName={component.qualifier === ComponentQualifier.Application}\n        highlightedSymbols={highlightedSymbols}\n        hotspot={hotspot}\n        lastLine={lastLine}\n        linePopup={linePopup}\n        loading={loading}\n        locations={locations}\n        onExpandBlock={this.handleExpansion}\n        onLinePopupToggle={this.handleLinePopupToggle}\n        onSymbolClick={this.handleSymbolClick}\n        sourceLines={sourceLines}\n        sourceViewerFile={sourceViewerFile}\n      />\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { sanitize } from 'dompurify';\nimport * as React from 'react';\nimport BoxedTabs from 'sonar-ui-common/components/controls/BoxedTabs';\nimport Tab from 'sonar-ui-common/components/controls/Tabs';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { Hotspot } from '../../../types/security-hotspots';\n\ninterface Props {\n  hotspot: Hotspot;\n}\n\ninterface State {\n  currentTab: Tab;\n  tabs: Tab[];\n}\n\ninterface Tab {\n  key: TabKeys;\n  label: React.ReactNode;\n  content: string;\n}\n\nexport enum TabKeys {\n  RiskDescription = 'risk',\n  VulnerabilityDescription = 'vulnerability',\n  FixRecommendation = 'fix'\n}\n\nexport default class HotspotViewerTabs extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    const tabs = this.computeTabs();\n    this.state = {\n      currentTab: tabs[0],\n      tabs\n    };\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (this.props.hotspot.key !== prevProps.hotspot.key) {\n      const tabs = this.computeTabs();\n      this.setState({\n        currentTab: tabs[0],\n        tabs\n      });\n    }\n  }\n\n  handleSelectTabs = (tabKey: TabKeys) => {\n    const { tabs } = this.state;\n    const currentTab = tabs.find(tab => tab.key === tabKey)!;\n    this.setState({ currentTab });\n  };\n\n  computeTabs() {\n    const { hotspot } = this.props;\n    return [\n      {\n        key: TabKeys.RiskDescription,\n        label: translate('hotspots.tabs.risk_description'),\n        content: hotspot.rule.riskDescription || ''\n      },\n      {\n        key: TabKeys.VulnerabilityDescription,\n        label: translate('hotspots.tabs.vulnerability_description'),\n        content: hotspot.rule.vulnerabilityDescription || ''\n      },\n      {\n        key: TabKeys.FixRecommendation,\n        label: translate('hotspots.tabs.fix_recommendations'),\n        content: hotspot.rule.fixRecommendations || ''\n      }\n    ].filter(tab => Boolean(tab.content));\n  }\n\n  render() {\n    const { tabs, currentTab } = this.state;\n    if (tabs.length === 0) {\n      return null;\n    }\n\n    return (\n      <>\n        <BoxedTabs onSelect={this.handleSelectTabs} selected={currentTab.key} tabs={tabs} />\n        <div className=\"bordered huge-spacer-bottom\">\n          <div\n            className=\"markdown big-padded\"\n            dangerouslySetInnerHTML={{ __html: sanitize(currentTab.content) }}\n          />\n        </div>\n      </>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { HotspotStatusOption } from '../../../../types/security-hotspots';\n\nexport interface StatusDescriptionProps {\n  statusOption: HotspotStatusOption;\n  showTitle?: boolean;\n}\n\nexport default function StatusDescription(props: StatusDescriptionProps) {\n  const { statusOption, showTitle } = props;\n\n  return (\n    <div>\n      <h3>\n        {showTitle && `${translate('status')}: `}\n        {translate('hotspots.status_option', statusOption)}\n      </h3>\n      <span>{translate('hotspots.status_option', statusOption, 'description')}</span>\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nimport * as React from 'react';\nimport { SubmitButton } from 'sonar-ui-common/components/controls/buttons';\nimport Radio from 'sonar-ui-common/components/controls/Radio';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport MarkdownTips from '../../../../components/common/MarkdownTips';\nimport { HotspotStatusOption } from '../../../../types/security-hotspots';\nimport StatusDescription from './StatusDescription';\n\nexport interface StatusSelectionRendererProps {\n  selectedStatus: HotspotStatusOption;\n  onStatusChange: (statusOption: HotspotStatusOption) => void;\n\n  comment?: string;\n  onCommentChange: (comment: string) => void;\n\n  onSubmit: () => void;\n\n  loading: boolean;\n  submitDisabled: boolean;\n}\n\nexport default function StatusSelectionRenderer(props: StatusSelectionRendererProps) {\n  const { comment, loading, selectedStatus, submitDisabled } = props;\n\n  const renderOption = (status: HotspotStatusOption) => {\n    return (\n      <Radio\n        checked={selectedStatus === status}\n        className=\"big-spacer-bottom\"\n        onCheck={props.onStatusChange}\n        value={status}>\n        <StatusDescription statusOption={status} />\n      </Radio>\n    );\n  };\n\n  return (\n    <>\n      <div className=\"big-padded\">\n        {renderOption(HotspotStatusOption.TO_REVIEW)}\n        {renderOption(HotspotStatusOption.FIXED)}\n        {renderOption(HotspotStatusOption.SAFE)}\n      </div>\n\n      <hr />\n      <div className=\"big-padded display-flex-column\">\n        <label className=\"text-bold\" htmlFor=\"comment-textarea\">\n          {translate('hotspots.status.add_comment')}\n        </label>\n        <textarea\n          className=\"spacer-top form-field fixed-width spacer-bottom\"\n          id=\"comment-textarea\"\n          onChange={(event: React.ChangeEvent<HTMLTextAreaElement>) =>\n            props.onCommentChange(event.currentTarget.value)\n          }\n          rows={4}\n          value={comment}\n        />\n        <MarkdownTips />\n\n        <div className=\"big-spacer-top display-flex-justify-end display-flex-center\">\n          <SubmitButton disabled={submitDisabled || loading} onClick={props.onSubmit}>\n            {translate('hotspots.status.change_status')}\n          </SubmitButton>\n\n          {loading && <i className=\"spacer-left spinner\" />}\n        </div>\n      </div>\n    </>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { setSecurityHotspotStatus } from '../../../../api/security-hotspots';\nimport addGlobalSuccessMessage from '../../../../app/utils/addGlobalSuccessMessage';\nimport { Hotspot, HotspotStatusOption } from '../../../../types/security-hotspots';\nimport {\n  getStatusAndResolutionFromStatusOption,\n  getStatusOptionFromStatusAndResolution\n} from '../../utils';\nimport StatusSelectionRenderer from './StatusSelectionRenderer';\n\ninterface Props {\n  hotspot: Hotspot;\n  onStatusOptionChange: (statusOption: HotspotStatusOption) => void;\n}\n\ninterface State {\n  comment?: string;\n  loading: boolean;\n  initialStatus: HotspotStatusOption;\n  selectedStatus: HotspotStatusOption;\n}\n\nexport default class StatusSelection extends React.PureComponent<Props, State> {\n  mounted = false;\n\n  constructor(props: Props) {\n    super(props);\n\n    const initialStatus = getStatusOptionFromStatusAndResolution(\n      props.hotspot.status,\n      props.hotspot.resolution\n    );\n\n    this.state = {\n      loading: false,\n      initialStatus,\n      selectedStatus: initialStatus\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  handleStatusChange = (selectedStatus: HotspotStatusOption) => {\n    this.setState({ selectedStatus });\n  };\n\n  handleCommentChange = (comment: string) => {\n    this.setState({ comment });\n  };\n\n  handleSubmit = () => {\n    const { hotspot } = this.props;\n    const { comment, initialStatus, selectedStatus } = this.state;\n\n    if (selectedStatus && selectedStatus !== initialStatus) {\n      this.setState({ loading: true });\n      setSecurityHotspotStatus(hotspot.key, {\n        ...getStatusAndResolutionFromStatusOption(selectedStatus),\n        comment: comment || undefined\n      })\n        .then(() => {\n          this.setState({ loading: false });\n          this.props.onStatusOptionChange(selectedStatus);\n        })\n        .then(() =>\n          addGlobalSuccessMessage(\n            translateWithParameters(\n              'hotspots.update.success',\n              translate('hotspots.status_option', selectedStatus)\n            )\n          )\n        )\n        .catch(() => this.setState({ loading: false }));\n    }\n  };\n\n  render() {\n    const { comment, initialStatus, loading, selectedStatus } = this.state;\n    const submitDisabled = selectedStatus === initialStatus;\n\n    return (\n      <StatusSelectionRenderer\n        comment={comment}\n        loading={loading}\n        onCommentChange={this.handleCommentChange}\n        onStatusChange={this.handleStatusChange}\n        onSubmit={this.handleSubmit}\n        selectedStatus={selectedStatus}\n        submitDisabled={submitDisabled}\n      />\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport ChevronDownIcon from 'sonar-ui-common/components/icons/ChevronDownIcon';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { withCurrentUser } from '../../../../components/hoc/withCurrentUser';\nimport { isLoggedIn } from '../../../../helpers/users';\nimport { Hotspot } from '../../../../types/security-hotspots';\nimport { getStatusOptionFromStatusAndResolution } from '../../utils';\nimport './Status.css';\nimport StatusDescription from './StatusDescription';\nimport StatusSelection from './StatusSelection';\n\nexport interface StatusProps {\n  currentUser: T.CurrentUser;\n  hotspot: Hotspot;\n\n  onStatusChange: () => void;\n}\n\nexport function Status(props: StatusProps) {\n  const { currentUser, hotspot } = props;\n  const [isOpen, setIsOpen] = React.useState(false);\n\n  const statusOption = getStatusOptionFromStatusAndResolution(hotspot.status, hotspot.resolution);\n  const readonly = !hotspot.canChangeStatus || !isLoggedIn(currentUser);\n\n  const trigger = (\n    <div\n      aria-expanded={isOpen}\n      aria-haspopup={true}\n      className={classNames('padded bordered display-flex-column display-flex-justify-center', {\n        readonly\n      })}\n      id=\"status-trigger\"\n      onClick={() => !readonly && setIsOpen(true)}\n      role=\"button\"\n      tabIndex={0}>\n      <div className=\"display-flex-center display-flex-space-between\">\n        {isOpen ? (\n          <span className=\"h3\">{translate('hotspots.status.select_status')}</span>\n        ) : (\n          <StatusDescription showTitle={true} statusOption={statusOption} />\n        )}\n        {!readonly && <ChevronDownIcon className=\"big-spacer-left\" />}\n      </div>\n    </div>\n  );\n\n  const actionableTrigger = (\n    <Toggler\n      closeOnClickOutside={true}\n      closeOnEscape={true}\n      onRequestClose={() => setIsOpen(false)}\n      open={isOpen}\n      overlay={\n        <DropdownOverlay noPadding={true} placement={PopupPlacement.Bottom}>\n          <StatusSelection\n            hotspot={hotspot}\n            onStatusOptionChange={() => {\n              setIsOpen(false);\n              props.onStatusChange();\n            }}\n          />\n        </DropdownOverlay>\n      }>\n      {trigger}\n    </Toggler>\n  );\n\n  return (\n    <div className=\"dropdown\">\n      {readonly ? (\n        <Tooltip overlay={translate('hotspots.status.cannot_change_status')} placement=\"bottom\">\n          {trigger}\n        </Tooltip>\n      ) : (\n        actionableTrigger\n      )}\n    </div>\n  );\n}\n\nexport default withCurrentUser(Status);\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { Button } from 'sonar-ui-common/components/controls/buttons';\nimport { ClipboardButton } from 'sonar-ui-common/components/controls/clipboard';\nimport LinkIcon from 'sonar-ui-common/components/icons/LinkIcon';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getPathUrlAsString } from 'sonar-ui-common/helpers/urls';\nimport { withCurrentUser } from '../../../components/hoc/withCurrentUser';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { getComponentSecurityHotspotsUrl } from '../../../helpers/urls';\nimport { isLoggedIn } from '../../../helpers/users';\nimport { BranchLike } from '../../../types/branch-like';\nimport { Hotspot } from '../../../types/security-hotspots';\nimport Assignee from './assignee/Assignee';\nimport HotspotReviewHistoryAndComments from './HotspotReviewHistoryAndComments';\nimport HotspotSnippetContainer from './HotspotSnippetContainer';\nimport './HotspotViewer.css';\nimport HotspotViewerTabs from './HotspotViewerTabs';\nimport Status from './status/Status';\n\nexport interface HotspotViewerRendererProps {\n  branchLike?: BranchLike;\n  component: T.Component;\n  currentUser: T.CurrentUser;\n  hotspot?: Hotspot;\n  loading: boolean;\n  commentVisible: boolean;\n  commentTextRef: React.RefObject<HTMLTextAreaElement>;\n  onOpenComment: () => void;\n  onCloseComment: () => void;\n  onUpdateHotspot: () => Promise<void>;\n  parentScrollRef: React.RefObject<HTMLDivElement>;\n  securityCategories: T.StandardSecurityCategories;\n}\n\nexport function HotspotViewerRenderer(props: HotspotViewerRendererProps) {\n  const {\n    branchLike,\n    component,\n    currentUser,\n    hotspot,\n    loading,\n    securityCategories,\n    commentTextRef,\n    commentVisible,\n    parentScrollRef\n  } = props;\n\n  const permalink = getPathUrlAsString(\n    getComponentSecurityHotspotsUrl(component.key, {\n      ...getBranchLikeQuery(branchLike),\n      hotspots: hotspot?.key\n    }),\n    false\n  );\n\n  return (\n    <DeferredSpinner loading={loading}>\n      {hotspot && (\n        <div className=\"big-padded hotspot-content\" ref={parentScrollRef}>\n          <div className=\"huge-spacer-bottom display-flex-space-between\">\n            <strong className=\"big big-spacer-right\">{hotspot.message}</strong>\n            <div className=\"display-flex-row flex-0\">\n              {isLoggedIn(currentUser) && (\n                <div className=\"dropdown spacer-right flex-1-0-auto\">\n                  <Button onClick={props.onOpenComment}>\n                    {translate('hotspots.comment.open')}\n                  </Button>\n                </div>\n              )}\n              <ClipboardButton className=\"flex-1-0-auto\" copyValue={permalink}>\n                <LinkIcon className=\"spacer-right\" />\n                <span>{translate('hotspots.get_permalink')}</span>\n              </ClipboardButton>\n            </div>\n          </div>\n\n          <div className=\"huge-spacer-bottom display-flex-row\">\n            <div className=\"hotspot-information display-flex-column display-flex-space-between\">\n              <div className=\"display-flex-center\">\n                <span className=\"big-spacer-right\">{translate('category')}</span>\n                <strong className=\"nowrap\">\n                  {securityCategories[hotspot.rule.securityCategory].title}\n                </strong>\n              </div>\n              <div className=\"display-flex-center\">\n                <span className=\"big-spacer-right\">{translate('hotspots.risk_exposure')}</span>\n                <div\n                  className={classNames(\n                    'hotspot-risk-badge',\n                    hotspot.rule.vulnerabilityProbability\n                  )}>\n                  {translate('risk_exposure', hotspot.rule.vulnerabilityProbability)}\n                </div>\n              </div>\n              <div className=\"display-flex-center\">\n                <span className=\"big-spacer-right\">{translate('assignee')}</span>\n                <div>\n                  <Assignee hotspot={hotspot} onAssigneeChange={props.onUpdateHotspot} />\n                </div>\n              </div>\n            </div>\n            <div className=\"huge-spacer-left\">\n              <Status hotspot={hotspot} onStatusChange={props.onUpdateHotspot} />\n            </div>\n          </div>\n\n          <HotspotSnippetContainer\n            branchLike={branchLike}\n            component={component}\n            hotspot={hotspot}\n          />\n          <HotspotViewerTabs hotspot={hotspot} />\n          <HotspotReviewHistoryAndComments\n            commentTextRef={commentTextRef}\n            commentVisible={commentVisible}\n            currentUser={currentUser}\n            hotspot={hotspot}\n            onCloseComment={props.onCloseComment}\n            onCommentUpdate={props.onUpdateHotspot}\n            onOpenComment={props.onOpenComment}\n          />\n        </div>\n      )}\n    </DeferredSpinner>\n  );\n}\n\nexport default withCurrentUser(HotspotViewerRenderer);\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nimport * as React from 'react';\nimport { scrollToElement } from 'sonar-ui-common/helpers/scrolling';\nimport { getSecurityHotspotDetails } from '../../../api/security-hotspots';\nimport { BranchLike } from '../../../types/branch-like';\nimport { Hotspot } from '../../../types/security-hotspots';\nimport HotspotViewerRenderer from './HotspotViewerRenderer';\n\ninterface Props {\n  branchLike?: BranchLike;\n  component: T.Component;\n  hotspotKey: string;\n  onUpdateHotspot: (hotspotKey: string) => Promise<void>;\n  securityCategories: T.StandardSecurityCategories;\n}\n\ninterface State {\n  hotspot?: Hotspot;\n  loading: boolean;\n  commentVisible: boolean;\n}\n\nexport default class HotspotViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State;\n  commentTextRef: React.RefObject<HTMLTextAreaElement>;\n  parentScrollRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.commentTextRef = React.createRef<HTMLTextAreaElement>();\n    this.parentScrollRef = React.createRef<HTMLDivElement>();\n    this.state = { loading: false, commentVisible: false };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchHotspot();\n  }\n\n  componentDidUpdate(prevProps: Props, prevState: State) {\n    if (prevProps.hotspotKey !== this.props.hotspotKey) {\n      this.fetchHotspot();\n    }\n    if (this.commentTextRef.current && !prevState.commentVisible && this.state.commentVisible) {\n      this.commentTextRef.current.focus({ preventScroll: true });\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchHotspot = () => {\n    this.setState({ loading: true });\n    return getSecurityHotspotDetails(this.props.hotspotKey)\n      .then(hotspot => {\n        if (this.mounted) {\n          this.setState({ hotspot, loading: false });\n        }\n        return hotspot;\n      })\n      .catch(() => this.mounted && this.setState({ loading: false }));\n  };\n\n  handleHotspotUpdate = () => {\n    return this.fetchHotspot().then((hotspot?: Hotspot) => {\n      if (hotspot) {\n        return this.props.onUpdateHotspot(hotspot.key);\n      }\n    });\n  };\n\n  handleOpenComment = () => {\n    this.setState({ commentVisible: true });\n    if (this.commentTextRef.current) {\n      // Edge case when the comment is already open and unfocus.\n      this.commentTextRef.current.focus({ preventScroll: true });\n    }\n    if (this.commentTextRef.current && this.parentScrollRef.current) {\n      scrollToElement(this.commentTextRef.current, {\n        parent: this.parentScrollRef.current,\n        bottomOffset: 100\n      });\n    }\n  };\n\n  handleCloseComment = () => {\n    this.setState({ commentVisible: false });\n  };\n\n  render() {\n    const { branchLike, component, securityCategories } = this.props;\n    const { hotspot, loading, commentVisible } = this.state;\n\n    return (\n      <HotspotViewerRenderer\n        branchLike={branchLike}\n        component={component}\n        commentTextRef={this.commentTextRef}\n        commentVisible={commentVisible}\n        hotspot={hotspot}\n        loading={loading}\n        onCloseComment={this.handleCloseComment}\n        onOpenComment={this.handleOpenComment}\n        onUpdateHotspot={this.handleHotspotUpdate}\n        parentScrollRef={this.parentScrollRef}\n        securityCategories={securityCategories}\n      />\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Helmet } from 'react-helmet-async';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport A11ySkipTarget from '../../app/components/a11y/A11ySkipTarget';\nimport Suggestions from '../../app/components/embed-docs-modal/Suggestions';\nimport ScreenPositionHelper from '../../components/common/ScreenPositionHelper';\nimport { isBranch } from '../../helpers/branch-like';\nimport { BranchLike } from '../../types/branch-like';\nimport { HotspotFilters, HotspotStatusFilter, RawHotspot } from '../../types/security-hotspots';\nimport EmptyHotspotsPage from './components/EmptyHotspotsPage';\nimport FilterBar from './components/FilterBar';\nimport HotspotList from './components/HotspotList';\nimport HotspotViewer from './components/HotspotViewer';\nimport './styles.css';\n\nexport interface SecurityHotspotsAppRendererProps {\n  branchLike?: BranchLike;\n  component: T.Component;\n  filters: HotspotFilters;\n  hotspots: RawHotspot[];\n  hotspotsReviewedMeasure?: string;\n  hotspotsTotal?: number;\n  isStaticListOfHotspots: boolean;\n  loading: boolean;\n  loadingMeasure: boolean;\n  loadingMore: boolean;\n  onChangeFilters: (filters: Partial<HotspotFilters>) => void;\n  onHotspotClick: (hotspot: RawHotspot) => void;\n  onLoadMore: () => void;\n  onShowAllHotspots: () => void;\n  onUpdateHotspot: (hotspotKey: string) => Promise<void>;\n  selectedHotspot: RawHotspot | undefined;\n  securityCategories: T.StandardSecurityCategories;\n}\n\nexport default function SecurityHotspotsAppRenderer(props: SecurityHotspotsAppRendererProps) {\n  const {\n    branchLike,\n    component,\n    hotspots,\n    hotspotsReviewedMeasure,\n    hotspotsTotal,\n    isStaticListOfHotspots,\n    loading,\n    loadingMeasure,\n    loadingMore,\n    securityCategories,\n    selectedHotspot,\n    filters\n  } = props;\n\n  return (\n    <div id=\"security_hotspots\">\n      <FilterBar\n        component={component}\n        filters={filters}\n        hotspotsReviewedMeasure={hotspotsReviewedMeasure}\n        isStaticListOfHotspots={isStaticListOfHotspots}\n        loadingMeasure={loadingMeasure}\n        onBranch={isBranch(branchLike)}\n        onChangeFilters={props.onChangeFilters}\n        onShowAllHotspots={props.onShowAllHotspots}\n      />\n      <ScreenPositionHelper>\n        {({ top }) => (\n          <div className=\"wrapper\" style={{ top }}>\n            <Suggestions suggestions=\"security_hotspots\" />\n            <Helmet title={translate('hotspots.page')} />\n\n            <A11ySkipTarget anchor=\"security_hotspots_main\" />\n\n            {loading ? (\n              <DeferredSpinner className=\"huge-spacer-left big-spacer-top\" />\n            ) : (\n              <>\n                {hotspots.length === 0 || !selectedHotspot ? (\n                  <EmptyHotspotsPage\n                    filtered={\n                      filters.assignedToMe ||\n                      (isBranch(branchLike) && filters.sinceLeakPeriod) ||\n                      filters.status !== HotspotStatusFilter.TO_REVIEW\n                    }\n                    isStaticListOfHotspots={isStaticListOfHotspots}\n                  />\n                ) : (\n                  <div className=\"layout-page\">\n                    <div className=\"sidebar\">\n                      <HotspotList\n                        hotspots={hotspots}\n                        hotspotsTotal={hotspotsTotal}\n                        isStaticListOfHotspots={isStaticListOfHotspots}\n                        loadingMore={loadingMore}\n                        onHotspotClick={props.onHotspotClick}\n                        onLoadMore={props.onLoadMore}\n                        securityCategories={securityCategories}\n                        selectedHotspot={selectedHotspot}\n                        statusFilter={filters.status}\n                      />\n                    </div>\n                    <div className=\"main\">\n                      <HotspotViewer\n                        branchLike={branchLike}\n                        component={component}\n                        hotspotKey={selectedHotspot.key}\n                        onUpdateHotspot={props.onUpdateHotspot}\n                        securityCategories={securityCategories}\n                      />\n                    </div>\n                  </div>\n                )}\n              </>\n            )}\n          </div>\n        )}\n      </ScreenPositionHelper>\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { Location } from 'history';\nimport { flatMap, range } from 'lodash';\nimport * as React from 'react';\nimport { addNoFooterPageClass, removeNoFooterPageClass } from 'sonar-ui-common/helpers/pages';\nimport { getMeasures } from '../../api/measures';\nimport { getSecurityHotspotList, getSecurityHotspots } from '../../api/security-hotspots';\nimport { withCurrentUser } from '../../components/hoc/withCurrentUser';\nimport { Router } from '../../components/hoc/withRouter';\nimport { getLeakValue } from '../../components/measure/utils';\nimport { getBranchLikeQuery, isPullRequest, isSameBranchLike } from '../../helpers/branch-like';\nimport { getStandards } from '../../helpers/security-standard';\nimport { isLoggedIn } from '../../helpers/users';\nimport { BranchLike } from '../../types/branch-like';\nimport {\n  HotspotFilters,\n  HotspotResolution,\n  HotspotStatus,\n  HotspotStatusFilter,\n  RawHotspot\n} from '../../types/security-hotspots';\nimport SecurityHotspotsAppRenderer from './SecurityHotspotsAppRenderer';\nimport './styles.css';\n\nconst PAGE_SIZE = 500;\n\ninterface Props {\n  branchLike?: BranchLike;\n  currentUser: T.CurrentUser;\n  component: T.Component;\n  location: Location;\n  router: Router;\n}\n\ninterface State {\n  hotspotKeys?: string[];\n  hotspots: RawHotspot[];\n  hotspotsPageIndex: number;\n  hotspotsReviewedMeasure?: string;\n  hotspotsTotal?: number;\n  loading: boolean;\n  loadingMeasure: boolean;\n  loadingMore: boolean;\n  securityCategories: T.StandardSecurityCategories;\n  selectedHotspot: RawHotspot | undefined;\n  filters: HotspotFilters;\n}\n\nexport class SecurityHotspotsApp extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      loading: true,\n      loadingMeasure: false,\n      loadingMore: false,\n      hotspots: [],\n      hotspotsPageIndex: 1,\n      securityCategories: {},\n      selectedHotspot: undefined,\n      filters: {\n        ...this.constructFiltersFromProps(props),\n        status: HotspotStatusFilter.TO_REVIEW\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    addNoFooterPageClass();\n    this.fetchInitialData();\n  }\n\n  componentDidUpdate(previous: Props) {\n    if (\n      this.props.component.key !== previous.component.key ||\n      this.props.location.query.hotspots !== previous.location.query.hotspots\n    ) {\n      this.fetchInitialData();\n    }\n\n    if (\n      !isSameBranchLike(this.props.branchLike, previous.branchLike) ||\n      isLoggedIn(this.props.currentUser) !== isLoggedIn(previous.currentUser) ||\n      this.props.location.query.assignedToMe !== previous.location.query.assignedToMe ||\n      this.props.location.query.sinceLeakPeriod !== previous.location.query.sinceLeakPeriod\n    ) {\n      this.setState(({ filters }) => ({\n        filters: { ...this.constructFiltersFromProps, ...filters }\n      }));\n    }\n  }\n\n  componentWillUnmount() {\n    removeNoFooterPageClass();\n    this.mounted = false;\n  }\n\n  constructFiltersFromProps(\n    props: Props\n  ): Pick<HotspotFilters, 'assignedToMe' | 'sinceLeakPeriod'> {\n    return {\n      assignedToMe: props.location.query.assignedToMe === 'true' && isLoggedIn(props.currentUser),\n      sinceLeakPeriod:\n        isPullRequest(props.branchLike) || props.location.query.sinceLeakPeriod === 'true'\n    };\n  }\n\n  handleCallFailure = () => {\n    if (this.mounted) {\n      this.setState({ loading: false, loadingMore: false });\n    }\n  };\n\n  fetchInitialData() {\n    return Promise.all([\n      getStandards(),\n      this.fetchSecurityHotspots(),\n      this.fetchSecurityHotspotsReviewed()\n    ])\n      .then(([{ sonarsourceSecurity }, { hotspots, paging }]) => {\n        if (!this.mounted) {\n          return;\n        }\n\n        this.setState({\n          hotspots,\n          hotspotsTotal: paging.total,\n          loading: false,\n          securityCategories: sonarsourceSecurity,\n          selectedHotspot: hotspots.length > 0 ? hotspots[0] : undefined\n        });\n      })\n      .catch(this.handleCallFailure);\n  }\n\n  fetchSecurityHotspotsReviewed = () => {\n    const { branchLike, component } = this.props;\n    const { filters } = this.state;\n\n    const reviewedHotspotsMetricKey = filters.sinceLeakPeriod\n      ? 'new_security_hotspots_reviewed'\n      : 'security_hotspots_reviewed';\n\n    this.setState({ loadingMeasure: true });\n    return getMeasures({\n      component: component.key,\n      metricKeys: reviewedHotspotsMetricKey,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(measures => {\n        if (!this.mounted) {\n          return;\n        }\n        const measure = measures && measures.length > 0 ? measures[0] : undefined;\n        const hotspotsReviewedMeasure = filters.sinceLeakPeriod\n          ? getLeakValue(measure)\n          : measure?.value;\n\n        this.setState({ hotspotsReviewedMeasure, loadingMeasure: false });\n      })\n      .catch(() => {\n        if (this.mounted) {\n          this.setState({ loadingMeasure: false });\n        }\n      });\n  };\n\n  fetchSecurityHotspots(page = 1) {\n    const { branchLike, component, location } = this.props;\n    const { filters } = this.state;\n\n    const hotspotKeys = location.query.hotspots\n      ? (location.query.hotspots as string).split(',')\n      : undefined;\n\n    this.setState({ hotspotKeys });\n\n    if (hotspotKeys && hotspotKeys.length > 0) {\n      return getSecurityHotspotList(hotspotKeys, {\n        projectKey: component.key,\n        ...getBranchLikeQuery(branchLike)\n      });\n    }\n\n    const status =\n      filters.status === HotspotStatusFilter.TO_REVIEW\n        ? HotspotStatus.TO_REVIEW\n        : HotspotStatus.REVIEWED;\n\n    const resolution =\n      filters.status === HotspotStatusFilter.TO_REVIEW\n        ? undefined\n        : HotspotResolution[filters.status];\n\n    return getSecurityHotspots({\n      projectKey: component.key,\n      p: page,\n      ps: PAGE_SIZE,\n      status,\n      resolution,\n      onlyMine: filters.assignedToMe,\n      sinceLeakPeriod: filters.sinceLeakPeriod,\n      ...getBranchLikeQuery(branchLike)\n    });\n  }\n\n  reloadSecurityHotspotList = () => {\n    this.setState({ loading: true });\n\n    return this.fetchSecurityHotspots()\n      .then(({ hotspots, paging }) => {\n        if (!this.mounted) {\n          return;\n        }\n\n        this.setState({\n          hotspots,\n          hotspotsPageIndex: 1,\n          hotspotsTotal: paging.total,\n          loading: false,\n          selectedHotspot: hotspots.length > 0 ? hotspots[0] : undefined\n        });\n      })\n      .catch(this.handleCallFailure);\n  };\n\n  handleChangeFilters = (changes: Partial<HotspotFilters>) => {\n    this.setState(\n      ({ filters }) => ({ filters: { ...filters, ...changes } }),\n      () => {\n        this.reloadSecurityHotspotList();\n        if (changes.sinceLeakPeriod !== undefined) {\n          this.fetchSecurityHotspotsReviewed();\n        }\n      }\n    );\n  };\n\n  handleHotspotClick = (selectedHotspot: RawHotspot) => this.setState({ selectedHotspot });\n\n  handleHotspotUpdate = (hotspotKey: string) => {\n    const { hotspots, hotspotsPageIndex } = this.state;\n    const index = hotspots.findIndex(h => h.key === hotspotKey);\n\n    return Promise.all(\n      range(hotspotsPageIndex).map(p => this.fetchSecurityHotspots(p + 1 /* pages are 1-indexed */))\n    )\n      .then(hotspotPages => {\n        const allHotspots = flatMap(hotspotPages, 'hotspots');\n\n        const { paging } = hotspotPages[hotspotPages.length - 1];\n\n        const nextHotspot = allHotspots[Math.min(index, allHotspots.length - 1)];\n\n        this.setState({\n          hotspots: allHotspots,\n          hotspotsPageIndex: paging.pageIndex,\n          hotspotsTotal: paging.total,\n          selectedHotspot: nextHotspot\n        });\n      })\n      .then(this.fetchSecurityHotspotsReviewed);\n  };\n\n  handleShowAllHotspots = () => {\n    this.props.router.push({\n      ...this.props.location,\n      query: { ...this.props.location.query, hotspots: undefined }\n    });\n  };\n\n  handleLoadMore = () => {\n    const { hotspots, hotspotsPageIndex: hotspotPages } = this.state;\n\n    this.setState({ loadingMore: true });\n\n    return this.fetchSecurityHotspots(hotspotPages + 1)\n      .then(({ hotspots: additionalHotspots }) => {\n        if (!this.mounted) {\n          return;\n        }\n\n        this.setState({\n          hotspots: [...hotspots, ...additionalHotspots],\n          hotspotsPageIndex: hotspotPages + 1,\n          loadingMore: false\n        });\n      })\n      .catch(this.handleCallFailure);\n  };\n\n  render() {\n    const { branchLike, component } = this.props;\n    const {\n      hotspotKeys,\n      hotspots,\n      hotspotsReviewedMeasure,\n      hotspotsTotal,\n      loading,\n      loadingMeasure,\n      loadingMore,\n      securityCategories,\n      selectedHotspot,\n      filters\n    } = this.state;\n\n    return (\n      <SecurityHotspotsAppRenderer\n        branchLike={branchLike}\n        component={component}\n        filters={filters}\n        hotspots={hotspots}\n        hotspotsReviewedMeasure={hotspotsReviewedMeasure}\n        hotspotsTotal={hotspotsTotal}\n        isStaticListOfHotspots={Boolean(hotspotKeys && hotspotKeys.length > 0)}\n        loading={loading}\n        loadingMeasure={loadingMeasure}\n        loadingMore={loadingMore}\n        onChangeFilters={this.handleChangeFilters}\n        onHotspotClick={this.handleHotspotClick}\n        onLoadMore={this.handleLoadMore}\n        onShowAllHotspots={this.handleShowAllHotspots}\n        onUpdateHotspot={this.handleHotspotUpdate}\n        securityCategories={securityCategories}\n        selectedHotspot={selectedHotspot}\n      />\n    );\n  }\n}\n\nexport default withCurrentUser(SecurityHotspotsApp);\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { SuggestionsContext } from './SuggestionsContext';\n\ninterface Props {\n  suggestions: string;\n}\n\nexport default function Suggestions({ suggestions }: Props) {\n  return (\n    <SuggestionsContext.Consumer>\n      {({ addSuggestions, removeSuggestions }) => (\n        <SuggestionsInner\n          addSuggestions={addSuggestions}\n          removeSuggestions={removeSuggestions}\n          suggestions={suggestions}\n        />\n      )}\n    </SuggestionsContext.Consumer>\n  );\n}\n\ninterface SuggestionsInnerProps {\n  addSuggestions: (key: string) => void;\n  removeSuggestions: (key: string) => void;\n  suggestions: string;\n}\n\nclass SuggestionsInner extends React.PureComponent<SuggestionsInnerProps> {\n  componentDidMount() {\n    this.props.addSuggestions(this.props.suggestions);\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.suggestions !== this.props.suggestions) {\n      this.props.removeSuggestions(this.props.suggestions);\n      this.props.addSuggestions(prevProps.suggestions);\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.removeSuggestions(this.props.suggestions);\n  }\n\n  render() {\n    return null;\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nexport function getWrappedDisplayName<P>(\n  WrappedComponent: React.ComponentType<P>,\n  hocName: string\n) {\n  const wrappedDisplayName = WrappedComponent.displayName || WrappedComponent.name || 'Component';\n  return `${hocName}(${wrappedDisplayName})`;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nexport enum ComponentQualifier {\n  Application = 'APP',\n  Directory = 'DIR',\n  Developper = 'DEV',\n  File = 'FIL',\n  Portfolio = 'VW',\n  Project = 'TRK',\n  SubPortfolio = 'SVW',\n  SubProject = 'BRC',\n  TestFile = 'UTS'\n}\n\nexport function isPortfolioLike(componentQualifier?: string | ComponentQualifier) {\n  return (\n    !!componentQualifier &&\n    [ComponentQualifier.Portfolio.toString(), ComponentQualifier.SubPortfolio.toString()].includes(\n      componentQualifier\n    )\n  );\n}\n\nexport enum Visibility {\n  Public = 'public',\n  Private = 'private'\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { A11yContext } from './A11yContext';\n\ninterface Props {\n  anchor: string;\n  label?: string;\n  weight?: number;\n}\n\nexport default function A11ySkipTarget(props: Props) {\n  return (\n    <A11yContext.Consumer>\n      {({ addA11ySkipLink, removeA11ySkipLink }) => (\n        <A11ySkipTargetInner\n          addA11ySkipLink={addA11ySkipLink}\n          removeA11ySkipLink={removeA11ySkipLink}\n          {...props}\n        />\n      )}\n    </A11yContext.Consumer>\n  );\n}\n\ninterface InnerProps {\n  addA11ySkipLink: (link: T.A11ySkipLink) => void;\n  removeA11ySkipLink: (link: T.A11ySkipLink) => void;\n}\n\nexport class A11ySkipTargetInner extends React.PureComponent<Props & InnerProps> {\n  componentDidMount() {\n    this.props.addA11ySkipLink(this.getLink());\n  }\n\n  componentWillUnmount() {\n    this.props.removeA11ySkipLink(this.getLink());\n  }\n\n  getLink = (): T.A11ySkipLink => {\n    const { anchor: key, label = translate('skip_to_content'), weight } = this.props;\n    return { key, label, weight };\n  };\n\n  render() {\n    const { anchor } = this.props;\n    return <span id={`a11y_target__${anchor}`} />;\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { getCurrentUser, Store } from '../../store/rootReducer';\nimport { getWrappedDisplayName } from './utils';\n\nexport function withCurrentUser<P>(\n  WrappedComponent: React.ComponentType<P & { currentUser: T.CurrentUser }>\n) {\n  class Wrapper extends React.Component<P & { currentUser: T.CurrentUser }> {\n    static displayName = getWrappedDisplayName(WrappedComponent, 'withCurrentUser');\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  }\n\n  function mapStateToProps(state: Store) {\n    return { currentUser: getCurrentUser(state) };\n  }\n\n  return connect(mapStateToProps)(Wrapper);\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport SeverityIcon from 'sonar-ui-common/components/icons/SeverityIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\ninterface Props {\n  className?: string;\n  severity: string;\n}\n\nexport default function SeverityHelper({ className, severity }: Props) {\n  if (!severity) {\n    return null;\n  }\n  return (\n    <span className={className}>\n      <SeverityIcon className=\"little-spacer-right\" severity={severity} />\n      {translate('severity', severity)}\n    </span>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { getRatingTooltip as nextGetRatingTooltip, isDiffMetric } from '../../helpers/measures';\nimport { getLeakPeriod } from '../../helpers/periods';\n\nconst KNOWN_RATINGS = [\n  'sqale_rating',\n  'maintainability_rating', // Needed to provide the label for \"new_maintainability_rating\"\n  'reliability_rating',\n  'security_rating',\n  'security_review_rating'\n];\n\nexport function enhanceMeasure(measure: T.Measure, metrics: T.Dict<T.Metric>): T.MeasureEnhanced {\n  return {\n    ...measure,\n    metric: metrics[measure.metric],\n    leak: getLeakValue(measure)\n  };\n}\n\nexport function getLeakValue(measure: T.MeasureIntern | undefined): string | undefined {\n  if (!measure || !measure.periods) {\n    return undefined;\n  }\n  const period = getLeakPeriod(measure.periods);\n  return period && period.value;\n}\n\nexport function getRatingTooltip(metricKey: string, value: number): string | undefined {\n  const finalMetricKey = isDiffMetric(metricKey) ? metricKey.substr(4) : metricKey;\n  if (KNOWN_RATINGS.includes(finalMetricKey)) {\n    return nextGetRatingTooltip(finalMetricKey, value);\n  }\n  return undefined;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport Level from 'sonar-ui-common/components/ui/Level';\nimport Rating from 'sonar-ui-common/components/ui/Rating';\nimport { formatMeasure } from 'sonar-ui-common/helpers/measures';\nimport { getRatingTooltip } from './utils';\n\ninterface Props {\n  className?: string;\n  decimals?: number | null;\n  metricKey: string;\n  metricType: string;\n  small?: boolean;\n  value: string | undefined;\n}\n\nexport default function Measure({\n  className,\n  decimals,\n  metricKey,\n  metricType,\n  small,\n  value\n}: Props) {\n  if (value === undefined) {\n    return <span className={className}></span>;\n  }\n\n  if (metricType === 'LEVEL') {\n    return <Level className={className} level={value} small={small} />;\n  }\n\n  if (metricType !== 'RATING') {\n    const formattedValue = formatMeasure(value, metricType, {\n      decimals,\n      omitExtraDecimalZeros: metricType === 'PERCENT'\n    });\n    return <span className={className}>{formattedValue != null ? formattedValue : ''}</span>;\n  }\n\n  const tooltip = getRatingTooltip(metricKey, Number(value));\n  const rating = <Rating small={small} value={value} />;\n  if (tooltip) {\n    return (\n      <Tooltip overlay={tooltip}>\n        <span className={className}>{rating}</span>\n      </Tooltip>\n    );\n  }\n  return rating;\n}\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./TagsList.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as globalMessages from '../../store/globalMessages';\nimport getStore from './getStore';\n\nexport default function addGlobalSuccessMessage(message: string): void {\n  const store = getStore();\n  store.dispatch(globalMessages.addGlobalSuccessMessage(message));\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { parseDate } from 'sonar-ui-common/helpers/dates';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { ApplicationPeriod } from '../types/application';\n\nfunction getPeriod<T extends T.Period | T.PeriodMeasure>(periods: T[] | undefined, index: number) {\n  if (!Array.isArray(periods)) {\n    return undefined;\n  }\n  return periods.find(period => period.index === index);\n}\n\nexport function getLeakPeriod<T extends T.Period | T.PeriodMeasure>(periods: T[] | undefined) {\n  return getPeriod(periods, 1);\n}\n\nexport function getPeriodLabel(\n  period: T.Period | undefined,\n  dateFormatter: (date: string) => string\n) {\n  if (!period) {\n    return undefined;\n  }\n\n  let parameter = period.modeParam || period.parameter || '';\n\n  switch (period.mode) {\n    case 'SPECIFIC_ANALYSIS':\n      parameter = dateFormatter(period.date);\n      break;\n    case 'PREVIOUS_VERSION':\n      parameter = parameter || dateFormatter(period.date);\n      break;\n    /*\n     * Handle legacy period modes, that predate MMF-1579\n     */\n    case 'previous_version':\n      if (!parameter) {\n        return translate('overview.period.previous_version_only_date');\n      }\n      break;\n    case 'date':\n      parameter = parameter && dateFormatter(parameter);\n      break;\n    case 'manual_baseline':\n      parameter = parameter || dateFormatter(period.date);\n      break;\n    default: // No change in the parameter\n  }\n\n  return translateWithParameters(`overview.period.${period.mode.toLowerCase()}`, parameter);\n}\n\nexport function getPeriodDate(period?: { date?: string }): Date | undefined {\n  return period && period.date ? parseDate(period.date) : undefined;\n}\n\nexport function isApplicationPeriod(\n  period: T.Period | ApplicationPeriod\n): period is ApplicationPeriod {\n  return (period as ApplicationPeriod).project !== undefined;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { debounce } from 'lodash';\nimport * as React from 'react';\n\ninterface Props {\n  className?: string;\n  children: (position: { top: number; left: number }) => React.ReactElement<any>;\n}\n\nexport default class ScreenPositionHelper extends React.PureComponent<Props> {\n  container?: HTMLDivElement;\n  debouncedOnResize: () => void;\n\n  constructor(props: Props) {\n    super(props);\n    this.debouncedOnResize = debounce(() => this.forceUpdate(), 250);\n  }\n\n  componentDidMount() {\n    this.forceUpdate();\n    window.addEventListener('resize', this.debouncedOnResize);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.debouncedOnResize);\n  }\n\n  getPosition = () => {\n    const containerPos = this.container && this.container.getBoundingClientRect();\n    if (!containerPos) {\n      return { top: 0, left: 0 };\n    }\n    return {\n      top: window.pageYOffset + containerPos.top,\n      left: window.pageXOffset + containerPos.left\n    };\n  };\n\n  render() {\n    return (\n      <div\n        className={this.props.className}\n        ref={container => (this.container = container as HTMLDivElement)}>\n        {this.props.children(this.getPosition())}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport Checkbox from 'sonar-ui-common/components/controls/Checkbox';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\nexport interface MultiSelectOptionProps {\n  active?: boolean;\n  custom?: boolean;\n  disabled?: boolean;\n  element: string;\n  onHover: (element: string) => void;\n  onSelectChange: (selected: boolean, element: string) => void;\n  renderLabel: (element: string) => React.ReactNode;\n  selected?: boolean;\n}\n\nexport default function MultiSelectOption(props: MultiSelectOptionProps) {\n  const { active, custom, disabled, element, selected } = props;\n  const onHover = () => props.onHover(element);\n  const className = classNames({ active, disabled });\n  const label = props.renderLabel(element);\n\n  return (\n    <li onFocus={onHover} onMouseOver={onHover}>\n      <Checkbox\n        checked={Boolean(selected)}\n        className={className}\n        disabled={disabled}\n        id={element}\n        onCheck={props.onSelectChange}>\n        {custom ? (\n          <span\n            aria-label={`${translate('create_new_element')}: ${label}`}\n            className=\"little-spacer-left\">\n            <span aria-hidden={true} className=\"little-spacer-right\">\n              +\n            </span>\n            {label}\n          </span>\n        ) : (\n          <span className=\"little-spacer-left\">{label}</span>\n        )}\n      </Checkbox>\n    </li>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { difference } from 'lodash';\nimport * as React from 'react';\nimport SearchBox from 'sonar-ui-common/components/controls/SearchBox';\nimport { translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport MultiSelectOption from './MultiSelectOption';\n\ninterface Props {\n  allowNewElements?: boolean;\n  allowSelection?: boolean;\n  elements: string[];\n  filterSelected?: (query: string, selectedElements: string[]) => string[];\n  footerNode?: React.ReactNode;\n  listSize?: number;\n  onSearch: (query: string) => Promise<void>;\n  onSelect: (item: string) => void;\n  onUnselect: (item: string) => void;\n  placeholder: string;\n  renderLabel?: (element: string) => React.ReactNode;\n  selectedElements: string[];\n  validateSearchInput?: (value: string) => string;\n}\n\ninterface State {\n  activeIdx: number;\n  loading: boolean;\n  query: string;\n  selectedElements: string[];\n  unselectedElements: string[];\n}\n\ninterface DefaultProps {\n  filterSelected: (query: string, selectedElements: string[]) => string[];\n  listSize: number;\n  renderLabel: (element: string) => React.ReactNode;\n  validateSearchInput: (value: string) => string;\n}\n\ntype PropsWithDefault = Props & DefaultProps;\n\nexport default class MultiSelect extends React.PureComponent<Props, State> {\n  container?: HTMLDivElement | null;\n  searchInput?: HTMLInputElement | null;\n  mounted = false;\n\n  static defaultProps: DefaultProps = {\n    filterSelected: (query: string, selectedElements: string[]) =>\n      selectedElements.filter(elem => elem.includes(query)),\n    listSize: 0,\n    renderLabel: (element: string) => element,\n    validateSearchInput: (value: string) => value\n  };\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      activeIdx: 0,\n      loading: true,\n      query: '',\n      selectedElements: [],\n      unselectedElements: []\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.onSearchQuery('');\n    this.updateSelectedElements(this.props as PropsWithDefault);\n    this.updateUnselectedElements(this.props as PropsWithDefault);\n    if (this.container) {\n      this.container.addEventListener('keydown', this.handleKeyboard, true);\n    }\n  }\n\n  componentWillReceiveProps(nextProps: PropsWithDefault) {\n    if (\n      this.props.elements !== nextProps.elements ||\n      this.props.selectedElements !== nextProps.selectedElements\n    ) {\n      this.updateSelectedElements(nextProps);\n      this.updateUnselectedElements(nextProps);\n\n      const totalElements = this.getAllElements(nextProps, this.state).length;\n      if (this.state.activeIdx >= totalElements) {\n        this.setState({ activeIdx: totalElements - 1 });\n      }\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.searchInput) {\n      this.searchInput.focus();\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    if (this.container) {\n      this.container.removeEventListener('keydown', this.handleKeyboard);\n    }\n  }\n\n  handleSelectChange = (selected: boolean, item: string) => {\n    if (selected) {\n      this.onSelectItem(item);\n    } else {\n      this.onUnselectItem(item);\n    }\n  };\n\n  handleSearchChange = (value: string) => {\n    this.onSearchQuery((this.props as PropsWithDefault).validateSearchInput(value));\n  };\n\n  handleElementHover = (element: string) => {\n    this.setState((prevState, props) => {\n      return { activeIdx: this.getAllElements(props, prevState).indexOf(element) };\n    });\n  };\n\n  handleKeyboard = (evt: KeyboardEvent) => {\n    switch (evt.keyCode) {\n      case 40: // down\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.setState(this.selectNextElement);\n        break;\n      case 38: // up\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.setState(this.selectPreviousElement);\n        break;\n      case 37: // left\n      case 39: // right\n        evt.stopPropagation();\n        break;\n      case 13: // enter\n        if (this.state.activeIdx >= 0) {\n          this.toggleSelect(this.getAllElements(this.props, this.state)[this.state.activeIdx]);\n        }\n        break;\n    }\n  };\n\n  onSearchQuery = (query: string) => {\n    this.setState({ activeIdx: 0, loading: true, query });\n    this.props.onSearch(query).then(this.stopLoading, this.stopLoading);\n  };\n\n  onSelectItem = (item: string) => {\n    if (this.isNewElement(item, this.props)) {\n      this.onSearchQuery('');\n    }\n    this.props.onSelect(item);\n  };\n\n  onUnselectItem = (item: string) => this.props.onUnselect(item);\n\n  isNewElement = (elem: string, { selectedElements, elements }: Props) =>\n    elem.length > 0 && selectedElements.indexOf(elem) === -1 && elements.indexOf(elem) === -1;\n\n  updateSelectedElements = (props: PropsWithDefault) => {\n    this.setState((state: State) => {\n      if (state.query) {\n        return {\n          selectedElements: props.filterSelected(state.query, props.selectedElements)\n        };\n      } else {\n        return { selectedElements: [...props.selectedElements] };\n      }\n    });\n  };\n\n  updateUnselectedElements = (props: PropsWithDefault) => {\n    this.setState((state: State) => {\n      if (props.listSize === 0) {\n        return { unselectedElements: difference(props.elements, props.selectedElements) };\n      } else if (props.listSize < state.selectedElements.length) {\n        return { unselectedElements: [] };\n      } else {\n        return {\n          unselectedElements: difference(props.elements, props.selectedElements).slice(\n            0,\n            props.listSize - state.selectedElements.length\n          )\n        };\n      }\n    });\n  };\n\n  getAllElements = (props: Props, state: State) => {\n    if (this.isNewElement(state.query, props)) {\n      return [...state.selectedElements, ...state.unselectedElements, state.query];\n    } else {\n      return [...state.selectedElements, ...state.unselectedElements];\n    }\n  };\n\n  setElementActive = (idx: number) => this.setState({ activeIdx: idx });\n\n  selectNextElement = (state: State, props: Props) => {\n    const { activeIdx } = state;\n    const allElements = this.getAllElements(props, state);\n    if (activeIdx < 0 || activeIdx >= allElements.length - 1) {\n      return { activeIdx: 0 };\n    } else {\n      return { activeIdx: activeIdx + 1 };\n    }\n  };\n\n  selectPreviousElement = (state: State, props: Props) => {\n    const { activeIdx } = state;\n    const allElements = this.getAllElements(props, state);\n    if (activeIdx <= 0) {\n      const lastIdx = allElements.length - 1;\n      return { activeIdx: lastIdx };\n    } else {\n      return { activeIdx: activeIdx - 1 };\n    }\n  };\n\n  stopLoading = () => {\n    if (this.mounted) {\n      this.setState({ loading: false });\n    }\n  };\n\n  toggleSelect = (item: string) => {\n    if (this.props.selectedElements.indexOf(item) === -1) {\n      this.onSelectItem(item);\n    } else {\n      this.onUnselectItem(item);\n    }\n  };\n\n  render() {\n    const { allowSelection = true, allowNewElements = true, footerNode = '' } = this.props;\n    const { renderLabel } = this.props as PropsWithDefault;\n    const { query, activeIdx, selectedElements, unselectedElements } = this.state;\n    const activeElement = this.getAllElements(this.props, this.state)[activeIdx];\n    const showNewElement = allowNewElements && this.isNewElement(query, this.props);\n    const infiniteList = this.props.listSize === 0;\n    const listClasses = classNames('menu', {\n      'menu-vertically-limited': infiniteList,\n      'spacer-top': infiniteList,\n      'with-top-separator': infiniteList,\n      'with-bottom-separator': Boolean(footerNode)\n    });\n\n    return (\n      <div className=\"multi-select\" ref={div => (this.container = div)}>\n        <div className=\"menu-search\">\n          <SearchBox\n            autoFocus={true}\n            className=\"little-spacer-top\"\n            loading={this.state.loading}\n            onChange={this.handleSearchChange}\n            placeholder={this.props.placeholder}\n            value={query}\n          />\n        </div>\n        <ul className={listClasses}>\n          {selectedElements.length > 0 &&\n            selectedElements.map(element => (\n              <MultiSelectOption\n                active={activeElement === element}\n                element={element}\n                key={element}\n                onHover={this.handleElementHover}\n                onSelectChange={this.handleSelectChange}\n                renderLabel={renderLabel}\n                selected={true}\n              />\n            ))}\n          {unselectedElements.length > 0 &&\n            unselectedElements.map(element => (\n              <MultiSelectOption\n                active={activeElement === element}\n                disabled={!allowSelection}\n                element={element}\n                key={element}\n                onHover={this.handleElementHover}\n                onSelectChange={this.handleSelectChange}\n                renderLabel={renderLabel}\n              />\n            ))}\n          {showNewElement && (\n            <MultiSelectOption\n              active={activeElement === query}\n              custom={true}\n              element={query}\n              key={query}\n              onHover={this.handleElementHover}\n              onSelectChange={this.handleSelectChange}\n              renderLabel={renderLabel}\n            />\n          )}\n          {!showNewElement && selectedElements.length < 1 && unselectedElements.length < 1 && (\n            <li className=\"spacer-left\">{translateWithParameters('no_results_for_x', query)}</li>\n          )}\n        </ul>\n        {footerNode}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport DropdownIcon from 'sonar-ui-common/components/icons/DropdownIcon';\nimport TagsIcon from 'sonar-ui-common/components/icons/TagsIcon';\nimport { translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport './TagsList.css';\n\ninterface Props {\n  allowUpdate?: boolean;\n  className?: string;\n  tags: string[];\n}\n\nexport default function TagsList({ allowUpdate = false, className, tags }: Props) {\n  return (\n    <span\n      aria-label={translateWithParameters('tags_list_x', tags.join(', '))}\n      className={classNames('tags-list', className)}>\n      <TagsIcon className=\"text-middle\" />\n      <span aria-hidden={true} className=\"text-ellipsis text-middle\" title={tags.join(', ')}>\n        {tags.join(', ')}\n      </span>\n      {allowUpdate && <DropdownIcon className=\"text-middle\" />}\n    </span>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getMarkdownHelpUrl } from '../../helpers/urls';\n\ninterface Props {\n  className?: string;\n}\n\nexport default class MarkdownTips extends React.PureComponent<Props> {\n  handleClick(evt: React.SyntheticEvent<HTMLAnchorElement>) {\n    evt.preventDefault();\n    window.open(getMarkdownHelpUrl(), 'Markdown', 'height=300,width=600,scrollbars=1,resizable=1');\n  }\n\n  render() {\n    return (\n      <div className={classNames('markdown-tips', this.props.className)}>\n        <a className=\"little-spacer-right\" href=\"#\" onClick={this.handleClick}>\n          {translate('markdown.helplink')}\n        </a>\n        {':'}\n        <span className=\"spacer-left\">*{translate('bold')}*</span>\n        <span className=\"spacer-left\">\n          ``\n          {translate('code')}\n          ``\n        </span>\n        <span className=\"spacer-left\">* {translate('bulleted_point')}</span>\n      </div>\n    );\n  }\n}\n","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".tags-list{white-space:nowrap;line-height:16px}.tags-list i:before{font-size:12px}.tags-list span{display:inline-block;vertical-align:middle;text-align:left;max-width:220px;padding-left:4px;padding-right:4px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport MultiSelect from '../common/MultiSelect';\nimport './TagsList.css';\n\ninterface Props {\n  listSize: number;\n  onSearch: (query: string) => Promise<void>;\n  onSelect: (item: string) => void;\n  onUnselect: (item: string) => void;\n  selectedTags: string[];\n  tags: string[];\n}\n\nexport default function TagsSelector(props: Props) {\n  return (\n    <MultiSelect\n      elements={props.tags}\n      listSize={props.listSize}\n      onSearch={props.onSearch}\n      onSelect={props.onSelect}\n      onUnselect={props.onUnselect}\n      placeholder={translate('search.search_for_tags')}\n      selectedElements={props.selectedTags}\n      validateSearchInput={validateTag}\n    />\n  );\n}\n\nexport function validateTag(value: string) {\n  // Allow only a-z, 0-9, '+', '-', '#', '.'\n  return value.toLowerCase().replace(/[^-a-z0-9+#.]/gi, '');\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { lazyLoadComponent } from 'sonar-ui-common/components/lazyLoadComponent';\nimport { colors } from '../../app/theme';\n\nconst DonutChart = lazyLoadComponent(\n  () => import('sonar-ui-common/components/charts/DonutChart'),\n  'DonutChart'\n);\n\nconst SIZE_TO_WIDTH_MAPPING = { small: 16, normal: 24, big: 40, huge: 60 };\n\nconst SIZE_TO_THICKNESS_MAPPING = { small: 2, normal: 3, big: 3, huge: 4 };\n\nexport interface CoverageRatingProps {\n  muted?: boolean;\n  size?: 'small' | 'normal' | 'big' | 'huge';\n  value: number | string | null | undefined;\n}\n\nexport default function CoverageRating({\n  muted = false,\n  size = 'normal',\n  value\n}: CoverageRatingProps) {\n  let data = [{ value: 100, fill: '#ccc ' }];\n  let padAngle = 0;\n\n  if (value != null) {\n    const numberValue = Number(value);\n    data = [\n      { value: numberValue, fill: muted ? colors.gray71 : colors.green },\n      { value: 100 - numberValue, fill: muted ? colors.barBackgroundColor : colors.lineCoverageRed }\n    ];\n    if (numberValue !== 0 && numberValue < 100) {\n      padAngle = 0.1; // Same for all sizes, because it scales automatically\n    }\n  }\n\n  const width = SIZE_TO_WIDTH_MAPPING[size];\n  const thickness = SIZE_TO_THICKNESS_MAPPING[size];\n\n  return (\n    <DonutChart\n      data={data}\n      height={width}\n      padAngle={padAngle}\n      thickness={thickness}\n      width={width}\n    />\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { getJSON, post } from 'sonar-ui-common/helpers/request';\n\nexport function getFavorites(): Promise<any> {\n  return getJSON('/api/favorites/search');\n}\n\nexport function addFavorite(component: string): Promise<void> {\n  return post('/api/favorites/add', { component });\n}\n\nexport function removeFavorite(component: string): Promise<void> {\n  return post('/api/favorites/remove', { component });\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport FavoriteButton from 'sonar-ui-common/components/controls/FavoriteButton';\nimport { addFavorite, removeFavorite } from '../../api/favorites';\n\ninterface Props {\n  className?: string;\n  component: string;\n  favorite: boolean;\n  qualifier: string;\n  handleFavorite?: (component: string, isFavorite: boolean) => void;\n}\n\ninterface State {\n  favorite: boolean;\n}\n\nexport default class Favorite extends React.PureComponent<Props, State> {\n  mounted = false;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      favorite: props.favorite\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n  }\n\n  componentDidUpdate(_prevProps: Props, prevState: State) {\n    if (prevState.favorite !== this.props.favorite) {\n      this.setState({ favorite: this.props.favorite });\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  toggleFavorite = () => {\n    const newFavorite = !this.state.favorite;\n    const apiMethod = newFavorite ? addFavorite : removeFavorite;\n\n    return apiMethod(this.props.component).then(() => {\n      if (this.mounted) {\n        this.setState({ favorite: newFavorite }, () => {\n          if (this.props.handleFavorite) {\n            this.props.handleFavorite(this.props.component, newFavorite);\n          }\n        });\n      }\n    });\n  };\n\n  render() {\n    const { className, qualifier } = this.props;\n    const { favorite } = this.state;\n\n    return (\n      <FavoriteButton\n        className={className}\n        favorite={favorite}\n        qualifier={qualifier}\n        toggleFavorite={this.toggleFavorite}\n      />\n    );\n  }\n}\n/*  */\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport './LocationIndex.css';\n\ninterface Props {\n  children?: React.ReactNode;\n  leading?: boolean;\n  onClick?: () => void;\n  selected?: boolean;\n  [x: string]: any;\n}\n\nexport default function LocationIndex(props: Props) {\n  const { children, leading, onClick, selected, ...other } = props;\n  const clickAttributes = onClick ? { onClick, role: 'button', tabIndex: 0 } : {};\n  // put {...others} because Tooltip sets some event handlers\n  return (\n    <div\n      className={classNames('location-index', {\n        'is-leading': leading,\n        selected\n      })}\n      {...clickAttributes}\n      {...other}>\n      {children}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport StatusIcon from 'sonar-ui-common/components/icons/StatusIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\ninterface Props {\n  className?: string;\n  resolution: string | undefined;\n  status: string;\n}\n\nexport default function StatusHelper(props: Props) {\n  const resolution = props.resolution && ` (${translate('issue.resolution', props.resolution)})`;\n  return (\n    <span className={props.className}>\n      <StatusIcon className=\"little-spacer-right\" status={props.status} />\n      {translate('issue.status', props.status)}\n      {resolution}\n    </span>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nexport function getStandards(): Promise<T.Standards> {\n  return import('./standards.json').then(x => x.default);\n}\n\nexport function renderCWECategory(standards: T.Standards, category: string): string {\n  const record = standards.cwe[category];\n  if (!record) {\n    return `CWE-${category}`;\n  } else if (category === 'unknown') {\n    return record.title;\n  } else {\n    return `CWE-${category} - ${record.title}`;\n  }\n}\n\nexport function renderOwaspTop10Category(\n  standards: T.Standards,\n  category: string,\n  withPrefix = false\n): string {\n  const record = standards.owaspTop10[category];\n  if (!record) {\n    return addPrefix(category.toUpperCase(), 'OWASP', withPrefix);\n  } else {\n    return addPrefix(`${category.toUpperCase()} - ${record.title}`, 'OWASP', withPrefix);\n  }\n}\n\nexport function renderSansTop25Category(\n  standards: T.Standards,\n  category: string,\n  withPrefix = false\n): string {\n  const record = standards.sansTop25[category];\n  return addPrefix(record ? record.title : category, 'SANS', withPrefix);\n}\n\nexport function renderSonarSourceSecurityCategory(\n  standards: T.Standards,\n  category: string,\n  withPrefix = false\n): string {\n  const record = standards.sonarsourceSecurity[category];\n  if (!record) {\n    return addPrefix(category.toUpperCase(), 'SONAR', withPrefix);\n  } else if (category === 'others') {\n    return record.title;\n  } else {\n    return addPrefix(record.title, 'SONAR', withPrefix);\n  }\n}\n\nfunction addPrefix(title: string, prefix: string, withPrefix: boolean) {\n  return withPrefix ? `${prefix} ${title}` : title;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { flatten } from 'lodash';\nimport { splitByTokens } from './highlight';\nimport { getLinearLocations } from './issueLocations';\n\nexport function issuesByLine(issues: T.Issue[]) {\n  const index: { [line: number]: T.Issue[] } = {};\n  issues.forEach(issue => {\n    const line = issue.textRange ? issue.textRange.endLine : 0;\n    if (!(line in index)) {\n      index[line] = [];\n    }\n    index[line].push(issue);\n  });\n  return index;\n}\n\nexport function issuesByComponentAndLine(\n  issues: T.Issue[] = []\n): { [component: string]: { [line: number]: T.Issue[] } } {\n  return issues.reduce((mapping: { [component: string]: { [line: number]: T.Issue[] } }, issue) => {\n    mapping[issue.component] = mapping[issue.component] || {};\n    const line = issue.textRange ? issue.textRange.endLine : 0;\n    mapping[issue.component][line] = mapping[issue.component][line] || [];\n    mapping[issue.component][line].push(issue);\n    return mapping;\n  }, {});\n}\n\nexport function locationsByLine(issues: Pick<T.Issue, 'textRange'>[]) {\n  const index: { [line: number]: T.LinearIssueLocation[] } = {};\n  issues.forEach(issue => {\n    getLinearLocations(issue.textRange).forEach(location => {\n      if (!(location.line in index)) {\n        index[location.line] = [];\n      }\n      index[location.line].push(location);\n    });\n  });\n  return index;\n}\n\nexport function duplicationsByLine(duplications: T.Duplication[] | undefined) {\n  if (duplications == null) {\n    return {};\n  }\n\n  const duplicationsByLine: { [line: number]: number[] } = {};\n\n  duplications.forEach(({ blocks }, duplicationIndex) => {\n    blocks.forEach(block => {\n      // eslint-disable-next-line no-underscore-dangle\n      if (block._ref === '1') {\n        for (let line = block.from; line < block.from + block.size; line++) {\n          if (!(line in duplicationsByLine)) {\n            duplicationsByLine[line] = [];\n          }\n          duplicationsByLine[line].push(duplicationIndex);\n        }\n      }\n    });\n  });\n\n  return duplicationsByLine;\n}\n\nexport function symbolsByLine(sources: T.SourceLine[]) {\n  const index: { [line: number]: string[] } = {};\n  sources.forEach(line => {\n    const tokens = splitByTokens(line.code || '');\n    const symbols = flatten(\n      tokens.map(token => {\n        const keys = token.className.match(/sym-\\d+/g);\n        return keys != null ? keys : [];\n      })\n    );\n    index[line.line] = symbols.filter(key => key);\n  });\n  return index;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { formatMeasure } from 'sonar-ui-common/helpers/measures';\n\ninterface Props {\n  diff: T.IssueChangelogDiff;\n}\n\nexport default function IssueChangelogDiff({ diff }: Props) {\n  if (diff.key === 'file') {\n    return (\n      <p>\n        {translateWithParameters(\n          'issue.change.file_move',\n          diff.oldValue || '',\n          diff.newValue || ''\n        )}\n      </p>\n    );\n  } else if (['from_long_branch', 'from_branch'].includes(diff.key)) {\n    return (\n      <p>\n        {translateWithParameters(\n          'issue.change.from_branch',\n          diff.oldValue || '',\n          diff.newValue || ''\n        )}\n      </p>\n    );\n  } else if (diff.key === 'from_short_branch') {\n    // Applies to both legacy short lived branch and pull request\n    return (\n      <p>\n        {translateWithParameters(\n          'issue.change.from_non_branch',\n          diff.oldValue || '',\n          diff.newValue || ''\n        )}\n      </p>\n    );\n  } else if (diff.key === 'line') {\n    return <p>{translateWithParameters('issue.changelog.line_removed_X', diff.oldValue || '')}</p>;\n  }\n\n  let message;\n  if (diff.newValue != null) {\n    let { newValue } = diff;\n    if (diff.key === 'effort') {\n      newValue = formatMeasure(diff.newValue, 'WORK_DUR');\n    }\n    message = translateWithParameters(\n      'issue.changelog.changed_to',\n      translate('issue.changelog.field', diff.key),\n      newValue\n    );\n  } else {\n    message = translateWithParameters(\n      'issue.changelog.removed',\n      translate('issue.changelog.field', diff.key)\n    );\n  }\n\n  if (diff.oldValue != null) {\n    let { oldValue } = diff;\n    if (diff.key === 'effort') {\n      oldValue = formatMeasure(diff.oldValue, 'WORK_DUR');\n    }\n    message += ` (${translateWithParameters('issue.changelog.was', oldValue)})`;\n  }\n  return <p>{message}</p>;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nexport function getLinearLocations(textRange: T.TextRange | undefined): T.LinearIssueLocation[] {\n  if (!textRange) {\n    return [];\n  }\n  const locations = [];\n\n  // go through all lines of the `textRange`\n  for (let line = textRange.startLine; line <= textRange.endLine; line++) {\n    // TODO fix 999999\n    const from = line === textRange.startLine ? textRange.startOffset : 0;\n    const to = line === textRange.endLine ? textRange.endOffset : 999999;\n    locations.push({ line, from, to });\n  }\n  return locations;\n}\n\nexport function getSecondaryIssueLocationsForLine(\n  line: T.SourceLine,\n  highlightedLocations: (T.FlowLocation | undefined)[] | undefined\n): T.LinearIssueLocation[] {\n  if (!highlightedLocations) {\n    return [];\n  }\n  return highlightedLocations.reduce((locations, location) => {\n    const linearLocations: T.LinearIssueLocation[] = location\n      ? getLinearLocations(location.textRange)\n          .filter(l => l.line === line.line)\n          .map(l => ({\n            ...l,\n            startLine: location.textRange.startLine,\n            index: location.index,\n            text: location.msg\n          }))\n      : [];\n    return [...locations, ...linearLocations];\n  }, []);\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { BranchLike } from '../../types/branch-like';\n\ninterface SourceViewerContextShape {\n  branchLike?: BranchLike;\n  file: T.SourceViewerFile;\n}\n\nexport const SourceViewerContext = React.createContext<SourceViewerContextShape>({\n  branchLike: {} as BranchLike,\n  file: {} as T.SourceViewerFile\n});\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { uniq } from 'lodash';\n\nexport interface Token {\n  className: string;\n  markers: number[];\n  text: string;\n}\n\nconst ISSUE_LOCATION_CLASS = 'source-line-code-issue';\n\nexport function splitByTokens(code: string, rootClassName = ''): Token[] {\n  const container = document.createElement('div');\n  let tokens: Token[] = [];\n  container.innerHTML = code;\n  [].forEach.call(container.childNodes, (node: Element) => {\n    if (node.nodeType === 1) {\n      // ELEMENT NODE\n      const fullClassName = rootClassName ? rootClassName + ' ' + node.className : node.className;\n      const innerTokens = splitByTokens(node.innerHTML, fullClassName);\n      tokens = tokens.concat(innerTokens);\n    }\n    if (node.nodeType === 3 && node.nodeValue) {\n      // TEXT NODE\n      tokens.push({ className: rootClassName, markers: [], text: node.nodeValue });\n    }\n  });\n  return tokens;\n}\n\nexport function highlightSymbol(tokens: Token[], symbol: string): Token[] {\n  const symbolRegExp = new RegExp(`\\\\b${symbol}\\\\b`);\n  return tokens.map(token =>\n    symbolRegExp.test(token.className)\n      ? { ...token, className: `${token.className} highlighted` }\n      : token\n  );\n}\n\n/**\n * Intersect two ranges\n * @param s1 Start position of the first range\n * @param e1 End position of the first range\n * @param s2 Start position of the second range\n * @param e2 End position of the second range\n */\nfunction intersect(s1: number, e1: number, s2: number, e2: number) {\n  return { from: Math.max(s1, s2), to: Math.min(e1, e2) };\n}\n\n/**\n * Get the substring of a string\n * @param str A string\n * @param from \"From\" offset\n * @param to \"To\" offset\n * @param acc Global offset to eliminate\n */\nfunction part(str: string, from: number, to: number, acc: number): string {\n  // we do not want negative number as the first argument of `substr`\n  return from >= acc ? str.substr(from - acc, to - from) : str.substr(0, to - from);\n}\n\n/**\n * Highlight issue locations in the list of tokens\n */\nexport function highlightIssueLocations(\n  tokens: Token[],\n  issueLocations: T.LinearIssueLocation[],\n  rootClassName: string = ISSUE_LOCATION_CLASS\n): Token[] {\n  issueLocations.forEach(location => {\n    const nextTokens: Token[] = [];\n    let acc = 0;\n    let markerAdded = location.line !== location.startLine;\n    tokens.forEach(token => {\n      const x = intersect(acc, acc + token.text.length, location.from, location.to);\n      const p1 = part(token.text, acc, x.from, acc);\n      const p2 = part(token.text, x.from, x.to, acc);\n      const p3 = part(token.text, x.to, acc + token.text.length, acc);\n      if (p1.length) {\n        nextTokens.push({ ...token, text: p1 });\n      }\n      if (p2.length) {\n        const newClassName =\n          token.className.indexOf(rootClassName) === -1\n            ? `${token.className} ${rootClassName}`\n            : token.className;\n        nextTokens.push({\n          className: newClassName,\n          markers:\n            !markerAdded && location.index != null\n              ? uniq([...token.markers, location.index])\n              : token.markers,\n          text: p2\n        });\n        markerAdded = true;\n      }\n      if (p3.length) {\n        nextTokens.push({ ...token, text: p3 });\n      }\n      acc += token.text.length;\n    });\n    tokens = nextTokens.slice();\n  });\n  return tokens;\n}\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./LocationIndex.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".location-index{position:relative;display:inline-block;vertical-align:top;line-height:16px;padding-left:6px;padding-right:6px;border-radius:2px;background-color:#d18582;color:#fff;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;transition:background-color .3s ease;-webkit-user-select:none;-ms-user-select:none;user-select:none}.location-index.selected{background-color:#a4030f}.location-index.muted{background-color:#cdcdcd}.location-index.is-leading:first-child{margin-left:0}.location-index.is-leading:not(:first-child){margin-left:-22px}.location-index[tabindex]{cursor:pointer}.location-index[tabindex]:hover,a:hover>.location-index{background-color:#a4030f}.location-index[tabindex]:focus{outline:none}.source-line-code-inner .location-index{line-height:16px;margin:1px 4px}.source-line-code-inner .location-index+.location-index{margin-left:0}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport './LocationMessage.css';\n\ninterface Props {\n  children?: React.ReactNode;\n  selected: boolean;\n}\n\nexport default function LocationMessage(props: Props) {\n  return (\n    <div className={classNames('location-message', { selected: props.selected })}>\n      {props.children}\n    </div>\n  );\n}\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./LocationMessage.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".location-message{display:inline-block;vertical-align:top;line-height:16px;padding:0 6px;border-radius:2px;background-color:#9e9e9e;color:#fff;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;text-overflow:ellipsis;overflow:hidden;transition:background-color .3s ease}.location-message.selected{background-color:#475760}.location-index+.location-message{margin-left:4px}.location-index>.location-message{display:none;position:absolute;bottom:calc(100% + 4px);left:0}.location-index:hover>.location-message{display:block}.location-index>.location-message:after{position:absolute;bottom:-5px;left:4px;width:0;height:0;border-top:5px solid #475760;border-left:5px solid transparent;border-right:5px solid transparent;content:\\\"\\\"}.source-line-code .location-message{padding-top:2px;padding-bottom:2px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./Issue.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".issue{position:relative;padding-top:8px;padding-bottom:8px;background-color:#f2dede;transition:all .3s ease,border 0s ease}.issue.hotspot{background-color:#eeeff4}.issue.selected{box-shadow:none;outline:none;border:2px solid #4b9fd5!important}.issue+.issue,.issue-container+.issue-container{margin-top:5px}.issue.selected+.issue{border-top-color:transparent}.issue-row{display:flex;margin-bottom:5px}.issue-row-meta{flex-grow:0;padding-right:5px;white-space:nowrap}.issue-message{flex-grow:1;padding-left:8px;padding-right:8px;line-height:18px;font-size:13px;font-weight:600;text-overflow:ellipsis}.issue-actions{justify-content:space-between;flex-wrap:wrap;padding-left:8px}.issue-actions,.issue-meta-list{display:flex;align-items:center}.issue-meta{line-height:16px;font-size:12px}.issue-meta+.issue-meta{margin-left:8px}.issue-meta-label{display:inline-block;vertical-align:top;max-width:180px;line-height:16px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.issue-see-rule{border-bottom:none;font-size:12px}.issue-changelog{width:450px;max-height:320px;overflow:auto;white-space:normal}.issue-comments{margin-top:5px;padding-left:8px;font-size:12px}.issue-comment{display:flex}.issue-comment+.issue-comment{margin-top:4px}.issue-comment-author{max-width:130px;font-weight:600;overflow:hidden;text-overflow:ellipsis}.issue-comment-age,.issue-comment-author{flex-shrink:0;line-height:18px;color:#777;white-space:nowrap}.issue-comment-text{flex:1;min-width:0;margin-left:5px;margin-right:5px;line-height:18px;line-height:1.5;overflow:hidden;outline:none;word-break:break-all}.issue-comment-text.markdown pre{float:none;height:auto;margin:0;padding:8px;background-color:#e6e6e6;border:none;border-radius:3px}.issue-comment-text.markdown br~pre{margin-top:8px}.issue-comment-actions{flex-shrink:0;padding-left:5px;line-height:18px;white-space:nowrap}.issue-comment-bubble-popup{width:440px;font-size:12px}.issue-comment-form-text textarea{width:100%;max-width:100%}.issue-comment-form-footer{margin-top:5px;line-height:22px}.issue-comment-form-footer:after,.issue-comment-form-footer:before{display:table;content:\\\"\\\";line-height:0}.issue-comment-form-footer:after{clear:both}.issue-comment-form-actions{float:right}.issue-comment-form-tips{float:left}.issue-with-checkbox{padding-left:24px}.issue-with-checkbox .issue-checkbox-container{display:flex;justify-content:center;align-items:center}.issue-checkbox-container{display:none;position:absolute;width:28px;top:0;bottom:0;left:0;border:none}.issue-checkbox-container:hover{background-color:rgba(0,0,0,.05)}.issue:not(.selected) .location-index{background-color:#999}.issue .menu:not(.issues-similar-issues-menu):not(.issue-changelog){max-height:120px;overflow:auto}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nexport function getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  component: string;\n  issue: T.Issue;\n  locations: T.FlowLocation[];\n}): T.Snippet[] {\n  const { component, issue, locations } = params;\n\n  const hasSecondaryLocations = issue.secondaryLocations.length > 0;\n  const addIssueLocation = hasSecondaryLocations && issue.component === component;\n\n  // For each location: compute its range, and then compare with other ranges\n  // to merge snippets that collide.\n  const ranges = (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n\n  // Sort snippets by line number in the case of secondary locations\n  // Preserve location order for flows!\n  return hasSecondaryLocations ? ranges.sort((a, b) => a.start - b.start) : ranges;\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  issue: T.Issue,\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  const addGroup = (loc: T.FlowLocation) => {\n    currentGroup = {\n      ...(components[loc.component] || unknownComponent(loc.component)),\n      locations: []\n    };\n    groups.push(currentGroup);\n    currentComponent = loc.component;\n  };\n\n  if (\n    issue.secondaryLocations.length > 0 &&\n    locations.every(loc => loc.component !== issue.component)\n  ) {\n    addGroup(getPrimaryLocation(issue));\n  }\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      addGroup(loc);\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { IssueResponse } from '../../api/issues';\nimport { parseIssueFromResponse } from '../../helpers/issues';\n\nexport const updateIssue = (\n  onChange: (issue: T.Issue) => void,\n  resultPromise: Promise<IssueResponse>,\n  oldIssue?: T.Issue,\n  newIssue?: T.Issue\n) => {\n  const optimisticUpdate = oldIssue !== undefined && newIssue !== undefined;\n  if (optimisticUpdate) {\n    onChange(newIssue!);\n  }\n\n  resultPromise.then(\n    response => {\n      if (!optimisticUpdate) {\n        const issue = parseIssueFromResponse(\n          response.issue,\n          response.components,\n          response.users,\n          response.rules\n        );\n        onChange(issue);\n      }\n    },\n    () => {\n      if (optimisticUpdate) {\n        onChange(oldIssue!);\n      }\n    }\n  );\n};\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\n\ninterface Props {\n  active?: string;\n  className?: string;\n  item: string;\n  onHover?: (item: string) => void;\n  onSelect?: (item: string) => void;\n  title?: string;\n}\n\nexport default class SelectListItem extends React.PureComponent<Props> {\n  handleSelect = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    if (this.props.onSelect) {\n      this.props.onSelect(this.props.item);\n    }\n  };\n\n  handleHover = () => {\n    if (this.props.onHover) {\n      this.props.onHover(this.props.item);\n    }\n  };\n\n  renderLink() {\n    const children = this.props.children || this.props.item;\n    return (\n      <li>\n        <a\n          className={classNames(\n            { active: this.props.active === this.props.item },\n            this.props.className\n          )}\n          href=\"#\"\n          onClick={this.handleSelect}\n          onFocus={this.handleHover}\n          onMouseOver={this.handleHover}>\n          {children}\n        </a>\n      </li>\n    );\n  }\n\n  render() {\n    return (\n      <Tooltip overlay={this.props.title || undefined} placement=\"right\">\n        {this.renderLink()}\n      </Tooltip>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as key from 'keymaster';\nimport { uniqueId } from 'lodash';\nimport * as React from 'react';\nimport SelectListItem from './SelectListItem';\n\ninterface Props {\n  className?: string;\n  items: string[];\n  currentItem: string;\n  onSelect: (item: string) => void;\n}\n\ninterface State {\n  active: string;\n}\n\nexport default class SelectList extends React.PureComponent<Props, State> {\n  currentKeyScope?: string;\n  previousFilter?: (event: any) => void;\n  previousKeyScope?: string;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      active: props.currentItem\n    };\n  }\n\n  componentDidMount() {\n    this.attachShortcuts();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      prevProps.currentItem !== this.props.currentItem &&\n      !this.props.items.includes(this.state.active)\n    ) {\n      this.setState({ active: this.props.currentItem });\n    }\n  }\n\n  componentWillUnmount() {\n    this.detachShortcuts();\n  }\n\n  attachShortcuts = () => {\n    this.previousKeyScope = key.getScope();\n    this.previousFilter = key.filter;\n    this.currentKeyScope = uniqueId('key-scope');\n    key.setScope(this.currentKeyScope);\n\n    // sometimes there is a *focused* search field next to the SelectList component\n    // we need to allow shortcuts in this case, but only for the used keys\n    (key as any).filter = (event: KeyboardEvent & { target: HTMLElement }) => {\n      const { tagName } = event.target || event.srcElement;\n      const isInput = tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';\n      return [13, 38, 40].includes(event.keyCode) || !isInput;\n    };\n\n    key('down', this.currentKeyScope, () => {\n      this.setState(this.selectNextElement);\n      return false;\n    });\n\n    key('up', this.currentKeyScope, () => {\n      this.setState(this.selectPreviousElement);\n      return false;\n    });\n\n    key('return', this.currentKeyScope, () => {\n      if (this.state.active != null) {\n        this.handleSelect(this.state.active);\n      }\n      return false;\n    });\n  };\n\n  detachShortcuts = () => {\n    if (this.previousKeyScope) {\n      key.setScope(this.previousKeyScope);\n    }\n    if (this.currentKeyScope) {\n      key.deleteScope(this.currentKeyScope);\n    }\n    (key as any).filter = this.previousFilter;\n  };\n\n  handleSelect = (item: string) => {\n    this.props.onSelect(item);\n  };\n\n  handleHover = (item: string) => {\n    this.setState({ active: item });\n  };\n\n  selectNextElement = (state: State, props: Props) => {\n    const idx = props.items.indexOf(state.active);\n    if (idx < 0) {\n      return { active: props.items[0] };\n    }\n    return { active: props.items[(idx + 1) % props.items.length] };\n  };\n\n  selectPreviousElement = (state: State, props: Props) => {\n    const idx = props.items.indexOf(state.active);\n    if (idx <= 0) {\n      return { active: props.items[props.items.length - 1] };\n    }\n    return { active: props.items[idx - 1] };\n  };\n\n  renderChild = (child: any) => {\n    if (child == null) {\n      return null;\n    }\n    // do not pass extra props to children like `<li className=\"divider\" />`\n    if (child.type !== SelectListItem) {\n      return child;\n    }\n    return React.cloneElement(child, {\n      active: this.state.active,\n      onHover: this.handleHover,\n      onSelect: this.handleSelect\n    });\n  };\n\n  render() {\n    const { children } = this.props;\n    const hasChildren = React.Children.count(children) > 0;\n    return (\n      <ul className={classNames('menu', this.props.className)}>\n        {hasChildren && React.Children.map(children, this.renderChild)}\n        {!hasChildren &&\n          this.props.items.map(item => (\n            <SelectListItem\n              active={this.state.active}\n              item={item}\n              key={item}\n              onHover={this.handleHover}\n              onSelect={this.handleSelect}\n            />\n          ))}\n      </ul>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { map } from 'lodash';\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport SearchBox from 'sonar-ui-common/components/controls/SearchBox';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { searchMembers } from '../../../api/organizations';\nimport { searchUsers } from '../../../api/users';\nimport { isSonarCloud } from '../../../helpers/system';\nimport { isLoggedIn, isUserActive } from '../../../helpers/users';\nimport SelectList from '../../common/SelectList';\nimport SelectListItem from '../../common/SelectListItem';\nimport { withCurrentUser } from '../../hoc/withCurrentUser';\nimport Avatar from '../../ui/Avatar';\n\ninterface Props {\n  currentUser: T.CurrentUser;\n  issue: Pick<T.Issue, 'projectOrganization'>;\n  onSelect: (login: string) => void;\n}\n\ninterface State {\n  currentUser: string;\n  query: string;\n  users: T.UserActive[];\n}\n\nconst LIST_SIZE = 10;\n\nexport class SetAssigneePopup extends React.PureComponent<Props, State> {\n  defaultUsersArray: T.UserActive[];\n\n  constructor(props: Props) {\n    super(props);\n    this.defaultUsersArray = [{ login: '', name: translate('unassigned') }];\n\n    if (isLoggedIn(props.currentUser)) {\n      this.defaultUsersArray = [props.currentUser, ...this.defaultUsersArray];\n    }\n\n    this.state = {\n      query: '',\n      users: this.defaultUsersArray,\n      currentUser: this.defaultUsersArray.length > 0 ? this.defaultUsersArray[0].login : ''\n    };\n  }\n\n  searchMembers = (query: string) => {\n    searchMembers({\n      organization: this.props.issue.projectOrganization,\n      q: query,\n      ps: LIST_SIZE\n    }).then(this.handleSearchResult, () => {});\n  };\n\n  searchUsers = (query: string) => {\n    searchUsers({ q: query, ps: LIST_SIZE }).then(this.handleSearchResult, () => {});\n  };\n\n  handleSearchResult = ({ users }: { users: T.UserBase[] }) => {\n    const activeUsers = users.filter(isUserActive);\n    this.setState({\n      users: activeUsers,\n      currentUser: activeUsers.length > 0 ? activeUsers[0].login : ''\n    });\n  };\n\n  handleSearchChange = (query: string) => {\n    if (query.length === 0) {\n      this.setState({\n        query,\n        users: this.defaultUsersArray,\n        currentUser: this.defaultUsersArray[0].login\n      });\n    } else {\n      this.setState({ query });\n      if (isSonarCloud()) {\n        this.searchMembers(query);\n      } else {\n        this.searchUsers(query);\n      }\n    }\n  };\n\n  render() {\n    return (\n      <DropdownOverlay noPadding={true}>\n        <div className=\"multi-select\">\n          <div className=\"menu-search\">\n            <SearchBox\n              autoFocus={true}\n              className=\"little-spacer-top\"\n              minLength={2}\n              onChange={this.handleSearchChange}\n              placeholder={translate('search.search_for_users')}\n              value={this.state.query}\n            />\n          </div>\n          <SelectList\n            currentItem={this.state.currentUser}\n            items={map(this.state.users, 'login')}\n            onSelect={this.props.onSelect}>\n            {this.state.users.map(user => (\n              <SelectListItem item={user.login} key={user.login}>\n                {!!user.login && (\n                  <Avatar className=\"spacer-right\" hash={user.avatar} name={user.name} size={16} />\n                )}\n                <span className=\"text-middle\" style={{ marginLeft: user.login ? 24 : undefined }}>\n                  {user.name}\n                </span>\n              </SelectListItem>\n            ))}\n          </SelectList>\n        </div>\n      </DropdownOverlay>\n    );\n  }\n}\n\nexport default withCurrentUser(SetAssigneePopup);\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport DropdownIcon from 'sonar-ui-common/components/icons/DropdownIcon';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport Avatar from '../../ui/Avatar';\nimport SetAssigneePopup from '../popups/SetAssigneePopup';\n\ninterface Props {\n  isOpen: boolean;\n  issue: Pick<\n    T.Issue,\n    'assignee' | 'assigneeActive' | 'assigneeAvatar' | 'assigneeName' | 'projectOrganization'\n  >;\n  canAssign: boolean;\n  onAssign: (login: string) => void;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\nexport default class IssueAssign extends React.PureComponent<Props> {\n  toggleAssign = (open?: boolean) => {\n    this.props.togglePopup('assign', open);\n  };\n\n  handleClose = () => {\n    this.toggleAssign(false);\n  };\n\n  renderAssignee() {\n    const { issue } = this.props;\n    const assigneeName = issue.assigneeName || issue.assignee;\n\n    if (assigneeName) {\n      return (\n        <>\n          <span className=\"text-top\">\n            <Avatar\n              className=\"little-spacer-right\"\n              hash={issue.assigneeAvatar}\n              name={issue.assigneeName || issue.assignee}\n              size={16}\n            />\n          </span>\n          <span className=\"issue-meta-label\">\n            {issue.assigneeActive === false\n              ? translateWithParameters('user.x_deleted', assigneeName)\n              : assigneeName}\n          </span>\n        </>\n      );\n    }\n\n    return <span className=\"issue-meta-label\">{translate('unassigned')}</span>;\n  }\n\n  render() {\n    if (this.props.canAssign) {\n      return (\n        <div className=\"dropdown\">\n          <Toggler\n            closeOnEscape={true}\n            onRequestClose={this.handleClose}\n            open={this.props.isOpen && this.props.canAssign}\n            overlay={<SetAssigneePopup issue={this.props.issue} onSelect={this.props.onAssign} />}>\n            <ButtonLink\n              className=\"issue-action issue-action-with-options js-issue-assign\"\n              onClick={this.toggleAssign}>\n              {this.renderAssignee()}\n              <DropdownIcon className=\"little-spacer-left\" />\n            </ButtonLink>\n          </Toggler>\n        </div>\n      );\n    } else {\n      return this.renderAssignee();\n    }\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Button, ResetButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport MarkdownTips from '../../common/MarkdownTips';\n\ninterface Props {\n  comment?: Pick<T.IssueComment, 'markdown'>;\n  onComment: (text: string) => void;\n  toggleComment: (visible: boolean) => void;\n  placeholder: string;\n  placement?: PopupPlacement;\n  autoTriggered?: boolean;\n}\n\ninterface State {\n  textComment: string;\n}\n\nexport default class CommentPopup extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      textComment: props.comment ? props.comment.markdown : ''\n    };\n  }\n\n  handleCommentChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    this.setState({ textComment: event.target.value });\n  };\n\n  handleCommentClick = () => {\n    if (this.state.textComment.trim().length > 0) {\n      this.props.onComment(this.state.textComment);\n    }\n  };\n\n  handleCancelClick = () => {\n    this.props.toggleComment(false);\n  };\n\n  handleKeyboard = (event: React.KeyboardEvent) => {\n    if (event.keyCode === 13 && (event.metaKey || event.ctrlKey)) {\n      // Ctrl + Enter\n      this.handleCommentClick();\n    } else if ([37, 38, 39, 40].includes(event.keyCode)) {\n      // Arrow keys\n      event.stopPropagation();\n    }\n  };\n\n  render() {\n    const { comment, autoTriggered } = this.props;\n    return (\n      <DropdownOverlay placement={this.props.placement}>\n        <div className=\"issue-comment-bubble-popup\">\n          <div className=\"issue-comment-form-text\">\n            <textarea\n              autoFocus={true}\n              onChange={this.handleCommentChange}\n              onKeyDown={this.handleKeyboard}\n              placeholder={this.props.placeholder}\n              rows={2}\n              value={this.state.textComment}\n            />\n          </div>\n          <div className=\"issue-comment-form-footer\">\n            <div className=\"issue-comment-form-actions\">\n              <Button\n                className=\"js-issue-comment-submit little-spacer-right\"\n                disabled={this.state.textComment.trim().length < 1}\n                onClick={this.handleCommentClick}>\n                {comment && translate('save')}\n                {!comment && translate('issue.comment.submit')}\n              </Button>\n              <ResetButtonLink className=\"js-issue-comment-cancel\" onClick={this.handleCancelClick}>\n                {autoTriggered ? translate('skip') : translate('cancel')}\n              </ResetButtonLink>\n            </div>\n            <div className=\"issue-comment-form-tips\">\n              <MarkdownTips />\n            </div>\n          </div>\n        </div>\n      </DropdownOverlay>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { addIssueComment } from '../../../api/issues';\nimport { updateIssue } from '../actions';\nimport CommentPopup from '../popups/CommentPopup';\n\ninterface Props {\n  commentAutoTriggered?: boolean;\n  commentPlaceholder: string;\n  currentPopup?: string;\n  issueKey: string;\n  onChange: (issue: T.Issue) => void;\n  toggleComment: (open?: boolean, placeholder?: string, autoTriggered?: boolean) => void;\n}\n\nexport default class IssueCommentAction extends React.PureComponent<Props> {\n  addComment = (text: string) => {\n    updateIssue(this.props.onChange, addIssueComment({ issue: this.props.issueKey, text }));\n    this.props.toggleComment(false);\n  };\n\n  handleCommentClick = () => {\n    this.props.toggleComment();\n  };\n\n  handleClose = () => {\n    this.props.toggleComment(false);\n  };\n\n  render() {\n    return (\n      <li className=\"issue-meta dropdown\">\n        <Toggler\n          closeOnClickOutside={false}\n          onRequestClose={this.handleClose}\n          open={this.props.currentPopup === 'comment'}\n          overlay={\n            <CommentPopup\n              autoTriggered={this.props.commentAutoTriggered}\n              onComment={this.addComment}\n              placeholder={this.props.commentPlaceholder}\n              toggleComment={this.props.toggleComment}\n            />\n          }>\n          <ButtonLink className=\"issue-action js-issue-comment\" onClick={this.handleCommentClick}>\n            <span className=\"issue-meta-label\">{translate('issue.comment.formlink')}</span>\n          </ButtonLink>\n        </Toggler>\n      </li>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport SeverityIcon from 'sonar-ui-common/components/icons/SeverityIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport SelectList from '../../common/SelectList';\nimport SelectListItem from '../../common/SelectListItem';\n\ntype Props = {\n  issue: Pick<T.Issue, 'severity'>;\n  onSelect: (severity: string) => void;\n};\n\nconst SEVERITY = ['BLOCKER', 'CRITICAL', 'MAJOR', 'MINOR', 'INFO'];\n\nexport default function SetSeverityPopup({ issue, onSelect }: Props) {\n  return (\n    <DropdownOverlay>\n      <SelectList currentItem={issue.severity} items={SEVERITY} onSelect={onSelect}>\n        {SEVERITY.map(severity => (\n          <SelectListItem className=\"display-flex-center\" item={severity} key={severity}>\n            <SeverityIcon className=\"little-spacer-right\" severity={severity} />\n            {translate('severity', severity)}\n          </SelectListItem>\n        ))}\n      </SelectList>\n    </DropdownOverlay>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport DropdownIcon from 'sonar-ui-common/components/icons/DropdownIcon';\nimport { IssueResponse, setIssueSeverity } from '../../../api/issues';\nimport SeverityHelper from '../../shared/SeverityHelper';\nimport SetSeverityPopup from '../popups/SetSeverityPopup';\n\ninterface Props {\n  canSetSeverity: boolean;\n  isOpen: boolean;\n  issue: Pick<T.Issue, 'severity'>;\n  setIssueProperty: (\n    property: keyof T.Issue,\n    popup: string,\n    apiCall: (query: T.RawQuery) => Promise<IssueResponse>,\n    value: string\n  ) => void;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\nexport default class IssueSeverity extends React.PureComponent<Props> {\n  toggleSetSeverity = (open?: boolean) => {\n    this.props.togglePopup('set-severity', open);\n  };\n\n  setSeverity = (severity: string) => {\n    this.props.setIssueProperty('severity', 'set-severity', setIssueSeverity, severity);\n  };\n\n  handleClose = () => {\n    this.toggleSetSeverity(false);\n  };\n\n  render() {\n    const { issue } = this.props;\n    if (this.props.canSetSeverity) {\n      return (\n        <div className=\"dropdown\">\n          <Toggler\n            onRequestClose={this.handleClose}\n            open={this.props.isOpen && this.props.canSetSeverity}\n            overlay={<SetSeverityPopup issue={issue} onSelect={this.setSeverity} />}>\n            <ButtonLink\n              className=\"issue-action issue-action-with-options js-issue-set-severity\"\n              onClick={this.toggleSetSeverity}>\n              <SeverityHelper className=\"issue-meta-label\" severity={issue.severity} />\n              <DropdownIcon className=\"little-spacer-left\" />\n            </ButtonLink>\n          </Toggler>\n        </div>\n      );\n    } else {\n      return <SeverityHelper className=\"issue-meta-label\" severity={issue.severity} />;\n    }\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { difference, without } from 'lodash';\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { searchIssueTags } from '../../../api/issues';\nimport TagsSelector from '../../tags/TagsSelector';\n\ninterface Props {\n  organization: string;\n  selectedTags: string[];\n  setTags: (tags: string[]) => void;\n}\n\ninterface State {\n  searchResult: string[];\n}\n\nconst LIST_SIZE = 10;\n\nexport default class SetIssueTagsPopup extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = { searchResult: [] };\n\n  componentDidMount() {\n    this.mounted = true;\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  onSearch = (query: string) => {\n    return searchIssueTags({\n      q: query,\n      ps: Math.min(this.props.selectedTags.length - 1 + LIST_SIZE, 100),\n      organization: this.props.organization\n    }).then(\n      (tags: string[]) => {\n        if (this.mounted) {\n          this.setState({ searchResult: tags });\n        }\n      },\n      () => {}\n    );\n  };\n\n  onSelect = (tag: string) => {\n    this.props.setTags([...this.props.selectedTags, tag]);\n  };\n\n  onUnselect = (tag: string) => {\n    this.props.setTags(without(this.props.selectedTags, tag));\n  };\n\n  render() {\n    const availableTags = difference(this.state.searchResult, this.props.selectedTags);\n    return (\n      <DropdownOverlay placement={PopupPlacement.BottomRight}>\n        <TagsSelector\n          listSize={LIST_SIZE}\n          onSearch={this.onSearch}\n          onSelect={this.onSelect}\n          onUnselect={this.onUnselect}\n          selectedTags={this.props.selectedTags}\n          tags={availableTags}\n        />\n      </DropdownOverlay>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { setIssueTags } from '../../../api/issues';\nimport TagsList from '../../tags/TagsList';\nimport { updateIssue } from '../actions';\nimport SetIssueTagsPopup from '../popups/SetIssueTagsPopup';\n\ninterface Props {\n  canSetTags: boolean;\n  isOpen: boolean;\n  issue: Pick<T.Issue, 'key' | 'projectOrganization' | 'tags'>;\n  onChange: (issue: T.Issue) => void;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\nexport default class IssueTags extends React.PureComponent<Props> {\n  toggleSetTags = (open?: boolean) => {\n    this.props.togglePopup('edit-tags', open);\n  };\n\n  setTags = (tags: string[]) => {\n    const { issue } = this.props;\n    const newIssue = { ...issue, tags };\n    updateIssue(\n      this.props.onChange,\n      setIssueTags({ issue: issue.key, tags: tags.join(',') }),\n      issue as T.Issue,\n      newIssue as T.Issue\n    );\n  };\n\n  handleClose = () => {\n    this.toggleSetTags(false);\n  };\n\n  render() {\n    const { issue } = this.props;\n    const { tags = [] } = issue;\n\n    if (this.props.canSetTags) {\n      return (\n        <div className=\"dropdown\">\n          <Toggler\n            onRequestClose={this.handleClose}\n            open={this.props.isOpen}\n            overlay={\n              <SetIssueTagsPopup\n                organization={issue.projectOrganization}\n                selectedTags={tags}\n                setTags={this.setTags}\n              />\n            }>\n            <ButtonLink\n              className=\"issue-action issue-action-with-options js-issue-edit-tags\"\n              onClick={this.toggleSetTags}>\n              <TagsList\n                allowUpdate={this.props.canSetTags}\n                tags={\n                  issue.tags && issue.tags.length > 0 ? issue.tags : [translate('issue.no_tag')]\n                }\n              />\n            </ButtonLink>\n          </Toggler>\n        </div>\n      );\n    } else {\n      return (\n        <TagsList\n          allowUpdate={this.props.canSetTags}\n          className=\"note\"\n          tags={issue.tags && issue.tags.length > 0 ? issue.tags : [translate('issue.no_tag')]}\n        />\n      );\n    }\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport { hasMessage, translate } from 'sonar-ui-common/helpers/l10n';\nimport SelectList from '../../common/SelectList';\nimport SelectListItem from '../../common/SelectListItem';\n\nexport interface Props {\n  fromHotspot: boolean;\n  onSelect: (transition: string) => void;\n  transitions: string[];\n  type: T.IssueType;\n}\n\nexport default function SetTransitionPopup({ fromHotspot, onSelect, transitions, type }: Props) {\n  const isManualVulnerability = fromHotspot && type === 'VULNERABILITY';\n  return (\n    <DropdownOverlay>\n      <SelectList currentItem={transitions[0]} items={transitions} onSelect={onSelect}>\n        {transitions.map(transition => {\n          const [name, description] = translateTransition(transition, isManualVulnerability);\n          return (\n            <SelectListItem item={transition} key={transition} title={description}>\n              {name}\n            </SelectListItem>\n          );\n        })}\n      </SelectList>\n    </DropdownOverlay>\n  );\n}\n\nfunction translateTransition(transition: string, isManualVulnerability: boolean) {\n  return isManualVulnerability && hasMessage('vulnerability.transition', transition)\n    ? [\n        translate('vulnerability.transition', transition),\n        translate('vulnerability.transition', transition, 'description')\n      ]\n    : [\n        translate('issue.transition', transition),\n        translate('issue.transition', transition, 'description')\n      ];\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport DropdownIcon from 'sonar-ui-common/components/icons/DropdownIcon';\nimport { setIssueTransition } from '../../../api/issues';\nimport StatusHelper from '../../shared/StatusHelper';\nimport { updateIssue } from '../actions';\nimport SetTransitionPopup from '../popups/SetTransitionPopup';\n\ninterface Props {\n  hasTransitions: boolean;\n  isOpen: boolean;\n  issue: Pick<T.Issue, 'fromHotspot' | 'key' | 'resolution' | 'status' | 'transitions' | 'type'>;\n  onChange: (issue: T.Issue) => void;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\nexport default class IssueTransition extends React.PureComponent<Props> {\n  setTransition = (transition: string) => {\n    updateIssue(\n      this.props.onChange,\n      setIssueTransition({ issue: this.props.issue.key, transition })\n    );\n    this.toggleSetTransition();\n  };\n\n  toggleSetTransition = (open?: boolean) => {\n    this.props.togglePopup('transition', open);\n  };\n\n  handleClose = () => {\n    this.toggleSetTransition(false);\n  };\n\n  render() {\n    const { issue } = this.props;\n\n    if (this.props.hasTransitions) {\n      return (\n        <div className=\"dropdown\">\n          <Toggler\n            onRequestClose={this.handleClose}\n            open={this.props.isOpen && this.props.hasTransitions}\n            overlay={\n              <SetTransitionPopup\n                fromHotspot={issue.fromHotspot}\n                onSelect={this.setTransition}\n                transitions={issue.transitions}\n                type={issue.type}\n              />\n            }>\n            <ButtonLink\n              className=\"issue-action issue-action-with-options js-issue-transition\"\n              onClick={this.toggleSetTransition}>\n              <StatusHelper\n                className=\"issue-meta-label\"\n                resolution={issue.resolution}\n                status={issue.status}\n              />\n              <DropdownIcon className=\"little-spacer-left\" />\n            </ButtonLink>\n          </Toggler>\n        </div>\n      );\n    } else {\n      return (\n        <StatusHelper\n          className=\"issue-meta-label\"\n          resolution={issue.resolution}\n          status={issue.status}\n        />\n      );\n    }\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport IssueTypeIcon from 'sonar-ui-common/components/icons/IssueTypeIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport SelectList from '../../common/SelectList';\nimport SelectListItem from '../../common/SelectListItem';\n\ninterface Props {\n  issue: Pick<T.Issue, 'type'>;\n  onSelect: (type: T.IssueType) => void;\n}\n\nconst TYPES = ['BUG', 'VULNERABILITY', 'CODE_SMELL'];\n\nexport default function SetTypePopup({ issue, onSelect }: Props) {\n  return (\n    <DropdownOverlay>\n      <SelectList currentItem={issue.type} items={TYPES} onSelect={onSelect}>\n        {TYPES.map(type => (\n          <SelectListItem className=\"display-flex-center\" item={type} key={type}>\n            <IssueTypeIcon className=\"little-spacer-right\" query={type} />\n            {translate('issue.type', type)}\n          </SelectListItem>\n        ))}\n      </SelectList>\n    </DropdownOverlay>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport DropdownIcon from 'sonar-ui-common/components/icons/DropdownIcon';\nimport IssueTypeIcon from 'sonar-ui-common/components/icons/IssueTypeIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { IssueResponse, setIssueType } from '../../../api/issues';\nimport { colors } from '../../../app/theme';\nimport SetTypePopup from '../popups/SetTypePopup';\n\ninterface Props {\n  canSetType: boolean;\n  isOpen: boolean;\n  issue: Pick<T.Issue, 'type'>;\n  setIssueProperty: (\n    property: keyof T.Issue,\n    popup: string,\n    apiCall: (query: T.RawQuery) => Promise<IssueResponse>,\n    value: string\n  ) => void;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\nexport default class IssueType extends React.PureComponent<Props> {\n  toggleSetType = (open?: boolean) => {\n    this.props.togglePopup('set-type', open);\n  };\n\n  setType = (type: string) => {\n    this.props.setIssueProperty('type', 'set-type', setIssueType, type);\n  };\n\n  handleClose = () => {\n    this.toggleSetType(false);\n  };\n\n  render() {\n    const { issue } = this.props;\n    if (this.props.canSetType) {\n      return (\n        <div className=\"dropdown\">\n          <Toggler\n            onRequestClose={this.handleClose}\n            open={this.props.isOpen && this.props.canSetType}\n            overlay={<SetTypePopup issue={issue} onSelect={this.setType} />}>\n            <ButtonLink\n              className=\"issue-action issue-action-with-options js-issue-set-type\"\n              onClick={this.toggleSetType}>\n              <IssueTypeIcon\n                className=\"little-spacer-right\"\n                fill={colors.baseFontColor}\n                query={issue.type}\n              />\n              {translate('issue.type', issue.type)}\n              <DropdownIcon className=\"little-spacer-left\" />\n            </ButtonLink>\n          </Toggler>\n        </div>\n      );\n    } else {\n      return (\n        <span>\n          <IssueTypeIcon className=\"little-spacer-right\" query={issue.type} />\n          {translate('issue.type', issue.type)}\n        </span>\n      );\n    }\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { IssueResponse } from '../../../api/issues';\nimport { updateIssue } from '../actions';\nimport IssueAssign from './IssueAssign';\nimport IssueCommentAction from './IssueCommentAction';\nimport IssueSeverity from './IssueSeverity';\nimport IssueTags from './IssueTags';\nimport IssueTransition from './IssueTransition';\nimport IssueType from './IssueType';\n\ninterface Props {\n  issue: T.Issue;\n  currentPopup?: string;\n  onAssign: (login: string) => void;\n  onChange: (issue: T.Issue) => void;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\ninterface State {\n  commentAutoTriggered: boolean;\n  commentPlaceholder: string;\n}\n\nexport default class IssueActionsBar extends React.PureComponent<Props, State> {\n  state: State = {\n    commentAutoTriggered: false,\n    commentPlaceholder: ''\n  };\n\n  setIssueProperty = (\n    property: keyof T.Issue,\n    popup: string,\n    apiCall: (query: T.RawQuery) => Promise<IssueResponse>,\n    value: string\n  ) => {\n    const { issue } = this.props;\n    if (issue[property] !== value) {\n      const newIssue = { ...issue, [property]: value };\n      updateIssue(\n        this.props.onChange,\n        apiCall({ issue: issue.key, [property]: value }),\n        issue,\n        newIssue\n      );\n    }\n    this.props.togglePopup(popup, false);\n  };\n\n  toggleComment = (open: boolean | undefined, placeholder = '', autoTriggered = false) => {\n    this.setState({\n      commentPlaceholder: placeholder,\n      commentAutoTriggered: autoTriggered\n    });\n    this.props.togglePopup('comment', open);\n  };\n\n  handleTransition = (issue: T.Issue) => {\n    this.props.onChange(issue);\n    if (\n      issue.resolution === 'FALSE-POSITIVE' ||\n      (issue.resolution === 'WONTFIX' && issue.type !== 'SECURITY_HOTSPOT')\n    ) {\n      this.toggleComment(true, translate('issue.comment.explain_why'), true);\n    }\n  };\n\n  render() {\n    const { issue } = this.props;\n    const canAssign = issue.actions.includes('assign');\n    const canComment = issue.actions.includes('comment');\n    const canSetSeverity = issue.actions.includes('set_severity');\n    const canSetType = issue.actions.includes('set_type');\n    const canSetTags = issue.actions.includes('set_tags');\n    const hasTransitions = issue.transitions && issue.transitions.length > 0;\n    const isSecurityHotspot = issue.type === 'SECURITY_HOTSPOT';\n\n    return (\n      <div className=\"issue-actions\">\n        <ul className=\"issue-meta-list\">\n          <li className=\"issue-meta\">\n            <IssueType\n              canSetType={canSetType}\n              isOpen={this.props.currentPopup === 'set-type' && canSetType}\n              issue={issue}\n              setIssueProperty={this.setIssueProperty}\n              togglePopup={this.props.togglePopup}\n            />\n          </li>\n          {!isSecurityHotspot && (\n            <li className=\"issue-meta\">\n              <IssueSeverity\n                canSetSeverity={canSetSeverity}\n                isOpen={this.props.currentPopup === 'set-severity' && canSetSeverity}\n                issue={issue}\n                setIssueProperty={this.setIssueProperty}\n                togglePopup={this.props.togglePopup}\n              />\n            </li>\n          )}\n          <li className=\"issue-meta\">\n            <IssueTransition\n              hasTransitions={hasTransitions}\n              isOpen={this.props.currentPopup === 'transition' && hasTransitions}\n              issue={issue}\n              onChange={this.handleTransition}\n              togglePopup={this.props.togglePopup}\n            />\n          </li>\n          <li className=\"issue-meta\">\n            <IssueAssign\n              canAssign={canAssign}\n              isOpen={this.props.currentPopup === 'assign' && canAssign}\n              issue={issue}\n              onAssign={this.props.onAssign}\n              togglePopup={this.props.togglePopup}\n            />\n          </li>\n          {!isSecurityHotspot && issue.effort && (\n            <li className=\"issue-meta\">\n              <span className=\"issue-meta-label\">\n                {translateWithParameters('issue.x_effort', issue.effort)}\n              </span>\n            </li>\n          )}\n          {canComment && (\n            <IssueCommentAction\n              commentAutoTriggered={this.state.commentAutoTriggered}\n              commentPlaceholder={this.state.commentPlaceholder}\n              currentPopup={this.props.currentPopup}\n              issueKey={issue.key}\n              onChange={this.props.onChange}\n              toggleComment={this.toggleComment}\n            />\n          )}\n        </ul>\n        <ul className=\"list-inline\">\n          <li className=\"issue-meta js-issue-tags\">\n            <IssueTags\n              canSetTags={canSetTags}\n              isOpen={this.props.currentPopup === 'edit-tags' && canSetTags}\n              issue={issue}\n              onChange={this.props.onChange}\n              togglePopup={this.props.togglePopup}\n            />\n          </li>\n        </ul>\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Button } from 'sonar-ui-common/components/controls/buttons';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\ninterface Props {\n  onDelete: () => void;\n}\n\nexport default function CommentDeletePopup({ onDelete }: Props) {\n  return (\n    <DropdownOverlay placement={PopupPlacement.BottomRight}>\n      <div className=\"menu is-container\">\n        <div className=\"spacer-bottom\">{translate('issue.comment.delete_confirm_message')}</div>\n        <Button className=\"button-red\" onClick={onDelete}>\n          {translate('delete')}\n        </Button>\n      </div>\n    </DropdownOverlay>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { sanitize } from 'dompurify';\nimport * as React from 'react';\nimport { DeleteButton, EditButton } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport DateFromNow from 'sonar-ui-common/components/intl/DateFromNow';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport Avatar from '../../ui/Avatar';\nimport CommentDeletePopup from '../popups/CommentDeletePopup';\nimport CommentPopup from '../popups/CommentPopup';\n\ninterface Props {\n  comment: T.IssueComment;\n  onDelete: (comment: string) => void;\n  onEdit: (comment: string, text: string) => void;\n}\n\ninterface State {\n  openPopup: string;\n}\n\nexport default class IssueCommentLine extends React.PureComponent<Props, State> {\n  state: State = {\n    openPopup: ''\n  };\n\n  handleEdit = (text: string) => {\n    this.props.onEdit(this.props.comment.key, text);\n    this.toggleEditPopup(false);\n  };\n\n  handleDelete = () => {\n    this.props.onDelete(this.props.comment.key);\n    this.toggleDeletePopup(false);\n  };\n\n  togglePopup = (popupName: string, force?: boolean) => {\n    this.setState(prevState => {\n      if (prevState.openPopup !== popupName && force !== false) {\n        return { openPopup: popupName };\n      } else if (prevState.openPopup === popupName && force !== true) {\n        return { openPopup: '' };\n      }\n      return prevState;\n    });\n  };\n\n  toggleDeletePopup = (force?: boolean) => {\n    this.togglePopup('delete', force);\n  };\n\n  toggleEditPopup = (force?: boolean) => {\n    this.togglePopup('edit', force);\n  };\n\n  closePopups = () => {\n    this.setState({ openPopup: '' });\n  };\n\n  render() {\n    const { comment } = this.props;\n    const author = comment.authorName || comment.author;\n    const displayName =\n      comment.authorActive === false && author\n        ? translateWithParameters('user.x_deleted', author)\n        : author;\n    return (\n      <div className=\"issue-comment\">\n        <div className=\"issue-comment-author\" title={displayName}>\n          <Avatar\n            className=\"little-spacer-right\"\n            hash={comment.authorAvatar}\n            name={author}\n            size={16}\n          />\n          {displayName}\n        </div>\n        <div\n          className=\"issue-comment-text markdown\"\n          dangerouslySetInnerHTML={{ __html: sanitize(comment.htmlText) }}\n        />\n        <div className=\"issue-comment-age\">\n          <DateFromNow date={comment.createdAt} />\n        </div>\n        <div className=\"issue-comment-actions\">\n          {comment.updatable && (\n            <div className=\"dropdown\">\n              <Toggler\n                closeOnClickOutside={false}\n                onRequestClose={this.closePopups}\n                open={this.state.openPopup === 'edit'}\n                overlay={\n                  <CommentPopup\n                    comment={comment}\n                    onComment={this.handleEdit}\n                    placeholder=\"\"\n                    placement={PopupPlacement.BottomRight}\n                    toggleComment={this.toggleEditPopup}\n                  />\n                }>\n                <EditButton\n                  className=\"js-issue-comment-edit button-small\"\n                  onClick={this.toggleEditPopup}\n                />\n              </Toggler>\n            </div>\n          )}\n          {comment.updatable && (\n            <div className=\"dropdown\">\n              <Toggler\n                onRequestClose={this.closePopups}\n                open={this.state.openPopup === 'delete'}\n                overlay={<CommentDeletePopup onDelete={this.handleDelete} />}>\n                <DeleteButton\n                  className=\"js-issue-comment-delete button-small\"\n                  onClick={this.toggleDeletePopup}\n                />\n              </Toggler>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport DateTimeFormatter from 'sonar-ui-common/components/intl/DateTimeFormatter';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { getIssueChangelog } from '../../../api/issues';\nimport Avatar from '../../ui/Avatar';\nimport IssueChangelogDiff from '../components/IssueChangelogDiff';\n\ninterface Props {\n  issue: Pick<T.Issue, 'author' | 'creationDate' | 'key'>;\n}\n\ninterface State {\n  changelog: T.IssueChangelog[];\n}\n\nexport default class ChangelogPopup extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = { changelog: [] };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.loadChangelog();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  loadChangelog() {\n    getIssueChangelog(this.props.issue.key).then(\n      ({ changelog }) => {\n        if (this.mounted) {\n          this.setState({ changelog });\n        }\n      },\n      () => {}\n    );\n  }\n\n  render() {\n    const { issue } = this.props;\n    const { author } = issue;\n    return (\n      <DropdownOverlay placement={PopupPlacement.BottomRight}>\n        <div className=\"menu is-container issue-changelog\">\n          <table className=\"spaced\">\n            <tbody>\n              <tr>\n                <td className=\"thin text-left text-top nowrap\">\n                  <DateTimeFormatter date={issue.creationDate} />\n                </td>\n                <td className=\"text-left text-top\">\n                  {author ? `${translate('created_by')} ${author}` : translate('created')}\n                </td>\n              </tr>\n\n              {this.state.changelog.map((item, idx) => {\n                const userName = item.userName || item.user;\n\n                return (\n                  <tr key={idx}>\n                    <td className=\"thin text-left text-top nowrap\">\n                      <DateTimeFormatter date={item.creationDate} />\n                    </td>\n                    <td className=\"text-left text-top\">\n                      {userName && (\n                        <p>\n                          <Avatar\n                            className=\"little-spacer-right\"\n                            hash={item.avatar}\n                            name={userName}\n                            size={16}\n                          />\n                          {item.isUserActive\n                            ? userName\n                            : translateWithParameters('user.x_deleted', userName)}\n                        </p>\n                      )}\n                      {item.diffs.map(diff => (\n                        <IssueChangelogDiff diff={diff} key={diff.key} />\n                      ))}\n                    </td>\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      </DropdownOverlay>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport DropdownIcon from 'sonar-ui-common/components/icons/DropdownIcon';\nimport DateFromNow from 'sonar-ui-common/components/intl/DateFromNow';\nimport DateTimeFormatter from 'sonar-ui-common/components/intl/DateTimeFormatter';\nimport ChangelogPopup from '../popups/ChangelogPopup';\n\ninterface Props {\n  isOpen: boolean;\n  issue: Pick<T.Issue, 'author' | 'creationDate' | 'key'>;\n  creationDate: string;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\nexport default class IssueChangelog extends React.PureComponent<Props> {\n  toggleChangelog = (open?: boolean) => {\n    this.props.togglePopup('changelog', open);\n  };\n\n  handleClick = () => {\n    this.toggleChangelog();\n  };\n\n  handleClose = () => {\n    this.toggleChangelog(false);\n  };\n\n  render() {\n    return (\n      <div className=\"dropdown\">\n        <Toggler\n          onRequestClose={this.handleClose}\n          open={this.props.isOpen}\n          overlay={<ChangelogPopup issue={this.props.issue} />}>\n          <Tooltip\n            mouseEnterDelay={0.5}\n            overlay={<DateTimeFormatter date={this.props.creationDate} />}>\n            <ButtonLink\n              className=\"issue-action issue-action-with-options js-issue-show-changelog\"\n              onClick={this.handleClick}>\n              <span className=\"issue-meta-label\">\n                <DateFromNow date={this.props.creationDate} />\n              </span>\n              <DropdownIcon className=\"little-spacer-left\" />\n            </ButtonLink>\n          </Tooltip>\n        </Toggler>\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { WorkspaceContextShape } from '../../workspace/context';\n\nexport interface IssueMessageProps {\n  engine?: string;\n  manualVulnerability: boolean;\n  message: string;\n  onOpenRule: WorkspaceContextShape['openRule'];\n  organization: string;\n  ruleKey: string;\n}\n\nexport default function IssueMessage(props: IssueMessageProps) {\n  const { engine, manualVulnerability, message, organization, ruleKey } = props;\n\n  return (\n    <div className=\"issue-message\">\n      <span className=\"spacer-right\">{message}</span>\n      <ButtonLink\n        aria-label={translate('issue.why_this_issue.long')}\n        className=\"issue-see-rule spacer-right\"\n        onClick={() => props.onOpenRule({ key: ruleKey, organization })}>\n        {translate('issue.why_this_issue')}\n      </ButtonLink>\n\n      {engine && (\n        <Tooltip overlay={translateWithParameters('issue.from_external_rule_engine', engine)}>\n          <div className=\"badge spacer-right text-top\">{engine}</div>\n        </Tooltip>\n      )}\n      {manualVulnerability && (\n        <Tooltip overlay={translate('issue.manual_vulnerability.description')}>\n          <div className=\"badge spacer-right text-top\">\n            {translate('issue.manual_vulnerability')}\n          </div>\n        </Tooltip>\n      )}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport IssueTypeIcon from 'sonar-ui-common/components/icons/IssueTypeIcon';\nimport QualifierIcon from 'sonar-ui-common/components/icons/QualifierIcon';\nimport TagsIcon from 'sonar-ui-common/components/icons/TagsIcon';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { fileFromPath, limitComponentName } from 'sonar-ui-common/helpers/path';\nimport SelectList from '../../common/SelectList';\nimport SelectListItem from '../../common/SelectListItem';\nimport SeverityHelper from '../../shared/SeverityHelper';\nimport StatusHelper from '../../shared/StatusHelper';\nimport Avatar from '../../ui/Avatar';\n\ninterface Props {\n  issue: T.Issue;\n  onFilter: (property: string, issue: T.Issue) => void;\n}\n\nexport default class SimilarIssuesPopup extends React.PureComponent<Props> {\n  handleSelect = (property: string) => {\n    this.props.onFilter(property, this.props.issue);\n  };\n\n  render() {\n    const { issue } = this.props;\n\n    const items = [\n      'type',\n      'severity',\n      'status',\n      'resolution',\n      'assignee',\n      'rule',\n      ...(issue.tags || []).map(tag => `tag###${tag}`),\n      'project',\n      issue.subProject ? 'module' : undefined,\n      'file'\n    ].filter(item => item) as string[];\n\n    const assignee = issue.assigneeName || issue.assignee;\n\n    return (\n      <DropdownOverlay noPadding={true}>\n        <header className=\"menu-search\">\n          <h6>{translate('issue.filter_similar_issues')}</h6>\n        </header>\n\n        <SelectList\n          className=\"issues-similar-issues-menu\"\n          currentItem={items[0]}\n          items={items}\n          onSelect={this.handleSelect}>\n          <SelectListItem className=\"display-flex-center\" item=\"type\">\n            <IssueTypeIcon className=\"little-spacer-right\" query={issue.type} />\n            {translate('issue.type', issue.type)}\n          </SelectListItem>\n\n          <SelectListItem item=\"severity\">\n            <SeverityHelper className=\"display-flex-center\" severity={issue.severity} />\n          </SelectListItem>\n\n          <SelectListItem item=\"status\">\n            <StatusHelper\n              className=\"display-flex-center\"\n              resolution={undefined}\n              status={issue.status}\n            />\n          </SelectListItem>\n\n          <SelectListItem item=\"resolution\">\n            {issue.resolution != null\n              ? translate('issue.resolution', issue.resolution)\n              : translate('unresolved')}\n          </SelectListItem>\n\n          <SelectListItem item=\"assignee\">\n            {assignee ? (\n              <span>\n                {translate('assigned_to')}\n                <Avatar\n                  className=\"little-spacer-left little-spacer-right\"\n                  hash={issue.assigneeAvatar}\n                  name={assignee}\n                  size={16}\n                />\n                {issue.assigneeActive === false\n                  ? translateWithParameters('user.x_deleted', assignee)\n                  : assignee}\n              </span>\n            ) : (\n              translate('unassigned')\n            )}\n          </SelectListItem>\n\n          <li className=\"divider\" />\n\n          <SelectListItem item=\"rule\">{limitComponentName(issue.ruleName)}</SelectListItem>\n\n          {issue.tags != null &&\n            issue.tags.map(tag => (\n              <SelectListItem item={`tag###${tag}`} key={`tag###${tag}`}>\n                <TagsIcon className=\"icon-half-transparent little-spacer-right text-middle\" />\n                <span className=\"text-middle\">{tag}</span>\n              </SelectListItem>\n            ))}\n\n          <li className=\"divider\" />\n\n          <SelectListItem item=\"project\">\n            <QualifierIcon className=\"little-spacer-right\" qualifier=\"TRK\" />\n            {issue.projectName}\n          </SelectListItem>\n\n          {issue.subProject != null && (\n            <SelectListItem item=\"module\">\n              <QualifierIcon className=\"little-spacer-right\" qualifier=\"BRC\" />\n              {issue.subProjectName}\n            </SelectListItem>\n          )}\n\n          <SelectListItem item=\"file\">\n            <QualifierIcon className=\"little-spacer-right\" qualifier={issue.componentQualifier} />\n            {fileFromPath(issue.componentLongName)}\n          </SelectListItem>\n        </SelectList>\n      </DropdownOverlay>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ButtonLink } from 'sonar-ui-common/components/controls/buttons';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport DropdownIcon from 'sonar-ui-common/components/icons/DropdownIcon';\nimport FilterIcon from 'sonar-ui-common/components/icons/FilterIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport SimilarIssuesPopup from '../popups/SimilarIssuesPopup';\n\ninterface Props {\n  isOpen: boolean;\n  issue: T.Issue;\n  togglePopup: (popup: string, show?: boolean) => void;\n  onFilter?: (property: string, issue: T.Issue) => void;\n}\n\nexport default class SimilarIssuesFilter extends React.PureComponent<Props> {\n  handleFilter = (property: string, issue: T.Issue) => {\n    this.togglePopup(false);\n    if (this.props.onFilter) {\n      this.props.onFilter(property, issue);\n    }\n  };\n\n  togglePopup = (open?: boolean) => {\n    this.props.togglePopup('similarIssues', open);\n  };\n\n  handleClose = () => {\n    this.togglePopup(false);\n  };\n\n  render() {\n    return (\n      <div className=\"dropdown\">\n        <Toggler\n          onRequestClose={this.handleClose}\n          open={this.props.isOpen}\n          overlay={<SimilarIssuesPopup issue={this.props.issue} onFilter={this.handleFilter} />}>\n          <ButtonLink\n            aria-label={translate('issue.filter_similar_issues')}\n            className=\"issue-action issue-action-with-options js-issue-filter\"\n            onClick={this.togglePopup}\n            title={translate('issue.filter_similar_issues')}>\n            <FilterIcon className=\"icon-half-transparent\" />\n            <DropdownIcon className=\"icon-half-transparent\" />\n          </ButtonLink>\n        </Toggler>\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport LinkIcon from 'sonar-ui-common/components/icons/LinkIcon';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { formatMeasure } from 'sonar-ui-common/helpers/measures';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { getComponentIssuesUrl } from '../../../helpers/urls';\nimport { BranchLike } from '../../../types/branch-like';\nimport LocationIndex from '../../common/LocationIndex';\nimport { WorkspaceContext } from '../../workspace/context';\nimport IssueChangelog from './IssueChangelog';\nimport IssueMessage from './IssueMessage';\nimport SimilarIssuesFilter from './SimilarIssuesFilter';\n\ninterface Props {\n  branchLike?: BranchLike;\n  currentPopup?: string;\n  displayLocationsCount?: boolean;\n  displayLocationsLink?: boolean;\n  issue: T.Issue;\n  onFilter?: (property: string, issue: T.Issue) => void;\n  togglePopup: (popup: string, show?: boolean) => void;\n}\n\nexport default function IssueTitleBar(props: Props) {\n  const { issue } = props;\n  const hasSimilarIssuesFilter = props.onFilter != null;\n\n  const locationsCount =\n    issue.secondaryLocations.length +\n    issue.flows.reduce((sum, locations) => sum + locations.length, 0);\n\n  const locationsBadge = (\n    <Tooltip\n      overlay={translateWithParameters(\n        'issue.this_issue_involves_x_code_locations',\n        formatMeasure(locationsCount, 'INT')\n      )}>\n      <LocationIndex>{locationsCount}</LocationIndex>\n    </Tooltip>\n  );\n\n  const displayLocations = props.displayLocationsCount && locationsCount > 0;\n\n  const issueUrl = getComponentIssuesUrl(issue.project, {\n    ...getBranchLikeQuery(props.branchLike),\n    issues: issue.key,\n    open: issue.key,\n    types: issue.type === 'SECURITY_HOTSPOT' ? issue.type : undefined\n  });\n\n  return (\n    <div className=\"issue-row\">\n      <WorkspaceContext.Consumer>\n        {({ openRule }) => (\n          <IssueMessage\n            engine={issue.externalRuleEngine}\n            manualVulnerability={issue.fromHotspot && issue.type === 'VULNERABILITY'}\n            message={issue.message}\n            onOpenRule={openRule}\n            organization={issue.organization}\n            ruleKey={issue.rule}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n\n      <div className=\"issue-row-meta\">\n        <ul className=\"issue-meta-list\">\n          <li className=\"issue-meta\">\n            <IssueChangelog\n              creationDate={issue.creationDate}\n              isOpen={props.currentPopup === 'changelog'}\n              issue={issue}\n              togglePopup={props.togglePopup}\n            />\n          </li>\n          {issue.textRange != null && (\n            <li className=\"issue-meta\">\n              <span className=\"issue-meta-label\" title={translate('line_number')}>\n                L{issue.textRange.endLine}\n              </span>\n            </li>\n          )}\n          {displayLocations && (\n            <li className=\"issue-meta\">\n              {props.displayLocationsLink ? (\n                <Link target=\"_blank\" to={issueUrl}>\n                  {locationsBadge}\n                </Link>\n              ) : (\n                locationsBadge\n              )}\n            </li>\n          )}\n          <li className=\"issue-meta\">\n            <Link\n              className=\"js-issue-permalink link-no-underline\"\n              target=\"_blank\"\n              title={translate('permalink')}\n              to={issueUrl}>\n              <LinkIcon />\n            </Link>\n          </li>\n          {hasSimilarIssuesFilter && (\n            <li className=\"issue-meta\">\n              <SimilarIssuesFilter\n                isOpen={props.currentPopup === 'similarIssues'}\n                issue={issue}\n                onFilter={props.onFilter}\n                togglePopup={props.togglePopup}\n              />\n            </li>\n          )}\n        </ul>\n      </div>\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport Checkbox from 'sonar-ui-common/components/controls/Checkbox';\nimport { deleteIssueComment, editIssueComment } from '../../api/issues';\nimport { BranchLike } from '../../types/branch-like';\nimport { updateIssue } from './actions';\nimport IssueActionsBar from './components/IssueActionsBar';\nimport IssueCommentLine from './components/IssueCommentLine';\nimport IssueTitleBar from './components/IssueTitleBar';\n\ninterface Props {\n  branchLike?: BranchLike;\n  checked?: boolean;\n  currentPopup?: string;\n  displayLocationsCount?: boolean;\n  displayLocationsLink?: boolean;\n  issue: T.Issue;\n  onAssign: (login: string) => void;\n  onChange: (issue: T.Issue) => void;\n  onCheck?: (issue: string) => void;\n  onClick: (issueKey: string) => void;\n  onFilter?: (property: string, issue: T.Issue) => void;\n  selected: boolean;\n  togglePopup: (popup: string, show: boolean | void) => void;\n}\n\nexport default class IssueView extends React.PureComponent<Props> {\n  handleCheck = () => {\n    if (this.props.onCheck) {\n      this.props.onCheck(this.props.issue.key);\n    }\n  };\n\n  handleClick = (event: React.MouseEvent<HTMLDivElement>) => {\n    if (!isClickable(event.target as HTMLElement) && this.props.onClick) {\n      event.preventDefault();\n      this.props.onClick(this.props.issue.key);\n    }\n  };\n\n  editComment = (comment: string, text: string) => {\n    updateIssue(this.props.onChange, editIssueComment({ comment, text }));\n  };\n\n  deleteComment = (comment: string) => {\n    updateIssue(this.props.onChange, deleteIssueComment({ comment }));\n  };\n\n  render() {\n    const { issue } = this.props;\n\n    const hasCheckbox = this.props.onCheck != null;\n\n    const issueClass = classNames('issue', {\n      hotspot: issue.type === 'SECURITY_HOTSPOT',\n      'issue-with-checkbox': hasCheckbox,\n      selected: this.props.selected\n    });\n\n    return (\n      <div\n        className={issueClass}\n        data-issue={issue.key}\n        onClick={this.handleClick}\n        role=\"listitem\"\n        tabIndex={0}>\n        <IssueTitleBar\n          branchLike={this.props.branchLike}\n          currentPopup={this.props.currentPopup}\n          displayLocationsCount={this.props.displayLocationsCount}\n          displayLocationsLink={this.props.displayLocationsLink}\n          issue={issue}\n          onFilter={this.props.onFilter}\n          togglePopup={this.props.togglePopup}\n        />\n        <IssueActionsBar\n          currentPopup={this.props.currentPopup}\n          issue={issue}\n          onAssign={this.props.onAssign}\n          onChange={this.props.onChange}\n          togglePopup={this.props.togglePopup}\n        />\n        {issue.comments && issue.comments.length > 0 && (\n          <div className=\"issue-comments\">\n            {issue.comments.map(comment => (\n              <IssueCommentLine\n                comment={comment}\n                key={comment.key}\n                onDelete={this.deleteComment}\n                onEdit={this.editComment}\n              />\n            ))}\n          </div>\n        )}\n        {hasCheckbox && (\n          <>\n            <Checkbox\n              checked={this.props.checked || false}\n              className=\"issue-checkbox-container\"\n              onCheck={this.handleCheck}\n            />\n          </>\n        )}\n      </div>\n    );\n  }\n}\n\nfunction isClickable(node: HTMLElement | undefined | null): boolean {\n  if (!node) {\n    return false;\n  }\n  const clickableTags = ['A', 'BUTTON', 'INPUT', 'TEXTAREA'];\n  const tagName = (node.tagName || '').toUpperCase();\n  return clickableTags.includes(tagName) || isClickable(node.parentElement);\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as key from 'keymaster';\nimport * as React from 'react';\nimport { setIssueAssignee } from '../../api/issues';\nimport { BranchLike } from '../../types/branch-like';\nimport { updateIssue } from './actions';\nimport './Issue.css';\nimport IssueView from './IssueView';\n\ninterface Props {\n  branchLike?: BranchLike;\n  checked?: boolean;\n  displayLocationsCount?: boolean;\n  displayLocationsLink?: boolean;\n  issue: T.Issue;\n  onChange: (issue: T.Issue) => void;\n  onCheck?: (issue: string) => void;\n  onClick: (issueKey: string) => void;\n  onFilter?: (property: string, issue: T.Issue) => void;\n  onPopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  openPopup?: string;\n  selected: boolean;\n}\n\nexport default class Issue extends React.PureComponent<Props> {\n  static defaultProps = {\n    selected: false\n  };\n\n  componentDidMount() {\n    if (this.props.selected) {\n      this.bindShortcuts();\n    }\n  }\n\n  componentWillUpdate(nextProps: Props) {\n    if (!nextProps.selected && this.props.selected) {\n      this.unbindShortcuts();\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (!prevProps.selected && this.props.selected) {\n      this.bindShortcuts();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.props.selected) {\n      this.unbindShortcuts();\n    }\n  }\n\n  bindShortcuts() {\n    key('f', 'issues', () => {\n      this.togglePopup('transition');\n      return false;\n    });\n    key('a', 'issues', () => {\n      this.togglePopup('assign');\n      return false;\n    });\n    key('m', 'issues', () => {\n      if (this.props.issue.actions.includes('assign')) {\n        this.handleAssignement('_me');\n      }\n      return false;\n    });\n    key('i', 'issues', () => {\n      this.togglePopup('set-severity');\n      return false;\n    });\n    key('c', 'issues', () => {\n      this.togglePopup('comment');\n      return false;\n    });\n    key('t', 'issues', () => {\n      this.togglePopup('edit-tags');\n      return false;\n    });\n    key('space', 'issues', () => {\n      if (this.props.onCheck) {\n        this.props.onCheck(this.props.issue.key);\n        return false;\n      }\n      return undefined;\n    });\n  }\n\n  unbindShortcuts() {\n    key.unbind('f', 'issues');\n    key.unbind('a', 'issues');\n    key.unbind('m', 'issues');\n    key.unbind('i', 'issues');\n    key.unbind('c', 'issues');\n    key.unbind('space', 'issues');\n    key.unbind('t', 'issues');\n  }\n\n  togglePopup = (popupName: string, open?: boolean) => {\n    this.props.onPopupToggle(this.props.issue.key, popupName, open);\n  };\n\n  handleAssignement = (login: string) => {\n    const { issue } = this.props;\n    if (issue.assignee !== login) {\n      updateIssue(this.props.onChange, setIssueAssignee({ issue: issue.key, assignee: login }));\n    }\n    this.togglePopup('assign', false);\n  };\n\n  render() {\n    return (\n      <IssueView\n        branchLike={this.props.branchLike}\n        checked={this.props.checked}\n        currentPopup={this.props.openPopup}\n        displayLocationsCount={this.props.displayLocationsCount}\n        displayLocationsLink={this.props.displayLocationsLink}\n        issue={this.props.issue}\n        onAssign={this.handleAssignement}\n        onChange={this.props.onChange}\n        onCheck={this.props.onCheck}\n        onClick={this.props.onClick}\n        onFilter={this.props.onFilter}\n        selected={this.props.selected}\n        togglePopup={this.togglePopup}\n      />\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport { ButtonIcon } from 'sonar-ui-common/components/controls/buttons';\nimport { ClipboardIconButton } from 'sonar-ui-common/components/controls/clipboard';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport QualifierIcon from 'sonar-ui-common/components/icons/QualifierIcon';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { collapsedDirFromPath, fileFromPath } from 'sonar-ui-common/helpers/path';\nimport { getPathUrlAsString } from 'sonar-ui-common/helpers/urls';\nimport { getBranchLikeQuery, isMainBranch } from '../../helpers/branch-like';\nimport { getBranchLikeUrl, getComponentIssuesUrl } from '../../helpers/urls';\nimport { BranchLike } from '../../types/branch-like';\nimport { ComponentQualifier } from '../../types/component';\nimport Favorite from '../controls/Favorite';\nimport './SourceViewerHeaderSlim.css';\n\nexport interface Props {\n  branchLike: BranchLike | undefined;\n  expandable?: boolean;\n  displayProjectName?: boolean;\n  linkToProject?: boolean;\n  loading?: boolean;\n  onExpand?: () => void;\n  sourceViewerFile: T.SourceViewerFile;\n}\n\nexport default function SourceViewerHeaderSlim(props: Props) {\n  const {\n    branchLike,\n    expandable,\n    displayProjectName = true,\n    linkToProject = true,\n    loading,\n    onExpand,\n    sourceViewerFile\n  } = props;\n  const {\n    key,\n    measures,\n    path,\n    project,\n    projectName,\n    q,\n    subProject,\n    subProjectName\n  } = sourceViewerFile;\n\n  const projectNameLabel = (\n    <>\n      <QualifierIcon qualifier={ComponentQualifier.Project} /> <span>{projectName}</span>\n    </>\n  );\n\n  return (\n    <div className=\"source-viewer-header-slim display-flex-row display-flex-space-between\">\n      <div className=\"display-flex-center flex-1\">\n        {displayProjectName && (\n          <div className=\"spacer-right\">\n            {linkToProject ? (\n              <a\n                className=\"link-with-icon\"\n                href={getPathUrlAsString(getBranchLikeUrl(project, branchLike))}>\n                {projectNameLabel}\n              </a>\n            ) : (\n              projectNameLabel\n            )}\n          </div>\n        )}\n\n        {subProject !== undefined && (\n          <>\n            <QualifierIcon qualifier={ComponentQualifier.SubProject} />{' '}\n            <span className=\"spacer-right\">{subProjectName}</span>\n          </>\n        )}\n\n        <div className=\"spacer-right\">\n          <QualifierIcon qualifier={q} /> <span>{collapsedDirFromPath(path)}</span>\n          <span className=\"component-name-file\">{fileFromPath(path)}</span>\n        </div>\n\n        <div className=\"spacer-right\">\n          <ClipboardIconButton className=\"button-link link-no-underline\" copyValue={path} />\n        </div>\n\n        {sourceViewerFile.canMarkAsFavorite && (!branchLike || isMainBranch(branchLike)) && (\n          <div className=\"nudged-up\">\n            <Favorite\n              className=\"component-name-favorite\"\n              component={key}\n              favorite={sourceViewerFile.fav || false}\n              qualifier={sourceViewerFile.q}\n            />\n          </div>\n        )}\n      </div>\n\n      {measures.issues !== undefined && (\n        <div\n          className={classNames('flex-0 big-spacer-left', {\n            'little-spacer-right': !expandable || loading\n          })}>\n          <Link\n            to={getComponentIssuesUrl(project, {\n              ...getBranchLikeQuery(branchLike),\n              fileUuids: sourceViewerFile.uuid,\n              resolved: 'false'\n            })}>\n            {translate('source_viewer.view_all_issues')}\n          </Link>\n        </div>\n      )}\n\n      {expandable && (\n        <DeferredSpinner className=\"little-spacer-right\" loading={loading}>\n          <div className=\"flex-0 big-spacer-left\">\n            <ButtonIcon className=\"js-actions\" onClick={onExpand}>\n              <ExpandSnippetIcon />\n            </ButtonIcon>\n          </div>\n        </DeferredSpinner>\n      )}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { intersection } from 'lodash';\n\nexport function optimizeHighlightedSymbols(\n  symbolsForLine: string[] = [],\n  highlightedSymbols: string[] = []\n): string[] | undefined {\n  const symbols = intersection(symbolsForLine, highlightedSymbols);\n\n  return symbols.length ? symbols : undefined;\n}\n\nexport function optimizeLocationMessage(\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined,\n  optimizedSecondaryIssueLocations: T.LinearIssueLocation[]\n) {\n  return highlightedLocationMessage != null &&\n    optimizedSecondaryIssueLocations.some(\n      location => location.index === highlightedLocationMessage.index\n    )\n    ? highlightedLocationMessage\n    : undefined;\n}\n\nexport function optimizeSelectedIssue(selectedIssue: string | undefined, issuesForLine: T.Issue[]) {\n  return selectedIssue !== undefined && issuesForLine.find(issue => issue.key === selectedIssue)\n    ? selectedIssue\n    : undefined;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport Issue from '../../issue/Issue';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssueClick: (issueKey: string) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  selectedIssue: string | undefined;\n}\n\nexport default function LineIssuesList(props: Props) {\n  const { issuePopup } = props;\n\n  return (\n    <div className=\"issue-list\">\n      {props.issues.map(issue => (\n        <Issue\n          branchLike={props.branchLike}\n          displayLocationsCount={props.displayIssueLocationsCount}\n          displayLocationsLink={props.displayIssueLocationsLink}\n          issue={issue}\n          key={issue.key}\n          onChange={props.onIssueChange}\n          onClick={props.onIssueClick}\n          onPopupToggle={props.onIssuePopupToggle}\n          openPopup={issuePopup && issuePopup.issue === issue.key ? issuePopup.name : undefined}\n          selected={props.selectedIssue === issue.key}\n        />\n      ))}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport LocationIndex from '../../common/LocationIndex';\nimport LocationMessage from '../../common/LocationMessage';\nimport {\n  highlightIssueLocations,\n  highlightSymbol,\n  splitByTokens,\n  Token\n} from '../helpers/highlight';\nimport LineIssuesList from './LineIssuesList';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  displayLocationMarkers?: boolean;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[] | undefined;\n  issueLocations: T.LinearIssueLocation[];\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  line: T.SourceLine;\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onIssueSelect: (issueKey: string) => void;\n  onLocationSelect: ((index: number) => void) | undefined;\n  onSymbolClick: (symbols: Array<string>) => void;\n  padding?: number;\n  scroll?: (element: HTMLElement) => void;\n  secondaryIssueLocations: T.LinearIssueLocation[];\n  selectedIssue: string | undefined;\n  showIssues?: boolean;\n}\n\ninterface State {\n  tokens: Token[];\n}\n\nexport default class LineCode extends React.PureComponent<Props, State> {\n  activeMarkerNode?: HTMLElement | null;\n  codeNode?: HTMLElement | null;\n  symbols?: NodeListOf<HTMLElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      tokens: splitByTokens(props.line.code || '')\n    };\n  }\n\n  componentDidMount() {\n    this.attachEvents();\n    if (this.props.highlightedLocationMessage && this.activeMarkerNode && this.props.scroll) {\n      this.props.scroll(this.activeMarkerNode);\n    }\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if (nextProps.line.code !== this.props.line.code) {\n      this.setState({\n        tokens: splitByTokens(nextProps.line.code || '')\n      });\n    }\n  }\n\n  componentWillUpdate() {\n    this.detachEvents();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    this.attachEvents();\n    if (\n      this.props.highlightedLocationMessage &&\n      (!prevProps.highlightedLocationMessage ||\n        prevProps.highlightedLocationMessage.index !==\n          this.props.highlightedLocationMessage.index) &&\n      this.activeMarkerNode &&\n      this.props.scroll\n    ) {\n      this.props.scroll(this.activeMarkerNode);\n    }\n  }\n\n  componentWillUnmount() {\n    this.detachEvents();\n  }\n\n  attachEvents() {\n    if (this.codeNode) {\n      this.symbols = this.codeNode.querySelectorAll('.sym');\n      if (this.symbols) {\n        for (let i = 0; i < this.symbols.length; i++) {\n          const symbol = this.symbols[i];\n          symbol.addEventListener('click', this.handleSymbolClick);\n        }\n      }\n    }\n  }\n\n  detachEvents() {\n    if (this.symbols) {\n      for (let i = 0; i < this.symbols.length; i++) {\n        const symbol = this.symbols[i];\n        symbol.addEventListener('click', this.handleSymbolClick);\n      }\n    }\n  }\n\n  handleSymbolClick = (event: MouseEvent) => {\n    event.preventDefault();\n    const keys = (event.currentTarget as HTMLElement).className.match(/sym-\\d+/g);\n    if (keys && keys.length > 0) {\n      this.props.onSymbolClick(keys);\n    }\n  };\n\n  renderMarker(index: number, message: string | undefined, selected: boolean, leading: boolean) {\n    const { onLocationSelect } = this.props;\n    const onClick = onLocationSelect ? () => onLocationSelect(index) : undefined;\n    const ref = selected ? (node: HTMLElement | null) => (this.activeMarkerNode = node) : undefined;\n    return (\n      <LocationIndex\n        key={`marker-${index}`}\n        leading={leading}\n        onClick={onClick}\n        selected={selected}>\n        <span ref={ref}>{index + 1}</span>\n        {message && <LocationMessage selected={true}>{message}</LocationMessage>}\n      </LocationIndex>\n    );\n  }\n\n  render() {\n    const {\n      highlightedLocationMessage,\n      highlightedSymbols,\n      issues,\n      issueLocations,\n      line,\n      onIssueSelect,\n      padding,\n      secondaryIssueLocations,\n      selectedIssue,\n      showIssues\n    } = this.props;\n\n    let tokens = [...this.state.tokens];\n\n    if (highlightedSymbols) {\n      highlightedSymbols.forEach(symbol => {\n        tokens = highlightSymbol(tokens, symbol);\n      });\n    }\n\n    if (issueLocations.length > 0) {\n      tokens = highlightIssueLocations(tokens, issueLocations);\n    }\n\n    if (secondaryIssueLocations) {\n      tokens = highlightIssueLocations(tokens, secondaryIssueLocations, 'issue-location');\n\n      if (highlightedLocationMessage) {\n        const location = secondaryIssueLocations.find(\n          location => location.index === highlightedLocationMessage.index\n        );\n        if (location) {\n          tokens = highlightIssueLocations(tokens, [location], 'selected');\n        }\n      }\n    }\n\n    const className = classNames('source-line-code', 'code', {\n      'has-issues': issues.length > 0\n    });\n\n    const renderedTokens: React.ReactNode[] = [];\n\n    // track if the first marker is displayed before the source code\n    // set `false` for the first token in a row\n    let leadingMarker = false;\n\n    tokens.forEach((token, index) => {\n      if (this.props.displayLocationMarkers && token.markers.length > 0) {\n        token.markers.forEach(marker => {\n          const selected =\n            highlightedLocationMessage !== undefined && highlightedLocationMessage.index === marker;\n          const loc = secondaryIssueLocations.find(loc => loc.index === marker);\n          const message = loc && loc.text;\n          renderedTokens.push(this.renderMarker(marker, message, selected, leadingMarker));\n        });\n      }\n      renderedTokens.push(\n        <span className={token.className} key={index}>\n          {token.text}\n        </span>\n      );\n\n      // keep leadingMarker truthy if previous token has only whitespaces\n      leadingMarker = (index === 0 ? true : leadingMarker) && !token.text.trim().length;\n    });\n\n    const style = padding ? { paddingBottom: `${padding}px` } : undefined;\n    const filteredSelectedIssues = issues.filter(i => i.key === selectedIssue);\n\n    return (\n      <td className={className} data-line-number={line.line} style={style}>\n        <div className=\"source-line-code-inner\">\n          <pre ref={node => (this.codeNode = node)}>{renderedTokens}</pre>\n        </div>\n        {showIssues && issues.length > 0 && (\n          <LineIssuesList\n            branchLike={this.props.branchLike}\n            displayIssueLocationsCount={this.props.displayIssueLocationsCount}\n            displayIssueLocationsLink={this.props.displayIssueLocationsLink}\n            issuePopup={this.props.issuePopup}\n            issues={issues}\n            onIssueChange={this.props.onIssueChange}\n            onIssueClick={onIssueSelect}\n            onIssuePopupToggle={this.props.onIssuePopupToggle}\n            selectedIssue={selectedIssue}\n          />\n        )}\n        {selectedIssue && !showIssues && (\n          <LineIssuesList\n            branchLike={this.props.branchLike}\n            issuePopup={this.props.issuePopup}\n            issues={filteredSelectedIssues}\n            onIssueChange={this.props.onIssueChange}\n            onIssueClick={onIssueSelect}\n            onIssuePopupToggle={this.props.onIssuePopupToggle}\n            selectedIssue={selectedIssue}\n          />\n        )}\n      </td>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\n\ninterface Props {\n  line: T.SourceLine;\n}\n\nexport default function LineCoverage({ line }: Props) {\n  const className =\n    'source-meta source-line-coverage' +\n    (line.coverageStatus != null ? ` source-line-${line.coverageStatus}` : '');\n  return (\n    <td className={className} data-line-number={line.line}>\n      <Tooltip overlay={getStatusTooltip(line)} placement=\"right\">\n        <div className=\"source-line-bar\" />\n      </Tooltip>\n    </td>\n  );\n}\n\nfunction getStatusTooltip(line: T.SourceLine) {\n  if (line.coverageStatus === 'uncovered') {\n    if (line.conditions) {\n      return translateWithParameters('source_viewer.tooltip.uncovered.conditions', line.conditions);\n    } else {\n      return translate('source_viewer.tooltip.uncovered');\n    }\n  } else if (line.coverageStatus === 'covered') {\n    if (line.conditions) {\n      return translateWithParameters('source_viewer.tooltip.covered.conditions', line.conditions);\n    } else {\n      return translate('source_viewer.tooltip.covered');\n    }\n  } else if (line.coverageStatus === 'partially-covered') {\n    if (line.conditions) {\n      return translateWithParameters(\n        'source_viewer.tooltip.partially-covered.conditions',\n        line.coveredConditions || 0,\n        line.conditions\n      );\n    } else {\n      return translate('source_viewer.tooltip.partially-covered');\n    }\n  }\n  return undefined;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\ninterface Props {\n  duplicated: boolean;\n  index: number;\n  line: T.SourceLine;\n  onPopupToggle: (linePopup: T.LinePopup) => void;\n  popupOpen: boolean;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n}\n\nexport default class LineDuplicationBlock extends React.PureComponent<Props> {\n  handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.currentTarget.blur();\n    this.props.onPopupToggle({\n      index: this.props.index,\n      line: this.props.line.line,\n      name: 'duplications'\n    });\n  };\n\n  handleTogglePopup = (open: boolean) => {\n    this.props.onPopupToggle({\n      index: this.props.index,\n      line: this.props.line.line,\n      name: 'duplications',\n      open\n    });\n  };\n\n  closePopup = () => {\n    this.handleTogglePopup(false);\n  };\n\n  render() {\n    const { duplicated, index, line, popupOpen } = this.props;\n    const className = classNames('source-meta', 'source-line-duplications-extra', {\n      'source-line-duplicated': duplicated\n    });\n\n    return duplicated ? (\n      <td className={className} data-index={index} data-line-number={line.line}>\n        <Toggler\n          onRequestClose={this.closePopup}\n          open={popupOpen}\n          overlay={this.props.renderDuplicationPopup(index, line.line)}>\n          <Tooltip\n            overlay={popupOpen ? undefined : translate('source_viewer.tooltip.duplicated_block')}\n            placement=\"right\">\n            <div\n              className=\"source-line-bar\"\n              onClick={this.handleClick}\n              role=\"button\"\n              tabIndex={0}\n            />\n          </Tooltip>\n        </Toggler>\n      </td>\n    ) : (\n      <td className={className} data-index={index} data-line-number={line.line}>\n        <div className=\"source-line-bar\" />\n      </td>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\ninterface Props {\n  line: T.SourceLine;\n  onClick: (line: T.SourceLine) => void;\n}\n\nexport default class LineDuplications extends React.PureComponent<Props> {\n  handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    this.props.onClick(this.props.line);\n  };\n\n  render() {\n    const { line } = this.props;\n    const className = classNames('source-meta', 'source-line-duplications', {\n      'source-line-duplicated': line.duplicated\n    });\n\n    const cell = (\n      <td\n        className={className}\n        onClick={line.duplicated ? this.handleClick : undefined}\n        role={line.duplicated ? 'button' : undefined}\n        tabIndex={line.duplicated ? 0 : undefined}>\n        <div className=\"source-line-bar\" />\n      </td>\n    );\n\n    return line.duplicated ? (\n      <Tooltip overlay={translate('source_viewer.tooltip.duplicated_line')} placement=\"right\">\n        {cell}\n      </Tooltip>\n    ) : (\n      cell\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport IssueIcon from 'sonar-ui-common/components/icons/IssueIcon';\nimport { sortByType } from '../../../helpers/issues';\n\ninterface Props {\n  issues: T.Issue[];\n  line: T.SourceLine;\n  onClick: () => void;\n}\n\nexport default class LineIssuesIndicator extends React.PureComponent<Props> {\n  handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    this.props.onClick();\n  };\n\n  render() {\n    const { issues, line } = this.props;\n    const hasIssues = issues.length > 0;\n    const className = classNames('source-meta', 'source-line-issues', {\n      'source-line-with-issues': hasIssues\n    });\n    const mostImportantIssue = hasIssues ? sortByType(issues)[0] : null;\n\n    return (\n      <td\n        className={className}\n        data-line-number={line.line}\n        onClick={hasIssues ? this.handleClick : undefined}\n        role={hasIssues ? 'button' : undefined}\n        tabIndex={hasIssues ? 0 : undefined}>\n        {mostImportantIssue != null && <IssueIcon type={mostImportantIssue.type} />}\n        {issues.length > 1 && <span className=\"source-line-issues-counter\">{issues.length}</span>}\n      </td>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getCodeUrl } from '../../../helpers/urls';\nimport { SourceViewerContext } from '../SourceViewerContext';\n\ninterface Props {\n  line: T.SourceLine;\n}\n\nexport default function LineOptionsPopup({ line }: Props) {\n  return (\n    <SourceViewerContext.Consumer>\n      {({ branchLike, file }) => (\n        <DropdownOverlay placement={PopupPlacement.RightTop}>\n          <div className=\"source-viewer-bubble-popup nowrap\">\n            <Link\n              className=\"js-get-permalink\"\n              onClick={event => {\n                event.stopPropagation();\n              }}\n              rel=\"noopener noreferrer\"\n              target=\"_blank\"\n              to={getCodeUrl(file.project, branchLike, file.key, line.line)}>\n              {translate('component_viewer.get_permalink')}\n            </Link>\n          </div>\n        </DropdownOverlay>\n      )}\n    </SourceViewerContext.Consumer>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport LineOptionsPopup from './LineOptionsPopup';\n\ninterface Props {\n  line: T.SourceLine;\n  onPopupToggle: (linePopup: T.LinePopup) => void;\n  popupOpen: boolean;\n}\n\nexport default class LineNumber extends React.PureComponent<Props> {\n  handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.currentTarget.blur();\n    this.props.onPopupToggle({ line: this.props.line.line, name: 'line-number' });\n  };\n\n  handleTogglePopup = (open: boolean) => {\n    this.props.onPopupToggle({ line: this.props.line.line, name: 'line-number', open });\n  };\n\n  closePopup = () => {\n    this.handleTogglePopup(false);\n  };\n\n  render() {\n    const { line, popupOpen } = this.props;\n    const { line: lineNumber } = line;\n    const hasLineNumber = !!lineNumber;\n    return hasLineNumber ? (\n      <td\n        className=\"source-meta source-line-number\"\n        data-line-number={lineNumber}\n        onClick={this.handleClick}\n        // eslint-disable-next-line jsx-a11y/no-noninteractive-element-to-interactive-role\n        role=\"button\"\n        tabIndex={0}>\n        <Toggler\n          onRequestClose={this.closePopup}\n          open={popupOpen}\n          overlay={<LineOptionsPopup line={line} />}\n        />\n      </td>\n    ) : (\n      <td className=\"source-meta source-line-number\" />\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport DateFormatter from 'sonar-ui-common/components/intl/DateFormatter';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\n\ninterface Props {\n  line: T.SourceLine;\n}\n\nexport default function SCMPopup({ line }: Props) {\n  const hasAuthor = line.scmAuthor !== '';\n  return (\n    <DropdownOverlay placement={PopupPlacement.RightTop}>\n      <div className=\"source-viewer-bubble-popup abs-width-400\">\n        {hasAuthor && <div>{line.scmAuthor}</div>}\n        {line.scmDate && (\n          <div className={classNames({ 'spacer-top': hasAuthor })}>\n            <DateFormatter date={line.scmDate} />\n          </div>\n        )}\n        {line.scmRevision && <div className=\"spacer-top\">{line.scmRevision}</div>}\n      </div>\n    </DropdownOverlay>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport SCMPopup from './SCMPopup';\n\ninterface Props {\n  line: T.SourceLine;\n  onPopupToggle: (linePopup: T.LinePopup) => void;\n  popupOpen: boolean;\n  previousLine: T.SourceLine | undefined;\n}\n\nexport default class LineSCM extends React.PureComponent<Props> {\n  handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.currentTarget.blur();\n    this.props.onPopupToggle({ line: this.props.line.line, name: 'scm' });\n  };\n\n  handleTogglePopup = (open: boolean) => {\n    this.props.onPopupToggle({ line: this.props.line.line, name: 'scm', open });\n  };\n\n  closePopup = () => {\n    this.handleTogglePopup(false);\n  };\n\n  render() {\n    const { line, popupOpen, previousLine } = this.props;\n    const hasPopup = !!line.line;\n    const cell = isSCMChanged(line, previousLine) && (\n      <div className=\"source-line-scm-inner\" data-author={line.scmAuthor || ''} />\n    );\n    return hasPopup ? (\n      <td\n        className=\"source-meta source-line-scm\"\n        data-line-number={line.line}\n        onClick={this.handleClick}\n        // eslint-disable-next-line jsx-a11y/no-noninteractive-element-to-interactive-role\n        role=\"button\"\n        tabIndex={0}>\n        <Toggler\n          onRequestClose={this.closePopup}\n          open={popupOpen}\n          overlay={<SCMPopup line={line} />}>\n          {cell}\n        </Toggler>\n      </td>\n    ) : (\n      <td className=\"source-meta source-line-scm\" data-line-number={line.line}>\n        {cell}\n      </td>\n    );\n  }\n}\n\nfunction isSCMChanged(s: T.SourceLine, p: T.SourceLine | undefined) {\n  let changed = true;\n  if (p != null && s.scmRevision != null && p.scmRevision != null) {\n    changed = s.scmRevision !== p.scmRevision || s.scmDate !== p.scmDate;\n  }\n  return changed;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { times } from 'lodash';\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport './Line.css';\nimport LineCode from './LineCode';\nimport LineCoverage from './LineCoverage';\nimport LineDuplicationBlock from './LineDuplicationBlock';\nimport LineDuplications from './LineDuplications';\nimport LineIssuesIndicator from './LineIssuesIndicator';\nimport LineNumber from './LineNumber';\nimport LineSCM from './LineSCM';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayAllIssues?: boolean;\n  displayCoverage: boolean;\n  displayDuplications: boolean;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  displayIssues: boolean;\n  displayLocationMarkers?: boolean;\n  displaySCM?: boolean;\n  duplications: number[];\n  duplicationsCount: number;\n  highlighted: boolean;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[] | undefined;\n  issueLocations: T.LinearIssueLocation[];\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  last: boolean;\n  line: T.SourceLine;\n  linePopup: T.LinePopup | undefined;\n  loadDuplications: (line: T.SourceLine) => void;\n  onLinePopupToggle: (linePopup: T.LinePopup) => void;\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issueKey: string, popupName: string, open?: boolean) => void;\n  onIssuesClose: (line: T.SourceLine) => void;\n  onIssueSelect: (issueKey: string) => void;\n  onIssuesOpen: (line: T.SourceLine) => void;\n  onIssueUnselect: () => void;\n  onLocationSelect: ((x: number) => void) | undefined;\n  onSymbolClick: (symbols: string[]) => void;\n  openIssues: boolean;\n  previousLine: T.SourceLine | undefined;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement) => void;\n  secondaryIssueLocations: T.LinearIssueLocation[];\n  selectedIssue: string | undefined;\n  verticalBuffer?: number;\n}\n\nconst LINE_HEIGHT = 18;\n\nexport default class Line extends React.PureComponent<Props> {\n  isPopupOpen = (name: string, index?: number) => {\n    const { line, linePopup } = this.props;\n    return (\n      linePopup !== undefined &&\n      linePopup.index === index &&\n      linePopup.line === line.line &&\n      linePopup.name === name\n    );\n  };\n\n  handleIssuesIndicatorClick = () => {\n    if (this.props.openIssues) {\n      this.props.onIssuesClose(this.props.line);\n      this.props.onIssueUnselect();\n    } else {\n      this.props.onIssuesOpen(this.props.line);\n\n      const { issues } = this.props;\n      if (issues.length > 0) {\n        this.props.onIssueSelect(issues[0].key);\n      }\n    }\n  };\n\n  render() {\n    const {\n      displayCoverage,\n      displaySCM = true,\n      duplications,\n      duplicationsCount,\n      issuePopup,\n      line\n    } = this.props;\n    const className = classNames('source-line', {\n      'source-line-highlighted': this.props.highlighted,\n      'source-line-filtered': line.isNew,\n      'source-line-filtered-dark':\n        displayCoverage &&\n        (line.coverageStatus === 'uncovered' || line.coverageStatus === 'partially-covered'),\n      'source-line-last': this.props.last === true\n    });\n\n    const bottomPadding = this.props.verticalBuffer\n      ? this.props.verticalBuffer * LINE_HEIGHT\n      : undefined;\n\n    return (\n      <tr className={className} data-line-number={line.line}>\n        <LineNumber\n          line={line}\n          onPopupToggle={this.props.onLinePopupToggle}\n          popupOpen={this.isPopupOpen('line-number')}\n        />\n\n        {displaySCM && (\n          <LineSCM\n            line={line}\n            onPopupToggle={this.props.onLinePopupToggle}\n            popupOpen={this.isPopupOpen('scm')}\n            previousLine={this.props.previousLine}\n          />\n        )}\n        {this.props.displayIssues && !this.props.displayAllIssues ? (\n          <LineIssuesIndicator\n            issues={this.props.issues}\n            line={line}\n            onClick={this.handleIssuesIndicatorClick}\n          />\n        ) : (\n          <td className=\"source-meta source-line-issues\" />\n        )}\n\n        {this.props.displayDuplications && (\n          <LineDuplications line={line} onClick={this.props.loadDuplications} />\n        )}\n\n        {times(duplicationsCount, index => (\n          <LineDuplicationBlock\n            duplicated={duplications.includes(index)}\n            index={index}\n            key={index}\n            line={this.props.line}\n            onPopupToggle={this.props.onLinePopupToggle}\n            popupOpen={this.isPopupOpen('duplications', index)}\n            renderDuplicationPopup={this.props.renderDuplicationPopup}\n          />\n        ))}\n\n        {this.props.displayCoverage && <LineCoverage line={line} />}\n\n        <LineCode\n          branchLike={this.props.branchLike}\n          displayIssueLocationsCount={this.props.displayIssueLocationsCount}\n          displayIssueLocationsLink={this.props.displayIssueLocationsLink}\n          displayLocationMarkers={this.props.displayLocationMarkers}\n          highlightedLocationMessage={this.props.highlightedLocationMessage}\n          highlightedSymbols={this.props.highlightedSymbols}\n          issueLocations={this.props.issueLocations}\n          issuePopup={issuePopup}\n          issues={this.props.issues}\n          line={line}\n          onIssueChange={this.props.onIssueChange}\n          onIssuePopupToggle={this.props.onIssuePopupToggle}\n          onIssueSelect={this.props.onIssueSelect}\n          onLocationSelect={this.props.onLocationSelect}\n          onSymbolClick={this.props.onSymbolClick}\n          padding={bottomPadding}\n          scroll={this.props.scroll}\n          secondaryIssueLocations={this.props.secondaryIssueLocations}\n          selectedIssue={this.props.selectedIssue}\n          showIssues={this.props.openIssues || this.props.displayAllIssues}\n        />\n      </tr>\n    );\n  }\n}\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./SourceViewerHeaderSlim.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".source-viewer-header-slim{padding:4px 10px;border-bottom:1px solid #cdcdcd;background-color:#f3f3f3;align-items:center;min-height:25px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleLinePopupToggle: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetOfLastGroup: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      const offset = parent.getBoundingClientRect().width / 2;\n\n      scrollHorizontally(element, {\n        leftOffset: offset,\n        rightOffset: offset,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.props.loadDuplications}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={() => {}}\n        onIssueUnselect={() => {}}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLinePopupToggle={this.props.handleLinePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      lastSnippetOfLastGroup,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = lastSnippetOfLastGroup\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications = snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./Line.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".source-line:hover .source-line-coverage,.source-line:hover .source-line-duplications,.source-line:hover .source-line-duplications-extra,.source-line:hover .source-line-issues,.source-line:hover .source-line-number,.source-line:hover .source-line-scm{border-color:#e9e9e9;background-color:#e9e9e9}.source-line:hover .source-line-code{background-color:#f5f5f5}.source-line-highlighted .source-line-coverage,.source-line-highlighted .source-line-duplications,.source-line-highlighted .source-line-duplications-extra,.source-line-highlighted .source-line-issues,.source-line-highlighted .source-line-number,.source-line-highlighted .source-line-scm,.source-line-highlighted:hover .source-line-coverage,.source-line-highlighted:hover .source-line-duplications,.source-line-highlighted:hover .source-line-duplications-extra,.source-line-highlighted:hover .source-line-issues,.source-line-highlighted:hover .source-line-number,.source-line-highlighted:hover .source-line-scm{border-color:#c4dfec!important;background-color:#c4dfec}.source-line-highlighted .source-line-code,.source-line-highlighted:hover .source-line-code{background-color:#d9edf7}.source-line-filtered .source-line-code{background-color:#fbf3d5!important}.source-line-filtered.source-line-highlighted .source-line-code,.source-line-filtered.source-line-highlighted:hover .source-line-code{background-color:#cdd9c4!important}.source-line-filtered.source-line-filtered-dark .source-line-code{background-color:#f9ebb7!important}.source-line-filtered.source-line-filtered-dark:hover .source-line-code,.source-line-filtered:hover .source-line-code{background-color:#f1e8cb!important}.source-line-last .source-line-code{padding-bottom:160px}.source-viewer pre{height:18px;padding:0}.source-line-number,.source-line-scm,.source-viewer pre{line-height:18px;font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px}.source-line-code{position:relative;padding:0 10px}.source-line-code pre{float:left}.source-line-code .issue-list{margin-left:-10px;margin-right:-10px}.source-line-code-inner{min-height:18px}.source-line-code-inner:after,.source-line-code-inner:before{display:table;content:\\\"\\\";line-height:0}.source-line-code-inner:after{clear:both}.source-line-code-inner pre{-moz-tab-size:4;tab-size:4}.source-line-code-issue{display:inline-block;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAGCAYAAAAPDoR2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1M0M2Rjk4M0M3QUYxMUUzODkzRUREMUM5OTNDMjY4QSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1M0M2Rjk4NEM3QUYxMUUzODkzRUREMUM5OTNDMjY4QSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjUzQzZGOTgxQzdBRjExRTM4OTNFREQxQzk5M0MyNjhBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjUzQzZGOTgyQzdBRjExRTM4OTNFREQxQzk5M0MyNjhBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+bcqJtQAAAEhJREFUeNpi+G+swwDGDAwgbAWlwZiJAQFCgfgwEIfDRaC67ID4NRDnQ2kQnwFZwgFqnANMAQOUYY9sF0wBiCGH5CBkrAgQYACuWi4sSGW8yAAAAABJRU5ErkJggg==);background-repeat:repeat-x;background-size:4px;background-position:bottom}.source-meta{position:relative;vertical-align:top;width:1px;background-clip:padding-box;-webkit-user-select:none;-ms-user-select:none;user-select:none}.source-meta:focus{outline:none}.source-meta[role=button]{cursor:pointer}.source-line-number{min-width:18px;padding:0 10px;background-color:#f3f3f3;color:#777;text-align:right}.source-line-number:before{content:attr(data-line-number)}.source-line-issues{position:relative;padding:0 2px;background-color:#f3f3f3;white-space:nowrap}.source-line-with-issues svg{padding-right:2px;vertical-align:middle}.source-line-issues-counter{position:absolute;left:17px;line-height:8px;font-size:8px;z-index:900}.source-line-coverage,.source-line-duplications,.source-line-duplications-extra{background-color:#f3f3f3}.source-duplications-expanded .source-line-duplications,.source-line-duplications-extra{display:none}.source-duplications-expanded .source-line-duplications-extra{display:table-cell}.source-line-scm{padding:0 5px;background-color:#f3f3f3}.source-line-scm-inner{max-width:40px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.source-line-scm-inner:before{content:attr(data-author)}.source-line-bar{width:5px;height:18px}.source-line-bar[role=button]{cursor:pointer}.source-line-bar:focus{outline:none}.source-line-covered{background-color:#b4dd78!important}.source-line-partially-covered,.source-line-uncovered{background-color:#a4030f!important}.source-line-partially-covered{background-image:repeating-linear-gradient(45deg,hsla(0,0%,100%,.5) 4px,transparent 0,transparent 8px,hsla(0,0%,100%,.5) 0,hsla(0,0%,100%,.5) 12px,transparent 0,transparent 16px,hsla(0,0%,100%,.5) 0,hsla(0,0%,100%,.5) 20px)!important}.source-line-duplicated{background-color:#797979!important}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n"],"sourceRoot":""}