{"version":3,"sources":["webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?ff37","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetGroupViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx"],"names":["MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","startA","endA","startB","getPrimaryLocation","issue","component","textRange","endLine","endOffset","startLine","startOffset","createSnippets","params","locations","hasSecondaryLocations","secondaryLocations","length","ranges","reduce","snippets","loc","index","firstCollision","startIndex","Math","max","endIndex","locationEnd","issueEndLine","addLinesBellow","filter","snippet","start","end","keep","min","undefined","push","sort","a","b","linesForSnippets","componentLines","map","lines","i","groupLocationsByComponent","components","currentGroup","currentComponent","groups","addGroup","key","measures","path","project","projectName","q","uuid","sources","every","forEach","expandSnippet","direction","snippetIndex","snippetToExpand","find","s","Error","toDelete","inSnippet","line","props","doScroll","element","scroll","parent","snippetNodeRef","current","offset","getBoundingClientRect","width","leftOffset","rightOffset","scrollToLastExpandedRow","snippetNode","rows","querySelectorAll","lastRow","expandBlock","then","renderLine","displayDuplications","displaySCM","issuesForLine","issueLocations","symbols","verticalBuffer","secondaryIssueLocations","this","duplications","duplicationsByLine","duplicationsCount","lineDuplications","isSinkLine","some","branchLike","displayAllIssues","displayCoverage","displayIssues","displayLocationMarkers","highlighted","highlightedLocationMessage","highlightedSymbols","issuePopup","issues","last","linePopup","loadDuplications","onIssueChange","onIssuePopupToggle","onIssueSelect","onIssueUnselect","onIssuesClose","handleCloseIssues","onIssuesOpen","handleOpenIssues","onLinePopupToggle","handleLinePopupToggle","onLocationSelect","onSymbolClick","handleSymbolClick","openIssues","openIssuesByLine","previousLine","renderDuplicationPopup","selectedIssue","render","issuesByLine","lastSnippetOfLastGroup","locationsByLine","lastLine","parseInt","bottomLine","issueLine","lowestVisibleIssue","Object","keys","k","l","className","ref","onClick","type","api","content","__esModule","default","module","options","exported","locals","exports","___CSS_LOADER_API_IMPORT___","mounted","rootNodeRef","state","additionalLines","loading","snippetGroup","Promise","reject","extension","range","from","to","lineMap","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","setState","clickedSymbols","symb","includes","componentDidMount","createSnippetsFromProps","componentWillUnmount","getNodes","root","querySelector","wrapper","table","firstChild","cleanDom","nodes","style","marginTop","maxHeight","setMaxHeight","value","up","height","startHeight","transition","setTimeout","resolve","renderSnippet","SnippetViewer","lastSnippetGroup","fullyShown","snippetLines","isFlow","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","id","notAccessible","fetchDuplications","r","duplicatedFiles","files","name","handleIssuePopupToggle","popupName","open","samePopup","handleCloseLinePopup","blocks","Consumer","openComponent","DuplicationPopup","inRemovedComponent","onClose","fetchIssueFlowSnippets","componentWillReceiveProps","newProps","issueKey","onLoaded","response","status","throwGlobalError","Alert","variant","issuesByComponent","locationsByComponent","componentProps","SourceViewerContext","Provider","selectedFlowIndex","file"],"mappings":"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","file":"js/368.1588858339197.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nexport function getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  component: string;\n  issue: T.Issue;\n  locations: T.FlowLocation[];\n}): T.Snippet[] {\n  const { component, issue, locations } = params;\n\n  const hasSecondaryLocations = issue.secondaryLocations.length > 0;\n  const addIssueLocation = hasSecondaryLocations && issue.component === component;\n\n  // For each location: compute its range, and then compare with other ranges\n  // to merge snippets that collide.\n  const ranges = (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n\n  // Sort snippets by line number in the case of secondary locations\n  // Preserve location order for flows!\n  return hasSecondaryLocations ? ranges.sort((a, b) => a.start - b.start) : ranges;\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  issue: T.Issue,\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  const addGroup = (loc: T.FlowLocation) => {\n    currentGroup = {\n      ...(components[loc.component] || unknownComponent(loc.component)),\n      locations: []\n    };\n    groups.push(currentGroup);\n    currentComponent = loc.component;\n  };\n\n  if (\n    issue.secondaryLocations.length > 0 &&\n    locations.every(loc => loc.component !== issue.component)\n  ) {\n    addGroup(getPrimaryLocation(issue));\n  }\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      addGroup(loc);\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleLinePopupToggle: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetOfLastGroup: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      const offset = parent.getBoundingClientRect().width / 2;\n\n      scrollHorizontally(element, {\n        leftOffset: offset,\n        rightOffset: offset,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.props.loadDuplications}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={() => {}}\n        onIssueUnselect={() => {}}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLinePopupToggle={this.props.handleLinePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      lastSnippetOfLastGroup,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = lastSnippetOfLastGroup\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications = snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetGroup: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLinePopupToggle: (linePopup: T.LinePopup & { component: string }) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetGroupViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const { issue, snippetGroup } = this.props;\n\n    const snippets = createSnippets({\n      component: snippetGroup.component.key,\n      issue,\n      locations: snippetGroup.locations\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleLinePopupToggle = (linePopup: T.LinePopup) => {\n    this.props.onLinePopupToggle({\n      ...linePopup,\n      component: this.props.snippetGroup.component.key\n    });\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (clickedSymbols: string[]) => {\n    this.setState(({ highlightedSymbols }) => {\n      const newHighlightedSymbols = clickedSymbols.filter(\n        symb => !highlightedSymbols.includes(symb)\n      );\n      return { highlightedSymbols: newHighlightedSymbols };\n    });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    lastSnippetOfLastGroup,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    lastSnippetOfLastGroup: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleLinePopupToggle={this.handleLinePopupToggle}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        lastSnippetOfLastGroup={lastSnippetOfLastGroup}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const {\n      branchLike,\n      duplications,\n      issue,\n      issuesByLine,\n      lastSnippetGroup,\n      snippetGroup\n    } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations =\n      issue.component === snippetGroup.component.key ? locationsByLine([issue]) : {};\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    const isFlow = issue.secondaryLocations.length === 0;\n    const includeIssueLocation = (snippetIndex: number) =>\n      isFlow ? lastSnippetGroup && snippetIndex === snippets.length - 1 : snippetIndex === 0;\n\n    return (\n      <div\n        className={classNames('component-source-container', {\n          'source-duplications-expanded': duplications && duplications.length > 0\n        })}\n        ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine,\n              locationsByLine: includeIssueLocation(index) ? locations : {},\n              lastSnippetOfLastGroup: lastSnippetGroup && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine as getDuplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetGroupViewer from './ComponentSourceSnippetGroupViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  linePopup?: T.LinePopup & { component: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string, line: T.SourceLine) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState(state => ({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: getDuplicationsByLine(r.duplications),\n            linePopup:\n              r.duplications.length === 1\n                ? { component, index: 0, line: line.line, name: 'duplications' }\n                : state.linePopup\n          }));\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            linePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleLinePopupToggle = ({\n    component,\n    index,\n    line,\n    name,\n    open\n  }: T.LinePopup & { component: string }) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.linePopup !== undefined &&\n        state.linePopup.line === line &&\n        state.linePopup.name === name &&\n        state.linePopup.component === component &&\n        state.linePopup.index === index;\n      if (open !== false && !samePopup) {\n        return { linePopup: { component, index, line, name } };\n      } else if (open !== true && samePopup) {\n        return { linePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleCloseLinePopup = () => {\n    this.setState({ linePopup: undefined });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            onClose={this.handleCloseLinePopup}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { issue, locations } = this.props;\n    const { components, duplications, duplicationsByLine, linePopup } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(issue, locations, components);\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          let componentProps = {};\n          if (linePopup && snippetGroup.component.key === linePopup.component) {\n            componentProps = {\n              duplications,\n              duplicationsByLine,\n              linePopup: { index: linePopup.index, line: linePopup.line, name: linePopup.name }\n            };\n          }\n          return (\n            <SourceViewerContext.Provider\n              // eslint-disable-next-line react/no-array-index-key\n              key={`${issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetGroupViewer\n                branchLike={this.props.branchLike}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                lastSnippetGroup={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLinePopupToggle={this.handleLinePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n                {...componentProps}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n"],"sourceRoot":""}