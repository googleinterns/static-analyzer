{"version":3,"sources":["webpack:///./src/main/js/components/workspace/WorkspaceComponentTitle.tsx","webpack:///./src/main/js/components/workspace/WorkspaceHeader.tsx","webpack:///./src/main/js/components/workspace/WorkspaceComponentViewer.tsx","webpack:///./src/main/js/components/SourceViewer/SourceViewer.tsx"],"names":["WorkspaceComponentTitle","component","limited","name","qualifier","className","WorkspaceHeader","handleDrag","_event","data","this","props","onResize","deltaY","children","offsetParent","document","body","onDrag","WorkspaceHeaderButton","icon","onClick","onCollapse","tooltip","maximized","onMinimize","onMaximize","onClose","Icon","color","fill","undefined","WorkspaceComponentViewer","super","handleClose","key","handleIssueChange","_","refreshBranchStatus","handleLoaded","onLoad","path","q","container","line","row","querySelector","smooth","parent","topOffset","bottomOffset","branchLike","then","parents","length","fetchBranchStatus","pop","documentElement","classList","add","remove","ref","node","style","height","aroundLine","highlightedLine","onIssueChange","onLoaded","mapDispatchToProps","SourceViewer"],"mappings":"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","file":"js/366.m.39e5c85a.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport QualifierIcon from 'sonar-ui-common/components/icons/QualifierIcon';\nimport { collapsePath } from 'sonar-ui-common/helpers/path';\nimport { ComponentDescriptor } from './context';\n\ninterface Props {\n  component: ComponentDescriptor;\n  limited?: boolean;\n}\n\nexport default function WorkspaceComponentTitle({ component, limited }: Props) {\n  const { name = 'â€”' } = component;\n  return (\n    <>\n      {component.qualifier && (\n        <QualifierIcon className=\"little-spacer-right\" qualifier={component.qualifier} />\n      )}\n      {limited ? collapsePath(name, 15) : name}\n    </>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { DraggableCore, DraggableData } from 'react-draggable';\nimport { ButtonIcon } from 'sonar-ui-common/components/controls/buttons';\nimport ClearIcon from 'sonar-ui-common/components/icons/ClearIcon';\nimport CollapseIcon from 'sonar-ui-common/components/icons/CollapseIcon';\nimport ExpandIcon from 'sonar-ui-common/components/icons/ExpandIcon';\nimport { IconProps } from 'sonar-ui-common/components/icons/Icon';\nimport MinimizeIcon from 'sonar-ui-common/components/icons/MinimizeIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\nexport interface Props {\n  children: React.ReactNode;\n  maximized?: boolean;\n  onClose: () => void;\n  onCollapse: () => void;\n  onMaximize: () => void;\n  onMinimize: () => void;\n  onResize: (deltaY: number) => void;\n}\n\nexport default class WorkspaceHeader extends React.PureComponent<Props> {\n  handleDrag = (_event: MouseEvent, data: DraggableData) => {\n    this.props.onResize(data.deltaY);\n  };\n\n  render() {\n    return (\n      <header className=\"workspace-viewer-header\">\n        <h6 className=\"workspace-viewer-name\">{this.props.children}</h6>\n\n        <DraggableCore offsetParent={document.body} onDrag={this.handleDrag}>\n          <div className=\"workspace-viewer-resize js-resize\" />\n        </DraggableCore>\n\n        <div className=\"workspace-viewer-actions\">\n          <WorkspaceHeaderButton\n            icon={MinimizeIcon}\n            onClick={this.props.onCollapse}\n            tooltip=\"workspace.minimize\"\n          />\n\n          {this.props.maximized ? (\n            <WorkspaceHeaderButton\n              icon={CollapseIcon}\n              onClick={this.props.onMinimize}\n              tooltip=\"workspace.normal_size\"\n            />\n          ) : (\n            <WorkspaceHeaderButton\n              icon={ExpandIcon}\n              onClick={this.props.onMaximize}\n              tooltip=\"workspace.full_window\"\n            />\n          )}\n\n          <WorkspaceHeaderButton\n            icon={ClearIcon}\n            onClick={this.props.onClose}\n            tooltip=\"workspace.close\"\n          />\n        </div>\n      </header>\n    );\n  }\n}\n\ninterface WorkspaceHeaderButtonProps {\n  icon: React.SFC<IconProps>;\n  onClick: () => void;\n  tooltip: string;\n}\n\nfunction WorkspaceHeaderButton({ icon: Icon, onClick, tooltip }: WorkspaceHeaderButtonProps) {\n  return (\n    <ButtonIcon\n      className=\"workspace-header-icon\"\n      color=\"#fff\"\n      onClick={onClick}\n      tooltip={translate(tooltip)}>\n      <Icon fill={undefined} />\n    </ButtonIcon>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { debounce } from 'lodash';\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { scrollToElement } from 'sonar-ui-common/helpers/scrolling';\nimport { getParents } from '../../api/components';\nimport { isPullRequest } from '../../helpers/branch-like';\nimport { fetchBranchStatus } from '../../store/rootActions';\nimport { BranchLike } from '../../types/branch-like';\nimport SourceViewer from '../SourceViewer/SourceViewer';\nimport { ComponentDescriptor } from './context';\nimport WorkspaceComponentTitle from './WorkspaceComponentTitle';\nimport WorkspaceHeader, { Props as WorkspaceHeaderProps } from './WorkspaceHeader';\n\nexport interface Props extends T.Omit<WorkspaceHeaderProps, 'children' | 'onClose'> {\n  component: ComponentDescriptor;\n  fetchBranchStatus: (branchLike: BranchLike, projectKey: string) => Promise<void>;\n  height: number;\n  onClose: (componentKey: string) => void;\n  onLoad: (details: { key: string; name: string; qualifier: string }) => void;\n}\n\nexport class WorkspaceComponentViewer extends React.PureComponent<Props> {\n  container?: HTMLElement | null;\n\n  constructor(props: Props) {\n    super(props);\n    this.refreshBranchStatus = debounce(this.refreshBranchStatus, 1000);\n  }\n\n  componentDidMount() {\n    if (document.documentElement) {\n      document.documentElement.classList.add('with-workspace');\n    }\n  }\n\n  componentWillUnmount() {\n    if (document.documentElement) {\n      document.documentElement.classList.remove('with-workspace');\n    }\n  }\n\n  handleClose = () => {\n    this.props.onClose(this.props.component.key);\n  };\n\n  handleIssueChange = (_: T.Issue) => {\n    this.refreshBranchStatus();\n  };\n\n  handleLoaded = (component: T.SourceViewerFile) => {\n    this.props.onLoad({\n      key: this.props.component.key,\n      name: component.path,\n      qualifier: component.q\n    });\n\n    if (this.container && this.props.component.line) {\n      const row = this.container.querySelector(\n        `.source-line[data-line-number=\"${this.props.component.line}\"]`\n      );\n      if (row) {\n        scrollToElement(row, {\n          smooth: false,\n          parent: this.container,\n          topOffset: 50,\n          bottomOffset: 50\n        });\n      }\n    }\n  };\n\n  refreshBranchStatus = () => {\n    const { component } = this.props;\n    const { branchLike } = component;\n    if (branchLike && isPullRequest(branchLike)) {\n      getParents(component.key).then(\n        (parents?: any[]) => {\n          if (parents && parents.length > 0) {\n            this.props.fetchBranchStatus(branchLike, parents.pop().key);\n          }\n        },\n        () => {}\n      );\n    }\n  };\n\n  render() {\n    const { component } = this.props;\n\n    return (\n      <div className=\"workspace-viewer\">\n        <WorkspaceHeader\n          maximized={this.props.maximized}\n          onClose={this.handleClose}\n          onCollapse={this.props.onCollapse}\n          onMaximize={this.props.onMaximize}\n          onMinimize={this.props.onMinimize}\n          onResize={this.props.onResize}>\n          <WorkspaceComponentTitle component={component} />\n        </WorkspaceHeader>\n\n        <div\n          className=\"workspace-viewer-container\"\n          ref={node => (this.container = node)}\n          style={{ height: this.props.height }}>\n          <SourceViewer\n            aroundLine={component.line}\n            branchLike={component.branchLike}\n            component={component.key}\n            highlightedLine={component.line}\n            onIssueChange={this.handleIssueChange}\n            onLoaded={this.handleLoaded}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapDispatchToProps = { fetchBranchStatus: fetchBranchStatus as any };\n\nexport default connect(null, mapDispatchToProps)(WorkspaceComponentViewer);\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { lazyLoadComponent } from 'sonar-ui-common/components/lazyLoadComponent';\n\nconst SourceViewer = lazyLoadComponent(\n  () => import(/* webpackPrefetch: true */ './SourceViewerBase'),\n  'SourceViewer'\n);\nexport default SourceViewer;\n"],"sourceRoot":""}