{"version":3,"sources":["webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetGroupViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?ff37","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css"],"names":["mounted","rootNodeRef","state","additionalLines","highlightedSymbols","loading","openIssuesByLine","snippets","expandBlock","snippetIndex","direction","branchLike","snippetGroup","this","props","key","component","snippet","find","s","index","Promise","reject","extension","range","from","Math","max","start","to","end","then","lines","reduce","lineMap","line","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","setState","length","handleLinePopupToggle","linePopup","onLinePopupToggle","handleOpenIssues","handleCloseIssues","handleSymbolClick","clickedSymbols","filter","symb","includes","loadDuplications","renderDuplicationPopup","createSnippetsFromProps","issue","locations","root","current","element","querySelector","wrapper","table","firstChild","nodes","getNodes","style","marginTop","maxHeight","value","up","undefined","getBoundingClientRect","height","startHeight","transition","setTimeout","newSnippets","deletedSnippets","toDelete","forEach","setMaxHeight","resolve","cleanDom","issuesByLine","lastSnippetOfLastGroup","locationsByLine","SnippetViewer","highlightedLocationMessage","issuePopup","onIssueChange","onIssuePopupToggle","onLocationSelect","scroll","duplications","lastSnippetGroup","fullyShown","measures","parseInt","snippetLines","sources","isFlow","secondaryLocations","className","ref","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","map","id","renderSnippet","components","duplicationsByLine","notAccessible","fetchDuplications","r","duplicatedFiles","files","name","handleIssuePopupToggle","popupName","open","samePopup","handleCloseLinePopup","blocks","Consumer","openComponent","DuplicationPopup","inRemovedComponent","onClose","fetchIssueFlowSnippets","newProps","issueKey","onLoaded","response","status","throwGlobalError","Alert","variant","issuesByComponent","issues","locationsByComponent","i","componentProps","SourceViewerContext","Provider","selectedFlowIndex","file","MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","startA","endA","startB","endB","getPrimaryLocation","textRange","endLine","endOffset","startLine","startOffset","createSnippets","params","hasSecondaryLocations","ranges","loc","startIndex","endIndex","locationEnd","issueEndLine","addLinesBellow","firstCollision","keep","min","push","sort","a","b","linesForSnippets","componentLines","groupLocationsByComponent","currentGroup","currentComponent","groups","addGroup","path","project","projectName","q","uuid","every","expandSnippet","snippetToExpand","Error","inSnippet","super","doScroll","parent","snippetNodeRef","offset","width","leftOffset","rightOffset","scrollToLastExpandedRow","snippetNode","rows","querySelectorAll","lastRow","displayDuplications","displaySCM","issuesForLine","issueLocations","symbols","verticalBuffer","secondaryIssueLocations","duplicationsCount","lineDuplications","isSinkLine","some","displayAllIssues","displayCoverage","displayIssues","displayLocationMarkers","highlighted","last","onIssueSelect","onIssueUnselect","onIssuesClose","onIssuesOpen","onSymbolClick","openIssues","previousLine","selectedIssue","lastLine","bottomLine","issueLine","lowestVisibleIssue","Object","keys","k","l","duplicated","onClick","type","renderLine","api","content","__esModule","default","module","options","exported","locals","exports","___CSS_LOADER_API_IMPORT___"],"mappings":"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","file":"js/359.m.f8a3abed.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetGroup: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLinePopupToggle: (linePopup: T.LinePopup & { component: string }) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetGroupViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const { issue, snippetGroup } = this.props;\n\n    const snippets = createSnippets({\n      component: snippetGroup.component.key,\n      issue,\n      locations: snippetGroup.locations\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleLinePopupToggle = (linePopup: T.LinePopup) => {\n    this.props.onLinePopupToggle({\n      ...linePopup,\n      component: this.props.snippetGroup.component.key\n    });\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (clickedSymbols: string[]) => {\n    this.setState(({ highlightedSymbols }) => {\n      const newHighlightedSymbols = clickedSymbols.filter(\n        symb => !highlightedSymbols.includes(symb)\n      );\n      return { highlightedSymbols: newHighlightedSymbols };\n    });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    lastSnippetOfLastGroup,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    lastSnippetOfLastGroup: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleLinePopupToggle={this.handleLinePopupToggle}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        lastSnippetOfLastGroup={lastSnippetOfLastGroup}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const {\n      branchLike,\n      duplications,\n      issue,\n      issuesByLine,\n      lastSnippetGroup,\n      snippetGroup\n    } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations =\n      issue.component === snippetGroup.component.key ? locationsByLine([issue]) : {};\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    const isFlow = issue.secondaryLocations.length === 0;\n    const includeIssueLocation = (snippetIndex: number) =>\n      isFlow ? lastSnippetGroup && snippetIndex === snippets.length - 1 : snippetIndex === 0;\n\n    return (\n      <div\n        className={classNames('component-source-container', {\n          'source-duplications-expanded': duplications && duplications.length > 0\n        })}\n        ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine,\n              locationsByLine: includeIssueLocation(index) ? locations : {},\n              lastSnippetOfLastGroup: lastSnippetGroup && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine as getDuplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetGroupViewer from './ComponentSourceSnippetGroupViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  linePopup?: T.LinePopup & { component: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string, line: T.SourceLine) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState(state => ({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: getDuplicationsByLine(r.duplications),\n            linePopup:\n              r.duplications.length === 1\n                ? { component, index: 0, line: line.line, name: 'duplications' }\n                : state.linePopup\n          }));\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            linePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleLinePopupToggle = ({\n    component,\n    index,\n    line,\n    name,\n    open\n  }: T.LinePopup & { component: string }) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.linePopup !== undefined &&\n        state.linePopup.line === line &&\n        state.linePopup.name === name &&\n        state.linePopup.component === component &&\n        state.linePopup.index === index;\n      if (open !== false && !samePopup) {\n        return { linePopup: { component, index, line, name } };\n      } else if (open !== true && samePopup) {\n        return { linePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  handleCloseLinePopup = () => {\n    this.setState({ linePopup: undefined });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            onClose={this.handleCloseLinePopup}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { issue, locations } = this.props;\n    const { components, duplications, duplicationsByLine, linePopup } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(issue, locations, components);\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          let componentProps = {};\n          if (linePopup && snippetGroup.component.key === linePopup.component) {\n            componentProps = {\n              duplications,\n              duplicationsByLine,\n              linePopup: { index: linePopup.index, line: linePopup.line, name: linePopup.name }\n            };\n          }\n          return (\n            <SourceViewerContext.Provider\n              // eslint-disable-next-line react/no-array-index-key\n              key={`${issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetGroupViewer\n                branchLike={this.props.branchLike}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                lastSnippetGroup={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLinePopupToggle={this.handleLinePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n                {...componentProps}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nexport function getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  component: string;\n  issue: T.Issue;\n  locations: T.FlowLocation[];\n}): T.Snippet[] {\n  const { component, issue, locations } = params;\n\n  const hasSecondaryLocations = issue.secondaryLocations.length > 0;\n  const addIssueLocation = hasSecondaryLocations && issue.component === component;\n\n  // For each location: compute its range, and then compare with other ranges\n  // to merge snippets that collide.\n  const ranges = (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n\n  // Sort snippets by line number in the case of secondary locations\n  // Preserve location order for flows!\n  return hasSecondaryLocations ? ranges.sort((a, b) => a.start - b.start) : ranges;\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  issue: T.Issue,\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  const addGroup = (loc: T.FlowLocation) => {\n    currentGroup = {\n      ...(components[loc.component] || unknownComponent(loc.component)),\n      locations: []\n    };\n    groups.push(currentGroup);\n    currentComponent = loc.component;\n  };\n\n  if (\n    issue.secondaryLocations.length > 0 &&\n    locations.every(loc => loc.component !== issue.component)\n  ) {\n    addGroup(getPrimaryLocation(issue));\n  }\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      addGroup(loc);\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleLinePopupToggle: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetOfLastGroup: boolean;\n  linePopup?: T.LinePopup;\n  loadDuplications: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      const offset = parent.getBoundingClientRect().width / 2;\n\n      scrollHorizontally(element, {\n        leftOffset: offset,\n        rightOffset: offset,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        linePopup={this.props.linePopup}\n        loadDuplications={this.props.loadDuplications}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={() => {}}\n        onIssueUnselect={() => {}}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLinePopupToggle={this.props.handleLinePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      lastSnippetOfLastGroup,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = lastSnippetOfLastGroup\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications = snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#777;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n"],"sourceRoot":""}